<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>
<div id="wrapper" [ngClass]="{'active': showSidebar}">
    <div class="fakeLoader"></div>
    <!-- Navigation -->
    <div id="page-wrapper">
        <div class="row page-titles">
            <div class="col-md-5 align-self-center">
                <h3 class="text-themecolor" style="margin-left: 20px;">Travel Expense</h3>
            </div>
            <div class="col-md-7 align-self-center">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item" title="Home"><a [routerLink]="['/dashboard']">Home</a>
                    </li>
                    <li class="breadcrumb-item active">Travel Expense</li>
                </ol>
            </div>
        </div>
        <div class="container-fluid element" id="element">
            <!-- /row -->
            <div class="col-md-12 col-sm-12">

                <div class="card filter-outer-main-box" style="z-index: 999;">
                    <div class="card-body ">
                        <div class="row">
                            <a (click)="openSidebar()" class="btn excel-btn-box results filter-onlick-btn"
                                style="padding-top: 9px;float:right;margin-right: 2rem;">Filter<i
                                    class="fa fa-filter"></i></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 ">
                    <div class="manage-list-row manage-pay-select clearfix list_view_de-box">
                        <div class="net-pay-section">
                            <div class="title-inn_box">
                                <span class="font-mm"><i class="fa fa-calendar-check-o" aria-hidden="true"
                                        style="color: green;"></i> </span> <span class="font-semibold font-mm">&nbsp;
                                    Approved </span>
                            </div>
                            <div class="row net-pay-data-without-bt">
                                <div class="col-md-12">
                                    <div class="text-uppercase font-ms payrun-label">Total :
                                        <strong>{{tot_approved}}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 ">
                    <div class="manage-list-row manage-pay-select clearfix list_view_de-box">
                        <div class="net-pay-section">
                            <div class="title-inn_box">
                                <span class="font-mm"><i class="fa fa-calendar-o" aria-hidden="true"
                                        style="color: #dbae00;"></i> </span> <span class="font-semibold font-mm">&nbsp;
                                    Pending </span>
                            </div>
                            <div class="row net-pay-data-without-bt">
                                <div class="col-md-12">
                                    <div class="text-uppercase font-ms payrun-label">Total :
                                        <strong>{{tot_pending}}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 ">
                    <div class="manage-list-row manage-pay-select clearfix list_view_de-box">
                        <div class="net-pay-section">
                            <div class="title-inn_box">
                                <span class="font-mm"><i class="fa fa-handshake-o" aria-hidden="true"
                                        style="color: green"></i> </span> <span class="font-semibold font-mm">&nbsp;
                                    Submitted </span>
                            </div>
                            <div class="row net-pay-data-without-bt">
                                <div class="col-md-6">
                                    <div class="text-uppercase font-ms payrun-label">Total :
                                        <strong>{{tot_submitted}}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- <div class="col-md-12">
                    <div class="card-header caded-innder-head-box">
                        <div class="col-sm-4 text-left">
                            <input type="text" class="form-control" value="" placeholder="Search"
                                (keyup)="search($event)" maxlength="100">
                        </div>
                        <div class="col-md-3 padd-0">
                            <input type="date" class="form-control" id="fromDate" [(ngModel)]="fromDate"
                                (change)="filterByDate()" />
                        </div>
                        <div class="col-md-3 padd-0">
                            <input type="date" class="form-control" id="toDate" [(ngModel)]="toDate"
                                (change)="filterByDate()" />
                        </div>
                        <div class="col-md-1 padd-0">
                            <button class="reset-button form-control" (click)="resetDateFilter()"
                                title="Reset Date Filter">
                                <i class="fa fa-undo" style="font-size:24px"></i>
                            </button>
                        </div>
                        <div class="col-sm-2 text-right">
                            <label style="font-size:14px;padding-top:14px; text-align:right;">Status</label>
                        </div>
                        <div class="col-sm-3 ">
                            <select class="wide form-control" (change)="changeStatusFilter($event.target.value)">
                                <option value="">All</option>
                                <option value="P">Pending</option>
                                <option value="A">Approved</option>
                                <option value="S">Submitted</option>
                            </select>
                        </div>
                    </div>
                </div> -->

                <div class="col-md-12 mrg-top-0 mrg-bot-25">
                    <div class="card">
                        <div class="card-body padd-bot-0 padd-top-0">
                            <div class="row">
                                <div class="col-md-12 padd-top-0">
                                    <div class="table-responsive bulk-attendance-outer-box Reimbursements-outer-box">
                                        <table class="table user-list">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Employee</th>
                                                    <th>Purpose</th>
                                                    <!-- <th>OU/Department</th> -->
                                                    <th>Place of Travel</th>
                                                    <th>Date of Travel</th>
                                                    <th>Mode of Travel</th>
                                                    <th>Travel Advance</th>
                                                    <th>Transportation</th>
                                                    <th>Accommodation</th>
                                                    <th>Created Date</th>
                                                    <th>Expense Status</th>
                                                    <th>Documents</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                <ng-container
                                                    *ngFor="let res of filter_travel_expense_list_data; let i=index;">
                                                    <tr>
                                                        <td>{{i+1}}</td>
                                                        <td>{{res.emp_name}}</td>
                                                        <td>{{res.purpose}}</td>
                                                        <!-- <td>{{res.department}}</td> -->
                                                        <td>{{res.place_of_travel_from}} - {{res.place_of_travel_to}}
                                                        </td>
                                                        <td style="min-width: 160px;">
                                                            {{convertDateFormat(res.date_of_travel_from)}} -
                                                            {{convertDateFormat(res.date_of_travel_to)}}</td>
                                                        <td>{{res.mode_of_travel}}</td>
                                                        <td>{{res.travel_adv_amount}}</td>
                                                        <td>{{res.transportation}}</td>
                                                        <td>{{res.accommodation}}</td>
                                                        <td>{{convertDateFormat(res.createdon)}}</td>
                                                        <td>
                                                            <!-- <span
                                                                [ngClass]="{'pend-btn-ved1': res.travel_expense_status=='P', 'appro-btn-ved': res.travel_expense_status=='A', 'sub-btn-ved': res.travel_expense_status=='S', 'appro-btn-ved1': res.travel_expense_status=='R'}"
                                                                class="appro-btn-ved">{{res.travel_expense_status ?
                                                                res.travel_expense_status === 'A' ? 'Approved' :
                                                                res.travel_expense_status === 'S' ? 'Submitted' :
                                                                res.travel_expense_status === 'R' ? 'Rejected' :
                                                                res.travel_expense_status === 'P' ? 'Pending' : '' : ''
                                                                }}
                                                            </span> -->
                                                            <span
                                                            [ngClass]="{'pend-btn-ved1': res.travel_expense_status=='P', 'appro-btn-ved': res.travel_expense_status=='A', 'sub-btn-ved': res.travel_expense_status=='S', 'appro-btn-ved1': res.travel_expense_status=='R'}"
                                                            class="appro-btn-ved">{{res.travel_expense_status ?
                                                                    res.travel_expense_status === 'A' ? 'Approved' :
                                                                    res.travel_expense_status === 'S' ? 'Submitted' :
                                                                    res.travel_expense_status === 'R' ? 'Rejected' :
                                                                    res.travel_expense_status === 'P' ? 'Pending' : '' : ''
                                                                    }}
                                                                <ng-container
                                                                    *ngIf="res.travel_expense_status=='P' && res.is_workflow_applied_exp=='Y'">
                                                                    <br>
                                                                    at level - {{res.wf_approval_cur_level_exp}}
                                                                </ng-container>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <i *ngIf="res.docment_file"
                                                                class="btn btn-primary  fa fa-eye"
                                                                (click)="togglePanel(i, res)"
                                                                title="Click to View details"
                                                                style="cursor: pointer;"></i>
                                                        </td>
                                                        <td>
                                                            <div class="icon-button-container">
                                                            <ng-container
                                                                *ngIf="(res.travel_expense_status=='P' || res.travel_expense_status=='S') && decoded_token.isEmployer=='1'">
                                                                <div class="dropdown float-right ember-view dropleft">
                                                                    <a class="dropdown-toggle no-caret text-muted cursor-pointer ember-view"
                                                                        data-toggle="dropdown" aria-haspopup="true"
                                                                        aria-expanded="false">
                                                                        <svg width="512" height="512"
                                                                            viewBox="0 0 512 512" class="icon">
                                                                            <path
                                                                                d="M162 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M256 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M350 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32"
                                                                                id="Path"></path>
                                                                            <path
                                                                                d="M256 480c123.712 0 224-100.288 224-224S379.712 32 256 32 32 132.288 32 256s100.288 224 224 224zm0 32C114.615 512 0 397.385 0 256S114.615 0 256 0s256 114.615 256 256-114.615 256-256 256z"
                                                                                id="Oval-1"></path>
                                                                        </svg>
                                                                    </a>
                                                                    <ul id="ember924" class="dropdown-menu ember-view"
                                                                        aria-labelledby="dropdownMenuButton">
                                                                        <li class="dropdown-item"
                                                                            (click)="openExpenseStatusModal(res, 'Approve')">
                                                                            Approve
                                                                        </li>
                                                                        <li class="dropdown-item"
                                                                            (click)="openExpenseStatusModal(res,'Reject')">
                                                                            Rejecte
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </ng-container>
                                                            <!-- <pre>{{ res | json }}</pre> -->
                                                            <ng-container
                                                                *ngIf="(res.travel_expense_status=='P' || res.travel_expense_status=='S') && decoded_token.isEmployer=='0' && check_level_cdn(res)">
                                                                <div class="dropdown float-right ember-view dropleft">
                                                                    <a class="dropdown-toggle no-caret text-muted cursor-pointer ember-view"
                                                                        data-toggle="dropdown" aria-haspopup="true"
                                                                        aria-expanded="false">
                                                                        <svg width="512" height="512"
                                                                            viewBox="0 0 512 512" class="icon">
                                                                            <path
                                                                                d="M162 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M256 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M350 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32"
                                                                                id="Path"></path>
                                                                            <path
                                                                                d="M256 480c123.712 0 224-100.288 224-224S379.712 32 256 32 32 132.288 32 256s100.288 224 224 224zm0 32C114.615 512 0 397.385 0 256S114.615 0 256 0s256 114.615 256 256-114.615 256-256 256z"
                                                                                id="Oval-1"></path>
                                                                        </svg>
                                                                    </a>
                                                                    <ul id="ember924" class="dropdown-menu ember-view"
                                                                        aria-labelledby="dropdownMenuButton">
                                                                        <li class="dropdown-item"
                                                                            (click)="openExpenseStatusModal(res, 'Approve')">
                                                                            Approve
                                                                        </li>
                                                                        <li class="dropdown-item"
                                                                            (click)="openExpenseStatusModal(res,'Reject')">
                                                                            Rejecte
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </ng-container>
                                                            <a style="padding-bottom: 5px;" (click)="openCommentsPopup(res.action_comment_txt_exp)"><i
                                                            class="fa fa-comment fa-lg" aria-hidden="true"></i></a>

                                                            <!-- <a *ngIf="res.travel_expense_status ==='A' || res.travel_expense_status ==='R'" type="button" style="color:#ffffff;"
                                                            class="btn theme-bg btn-sm Generate-Bill-btn-inner"
                                                            (click)="openExpenseStatusModal(res, 'View')">View</a> -->
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr *ngIf="activePanel === i">
                                                        <td colspan="13">
                                                            <div class="panel-body Leave-Application-table-inner-box">
                                                                <div class="box-body">
                                                                    <table class="table table-lg table-hover">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>#</th>
                                                                                <th>Doc Type</th>
                                                                                <th>Doc URL</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr
                                                                                *ngFor="let ipd of res.docment_file; let j = index;">
                                                                                <td>{{ j + 1 }}</td>
                                                                                <td>
                                                                                    <strong>{{ ipd.doc_type }}</strong>
                                                                                </td>
                                                                                <td>
                                                                                    <a href="{{ ipd.doc_url }}"
                                                                                        target="_blank">View</a>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </ng-container>
                                                <tr *ngIf="filter_travel_expense_list_data.length==0">
                                                    <td class="no-data" colspan="13">No Data Found</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /#page-wrapper -->
    <app-footer></app-footer>

    <div class="modal sm" [@grooveState]="expenseStatusModal?'active':'inactive'" aria-labelledby="myModalLabel">
        <div [@dongleState]="expenseStatusModal?'active':'inactive'" class="modal-dialog">
            <div class="modal-content">
                <form [formGroup]="UpdateExpenseStatus_Form">
                    <div class="modal-header theme-bg">
                        <h4 class="modal-title">{{ approve_reject_title }} Status</h4>
                        <button type="button" class="close" (click)="closeStatusModal()" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12">
                                <input type="hidden" class="form-control" formControlName="travelId" id="travelId" />
                                <input type="hidden" class="form-control" formControlName="empCode" id="empCode" />
                                <input type="hidden" class="form-control" formControlName="travelStatus"
                                    id="travelStatus" />
                                <input type="hidden" class="form-control" formControlName="pre_travel_adv_amount"
                                    id="pre_travel_adv_amount" />

                            </div>
                            <ng-container *ngIf="mark_approval_status ==='A' && mark_approval_status !='R'">
                                <div class="col-sm-4 text-left">
                                    Approved Amount
                                </div>
                                <div class="col-md-8">
                                    <input type="text" class="form-control" formControlName="travelAdvAmount"
                                        id="travelAdvAmount" (input)="validateNumericFloat($event)" />
                                    <ng-container *ngIf="isvalidExpenseAmount" class="text-danger">
                                        <p class="text-danger">The approved amount should be less than or equal to the
                                            travel advance amount.</p>
                                    </ng-container>
                                </div>
                            </ng-container>
                            <div class="col-sm-4 text-left">
                                Remarks <span style="color: red;">*</span>
                            </div>
                            <div class="col-md-8">
                                <textarea class="form-control" formControlName="travelRemark"
                                    id="travelRemark"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button *ngIf="mark_approval_status" class="btn btn-primary" (click)="updateExpenseStatus()"
                            [disabled]="UpdateExpenseStatus_Form.invalid">submit</button>
                        <input type="button" class="btn btn-default" data-dismiss="modal" (click)="closeStatusModal()"
                            value="Cancel">
                    </div>
                </form>
            </div>
        </div>
    </div>

          <!------Comments Popup------>
  <div [@grooveState]="showCommentsPopup?'active':'inactive'" id="showCommentId" class="modal" style="z-index:1000;">
    <div [@dongleState]="showCommentsPopup?'active':'inactive'" class="modal-dialog"
      style="margin:auto auto auto auto;">
      <div class="modal-content" style="height:100%;margin-top:50px;width:75rem;margin-left:-5rem; overflow:auto;">

        <div class="modal-header theme-bg">
          <h4 class="modal-title">Comments</h4>
          <button type="button" class="close" aria-hidden="true" (click)="closeCommentsPopup()">&times;</button>
        </div>
        <div class="modal-body" style="overflow: auto;height: 32rem;">
          <div class="commet-outer-div">
            <ul>
              <ng-container *ngFor="let line of commentsData">
                <li [innerHtml]="line"></li>
                <br>
              </ng-container>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeCommentsPopup()" value="Close">
        </div>
      </div>
    </div>
  </div>
  <!------Comments Popup------>
   <!---SideBar--->
   <div id="sidebar" class="sidebar bg-dark text-white sidebar-menu_filter-box">
    <h3 class="filter-menu-header-text-box">Filter</h3>
    <!-- <button type="button" class="btn btn-user1 btn-round" (click)="resetFilter()">Clear</button>-->
    <a class="clear-box-btn" title="Clear Filter" (click)="resetFilter()">Clear</a>
    <button class="close-btn btn btn-danger1" (click)="closeSidebar()"><i class="fa fa-close"></i></button>
    <div class="sidebar-content-box">

        <!-- <div class="col-md-12 col-sm-12">
  <input type="text" [(ngModel)]="invKey_copy" [ngModelOptions]="{standalone: true}" placeholder="Search" maxlength="50"
    class="form-control wide-width" style="width: 100%;" maxlength="200">
</div> -->

        <div class="col-md-12 ">

            <div id="filterComponent">
                <div class="panel-group">

                    <div class="panel panel-default">
                        <div class="panel-heading panel_heading_gray  card-header" role="tab" id="headingOne2"
                            data-toggle="collapse" data-parent="#accordion2" href="#collapseOne2"
                            aria-expanded="false" aria-controls="collapseOne">
                            <h4>Travel Expense Filter <i class="fa fa-angle-down"></i></h4>
                        </div>
                        <div id="collapseOne2" class="panel-collapse collapse card-body in" role="tabpane2">
                            <div class="row">
                                <div class="col-sm-12">

                                    <div class="col-md-6">
                                        <input type="hidden" id="recdate" (click)="filterFromToDateLeads()">

                                        <span style="color:#000;">From Date</span>
                                        <input id="FromDate" class="form-control" type="text"
                                            style="cursor: pointer;" placeholder="dd-mm-yyyy" autocomplete="off"
                                            readonly>
                                    </div>
                                    <div class="col-md-6">
                                        <span style="color:#000;">To Date</span>
                                        <input id="ToDate" class="form-control" type="text" style="cursor: pointer;"
                                            placeholder="dd-mm-yyyy" autocomplete="off" readonly>
                                    </div>


                                    <div class="form-group">
                                        <label class="control-label col-sm-12">Status</label>
                                        <div class="col-sm-12 padd-0">
                                            <select class="wide form-control" [(ngModel)]="statusFilter_copy"
                                                [ngModelOptions]="{standalone: true}">
                                                <option value="">All</option>
                                                <option value="P">Pending</option>
                                                <option value="A">Approved</option>
                                                <option value="R">Rejected</option>
                                            </select>
                                        </div>
                                    </div>
<!-- *ngIf="decoded_token.isEmployer=='1'" -->
                                    <div class="form-group" >
                                        <label class="control-label col-sm-12">Organization Unit</label>
                                        <div class="col-sm-12 padd-0 userOrgUnit">

                                            <ng-multiselect-dropdown [placeholder]="'Select Organization Units'"
                                                [settings]="dropdownSettings" [data]="orgList"
                                                [(ngModel)]="orgName_copy" [ngModelOptions]="{standalone: true}">
                                            </ng-multiselect-dropdown>
                                            <!-- (onFilterChange)="getOrgUnitData()" -->

                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-12">Department</label>
                                        <div class="col-sm-12 padd-0 userOrgUnit">

                                            <ng-multiselect-dropdown [placeholder]="'Select Department'"
                                                [settings]="deptDropdownSettings" [data]="deptList"
                                                [(ngModel)]="deptName_copy" [ngModelOptions]="{standalone: true}">
                                            </ng-multiselect-dropdown>

                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="control-label col-sm-12">Designation</label>
                                        <div class="col-sm-12 padd-0 userOrgUnit">

                                            <ng-multiselect-dropdown [placeholder]="'Select Designation'"
                                                [settings]="desgDropdownSettings" [data]="desgList"
                                                [(ngModel)]="desgName_copy" [ngModelOptions]="{standalone: true}">
                                            </ng-multiselect-dropdown>
                                        </div>
                                    </div>




                                </div>


                            </div>
                        </div>
                    </div>



                </div>
            </div>

            <div class="text-center mrg-bot-25">
                <button type="button" class="btn btn-user1 btn-round btn-primary" (click)="change_sidebar_filter()"
                    id="btnSetFilter">
                    &nbsp;Apply</button>

            </div>
        </div>
    </div>
</div>
<!---SideBar--->