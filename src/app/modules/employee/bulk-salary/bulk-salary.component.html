<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>
<section>
    <div id="wrapper" [ngClass]="{'active': showSidebar==false}">
        <div class="fakeLoader"></div>
        <!-- Navigation -->

        <!-- Sidebar Navigation -->

        <div id="page-wrapper">
            <div class="row page-titles">
                <div class="col-md-5 align-self-center">
                    <h3 class="text-themecolor">Bulk Salary</h3>
                </div>
                <div class="col-md-7 align-self-center">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item" title="Home"><a [routerLink]="['/employees']">Employees</a></li>
                        <li class="breadcrumb-item active">Bulk Employee</li>
                    </ol>
                </div>
            </div>

              
            <div class="container-fluid">
                <!-- /row -->
                <div class="row">


                    <div class="col-md-12 mrg-top-25 mrg-bot-25">

                        <!-- General Information -->
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12" >
                                        <div class="col-md-12" *ngIf="excelToTableData.length==0">

                                            <h3>Bulk Salary Employee(s)</h3>
                                            <ul style="padding-left:10px;">
                                                <!-- (click)="exportToExcel()" -->
                                                <li>1. Please download our <a 
                                                        style="cursor: pointer;" target="_blank" title="Download Bulk Salary Employees sample file"
                                                        (click)="exportToExcel()">template</a> for Bulk Salary
                                                        Employees</li>
                                                <li>2. Edit this file in Excel, and add all your employees salary details.
                                                </li>
                                                <li>3. Save and upload this file below. Any other file will be rejected.
                                                </li>
                                                <!-- <li>4. Salary updates performed here will be effective from 1st of the current month, to add a custom effective date please use <a href="javascript:void()">bulk salary revision</a>.</li> -->
                                            </ul>
                                                
                                            <h3 class="mrg-top-15" >Template file instructions -</h3>

                                            <ul style="padding-left:10px ;">
                                                <li style="color: red;">1. Please do not add/remove columns & do not change any column names.</li>
                                                <li style="color: red;">2. Please ensure that the date values in this column are prefixed with an apostrophe ('). Do not remove the apostrophe (').
                                                    Make sure that the date format should be [DD/MM/YYYY].
                                                </li>
                                                <li style="color: red;">3. If there is no data for a particular cell, leave it empty. Don't enter "-", "NA", etc.
                                                </li>
                                                <li style="color: red;">4. Please enter Y for Yes and N for No.</li>                                            
                                                <!-- <li>7. <span class="text-info" style="font-weight: bold;"> Note .</span><span
                                                    style="color: rgba(136, 12, 253, 0.959); font-weight: 500;"> For bulk upload, Excel
                                                    files with maximum 50 records allowed at a time. If records are > 50, then split the
                                                    file and upload. </span>
                                                </li> -->
                                            </ul>
                                        </div>
                                        <div class="col-sm-6">
                                            <input type="file" 
                                                accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                                                name="employee_doc" class="allowed_jpg_jpeg_pdf form-control"
                                                id="salary_input" (change)="onFileChange($event)">
                                                
                                        </div>
                                        <div class="col-sm-6"  *ngIf="excelToTableData?.length!=0">
                                            <span style="float: left;cursor:pointer;" (click)="clearInput()" title="Clear"><a><i
                                                        class="fa fa-lg fa-refresh"></i></a></span>
                                                        <a  class="btn btn-danger" style="float: right;cursor:pointer;" 
                                                        (click)="removeErrorRecords()">Remove error record</a>
                                        </div>

                                        <div class="col-md-12" *ngIf="excelToTableData.length>0">
                                            <div class="card">
                                                <div class="card-body" style="overflow:auto;" id="style-2">
                                                    <table class="table table-bordered" *ngIf="!isSalaryCalculated || apiErrors[0]">
                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th *ngIf="isApiError" style="width: 20%;">Error</th>
                                                                <th>Employee Name</th>
                                                                <th>Org Emp code</th>
                                                                <th>TP Code</th>
                                                                <th>Mobile</th>
                                                                <th>Minwage State</th>
                                                                <th>Location Type <br> (Metro/Non Metro)</th>
                                                                <th>Salary Effective Date <br>(DD/MM/YYYY)</th>
                                                                <th>Salary Days Opted <br>(Y/N)</th>
                                                                <th>Salary Days <br>(22/26/30)</th>
                                                                <th>PF Cap Applied <br>(Y/N)</th>
                                                                <th>PF Opted <br>(Y/N)</th>
                                                                <th>ESIC Opted <br>(Y/N)</th>
                                                                <th>Professional Tax State Applicable?</th>
                                                                <th>LWF State Applicable?</th>
                                                                <th>CTC</th>
                                                                <th>Basic %</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr *ngFor="let data of excelToTableData;let i=index;"
                                                            [ngClass]="{'invalid-row':invalidRow[i]}">
                                                                <td>{{i+1}}</td>
                                                                <td *ngIf="isApiError" >{{apiErrors[i]}}</td>
                                                                <td>{{data.empName}}
                                                                    <small *ngIf="!data.isValidName">Name should contain only alphabets and spaces</small>
                                                                </td>
                                                                <td>{{data.orgEmpCode}}</td>
                                                                <td>{{data.tpCode}}</td>
                                                                <td>{{data.mobile}}
                                                                    <small *ngIf="!data.isValidMobile">Mobile number should be 10 digits long and valid</small>
                                                                </td>
                                                                <td>{{data.minwagesState}}
                                                                    <small *ngIf="!data.isValidMinWageSate">Minwage State should contain only alphabets and spaces</small>
                                                                </td>
                                                                <td>{{data.locationType}}
                                                                    <small *ngIf="!data.isValidLocationType">Location Type should contain only alphabets and spaces</small>
                                                                </td>
                                                                <td>{{data.salaryEffectiveDate}}
                                                                    <small *ngIf="!data.salaryEffectiveDate">Effective Date missing.</small>
                                                                    <small *ngIf="data.salaryEffectiveDate && !data.isValidDate">Date should be in DD/MM/YYYY format</small>
                                                                </td>
                                                                <td>{{data.salaryDaysOpted}}
                                                                    <small *ngIf="!data.salaryDaysOpted || (data.salaryDaysOpted!='Y' && data.salaryDaysOpted!='N')">Please write Y for Yes or N for No</small>
                                                                </td>
                                                                <td>{{data.salaryDays}}
                                                                    <small *ngIf="!data.isValidSalaryDays ">Please choose between 22/26/30 days</small>
                                                                </td>
                                                                <td>{{data.pfCapApplied}}
                                                                     <small *ngIf="!data.pfCapApplied || (data.pfCapApplied!='Y' && data.pfCapApplied!='N')"
                                                                     >Please write Y for Yes or N for No</small>
                                                                </td>
                                                                <td>{{data.pfOpted}}
                                                                     <small *ngIf="!data.pfOpted || (data.pfOpted!='Y' && data.pfOpted!='N')"
                                                                     >Please write Y for Yes or N for No</small>
                                                                </td>
                                                                <td>{{data.esicOpted}}
                                                                     <small *ngIf="!data.esicOpted || (data.esicOpted!='Y' && data.esicOpted!='N')"
                                                                     >Please write Y for Yes or N for No</small>
                                                                </td>
                                                                <td>{{data.professionalTaxStateApplicable}}
                                                                    <small *ngIf="!data.professionalTaxStateApplicable || (data.professionalTaxStateApplicable!='Y' && data.professionalTaxStateApplicable!='N')"
                                                                    >Please write Y for Yes or N for No</small>
                                                                </td>
                                                                <td>{{data.lwfStateApplicable}}
                                                                    <small *ngIf="!data.lwfStateApplicable || (data.lwfStateApplicable!='Y' && data.lwfStateApplicable!='N')" 
                                                                    >Please write Y for Yes or N for No</small>
                                                                </td>
                                                                <td>{{data.ctc}}
                                                                    <small *ngIf="!data.ctc">CTC cannot be empty</small>
                                                                    <small *ngIf="data.ctc && !data.isValidCTC">Please enter a valid CTC value (positive number only).</small>
                                                                </td>
                                                                <td>{{data.basicPercentage}} 
                                                                    <small [ngStyle]="{'text-danger': data.basicPercentage && (data.basicPercentage < 0 || data.basicPercentage >100)}"
                                                                        *ngIf="data.basicPercentage">{{data.basicPercentage < 0 || data.basicPercentage >100 ? 'Basic Percentage should be between 0 to 100':'' }}</small>
                                                                    <small *ngIf="!data.basicPercentage">Basic Percentage cannot be empty</small>    
                                                                    <small *ngIf="data.basicPercentage && !data.isValidBasic">Please enter a valid Basic Percentage.</small>    
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                   <table class="table table-bordered" *ngIf="isSalaryCalculated">
                                                        <thead>
                                                            <tr>
                                                                <th rowspan="2">Employee Name</th>
                                                                <th rowspan="2">TP Code</th>
                                                                <th colspan="4" style="text-align:center">Gross Salary</th>
                                                                <th colspan="7" styl e="text-align:center">Deductions</th>
                                                                <th rowspan="2">Salary Bucket Total</th>
                                                                <th rowspan="2">Salary In Hand</th>
                                                            </tr>
                                                            <tr>
                                                                <th>Basic</th>
                                                                <th>HRA</th>
                                                                <th>Allowances</th>
                                                                <th>Total</th>
                                                                <th>PF Employee</th>
                                                                <th>PF Employer</th>
                                                                <th>ESIC Employee</th>
                                                                <th>ESIC Employer</th>
                                                                <th>LWF Employee</th>
                                                                <th>LWF Employer</th>
                                                                <th>Professional Tax Applicable</th>
                                                        </thead>
                                                        <tbody>
                                                            <tr *ngFor="let salary of calculatedData;let i=index;">
                                                                <td>{{excelToTableData[i].empName}}</td>
                                                                <td>{{excelToTableData[i].tpCode}}</td>
                                                                <td>{{salary.basic}}</td>
                                                                <td>{{salary.hra}}</td>
                                                                <td>{{salary.allowances}}</td>
                                                                <td>{{+salary.basic + +salary.hra + +salary.allowances }}</td>
                                                                <td>{{salary.epf_employee}}</td>
                                                                <td>{{salary.epf_employer}}</td>
                                                                <td>{{salary.esi_employee}}</td>
                                                                <td>{{salary.esi_employer}}</td>
                                                                <td>{{salary.employeelwf}}</td>
                                                                <td>{{salary.employerlwf}}</td>
                                                                <td>{{get_pt_applicable(salary)}}</td>
                                                                <td>{{salary.ctc}}</td>
                                                                <td>{{salary.salary_in_hand}}</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-12" *ngIf="!isInvalidData && excelToTableData.length!=0">
                                            <button class="btn btn-primary" (click)="calculateSal()" *ngIf="!isSalaryCalculated">Calculate Salary</button>
                                            <button class="btn btn-primary" (click)="saveSalary()" *ngIf="isSalaryCalculated">Save Salary</button>
                                        </div>
                                    </div>
                                    </div>

                                </div>
                            </div>
                    </div>

                    <!-- <div *ngIf="isSaving" class="please-wait">
                        <i class="fa fa-spinner fa-spin fa-3x"></i>
                        <b>Please wait...</b>
                    </div> -->
                </div>


            </div>
                <!-- /row -->
        </div>
    </div>
</section>
<app-footer></app-footer>
