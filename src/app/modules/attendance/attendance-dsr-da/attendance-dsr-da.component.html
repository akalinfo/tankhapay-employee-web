<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>
<section>
  <div id="wrapper" [ngClass]="{'active':showSidebar}">
    <div class="fakeLoader"></div>
    <div id="page-wrapper">
      <div class="row page-titles">
        <div class="col-md-4 align-self-center">
          <h3 class="text-themecolor" style="font-size: 16px;"><a routerLink="/attendance/dsr-da"></a>&nbsp;&nbsp;DSR
            Days and Kilometers</h3>
        </div>
        <div class="col-md-8 align-self-center">
          <ol class="breadcrumb">
            <li class="breadcrumb-item" title="Attendance"><a [routerLink]="['/attendance']">Attendance</a></li>
            <li class="breadcrumb-item active">DSR Days and Kilometers</li>
          </ol>
        </div>
      </div>
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12 col-sm-12">
            <div class="card">
              <div class="card-header">
                <div class="row">
                  <div class="col-lg-12">


                    <div class="row">
                      <div class="col-md-2" style="text-align: left;">
                        <span style="font-weight: bold;">Month</span>

                        <select class="form-control" (change)="changeMonth($event)">

                          <option *ngFor="let ma of monthsArray" [selected]="month==ma.id" [value]="ma.id">
                            {{ma.month}}</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <span style="font-weight: bold;">Year</span>
                        <select class="form-control" (change)="changeYear($event)">
                          <option *ngFor="let ya of yearsArray" [selected]="year==ya" [value]="ya">{{ya}}
                          </option>
                        </select>
                      </div>
                      <div class="col-md-3">
                        <span style="font-weight: bold;"></span>
                        <div class="Marked-Manually-outer-box">
                          <input type="radio" id="manually" name="type" value="list" [(ngModel)]="DSRFormat"
                            (change)="change_format('list')">
                          <label for="manually">Show Records</label>
                          <input type="radio" id="excel" name="type" value="excel" [(ngModel)]="DSRFormat"
                            (change)="change_format('excel')">
                          <label for="excel"> Upload from Excel</label><br>
                        </div>
                      </div>
                      <div *ngIf="DSRFormat=='list'" class="col-md-3">
                        <span style="font-weight: bold;">Search</span>
                        <input type="text" class="form-control" value="" placeholder="Search" (keyup)="search()"
                          maxlength="100" [(ngModel)]="searchKey">

                      </div>
                      <div *ngIf="DSRFormat=='list'" class="col-md-1 text-right">
                        <br>
                        <i aria-hidden="true" class="fa fa-file-excel-o fa-2x" title="Download Report in Excel"
                          (click)="download_excel()"></i>
                      </div>
                    </div>

                  </div>
                </div>
                <div *ngIf="DSRFormat=='excel'" class="row">
                  <div class="col-md-11 col-md-offset-0 mrg-top-0 mrg-bot-1">
                    <!-- General Information -->
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-12 padd-bot-10 padd-top-10">
                            <h3>Bulk Upload DSR Days and Kilometers</h3>
                            <ul>
                              <li style="color: #ff0c0c;font-weight: 500;"
                                title="Click on template to download excel with list of employee">1. Please download the
                                latest <a (click)="getAttExcel()"
                                  style="font-weight: bold; cursor: pointer;">template</a>, with
                                the list of employee(s)</li>
                              <li>2. Edit this file in Excel, and add the per_month_unit and unit_type.
                              </li>
                              <li>3. Do not change any employee details already present in the template. This includes
                                <b style="font-size: 1.2rem; color: #ff0c0c; font-weight: 500;"> the following columns -
                                  Employee, tpayrefno, OrgEmpCode, Mobile, Month, Year
                                </b>
                              </li>


                            </ul>

                            <h3 class="mrg-top-15">Template file instructions -</h3>

                            <ul>
                              <li>1. There is a list of employees with tpayrefno and orgempcode.
                                Please fill in the data accordingly.</li>
                              <li>2. Please do not add/remove columns.</li>
                              <li>3. Please enter the per_month_unit and data_type.</li>
                              <li>4. Please enter valid values for column name unit_type are
                                <strong>km-distance</strong> or
                                <strong>dsr-days</strong>.
                              </li>
                              <!-- <li>5. <span class="text-info" style="font-weight: bold;"> Note .</span><span
                                  style="color: rgba(136, 12, 253, 0.959); font-weight: 500;"> For bulk deduction, Excel
                                  files with maximum 50 records allowed at a time. If records are > 50, then split the
                                  file and upload. </span>
                              </li> -->
                            </ul>
                            <div class="col-sm-10 mrg-bot-15 mrg-top-15" title="Bulk Deduction Upload.">
                              <input type="file"
                                accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
                                name="deduction_excel" class="allowed_jpg_jpeg_pdf form-control" id="deduction_excel"
                                (change)="onFileChange($event)">
                            </div>
                            <div class="col-sm-2 mrg-bot-15 mrg-top-15">
                              <button type="button" class="btn btn-secondary" (click)="clear_file()"
                                style="border-color: black;">Clear</button>
                            </div>

                          </div>
                        </div>
                      </div>


                    </div>

                    <div class="card" *ngIf="excelToTableData.length>0">
                      <span style="text-align: left; color: blue;font-weight: bold;"> Total Records :
                        {{excelToTableData.length}}</span>
                      <span *ngIf="!show_bulk_upload_btn" style="color: red;margin-left: 2rem;"> Error: Some records in the uploaded Excel file are incorrect. Please correct them and try uploading again. The upload button will only be visible when all records are marked in green
                        again</span>

                      <div class="card-body" style="overflow:auto;">

                        <table class="table table-bordered">
                          <thead>
                            <tr>
                              <th><strong>Employee</strong></th>
                              <th><strong>Tpay Refno</strong></th>
                              <th><strong>Org Emp Code</strong></th>
                              <th><strong>Mobile</strong></th>
                              <th><strong>Month</strong></th>
                              <th><strong>Year</strong></th>
                              <th><strong>Per Month Unit</strong></th>
                              <th><strong>Unit Type</strong></th>
                            </tr>
                          </thead>

                          <tbody>
                            <ng-container *ngFor="let et of excelToTableData">
                              <tr [ngStyle]="{'color': et.rowColor == false ? 'red' : 'green'}">
                                <td>{{et.employee}}</td>
                                <td>{{et.tpayrefno}}</td>
                                <td>{{et.personid}}</td>
                                <td>{{et.mobile}}</td>
                                <td>{{et.month}}</td>
                                <td>{{et.year}}</td>
                                <td>{{et.per_month_unit}}</td>
                                <td>{{et.unit_type}}</td>
                              </tr>
                            </ng-container>
                          </tbody>
                        </table>
                      </div>

                    </div>

                    <div *ngIf="(excelToTableData.length>0 && show_bulk_upload_btn)"
                      class="col-md-12 col-12 padd-top-20 text-center">
                      <button class="btn btn-primary btn-lg" (click)="uploadExcelBulkAtt()"><i
                          class="fa fa-upload fa-lg">
                        </i> Save Att DSR</button>
                    </div>

                  </div>
                </div>

                <div *ngIf="DSRFormat=='list'" class="row">
                  <div class="col-md-12">
                    <div class="card">
                      <div class="card-body">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                          <strong class="text-right">Total : {{jivo_DSRDA_data.length}}</strong>
                          <div class="table-responsive reports-table-outer-box reports-new-table-outer-box">

                            <table class="table table-striped table-bordered" style="font-size: 11px;">

                              <thead style="background: skyblue;">
                                <tr>
                                  <th>S.No</th>
                                  <th>Month-Year</th>
                                  <th>Employee Name</th>
                                  <th>TPay Refno</th>
                                  <th>OrgEmpCode</th>
                                  <th>Per Month Unit</th>
                                  <th>Unit Type</th>
                                  <th>Is Processed</th>
                                  <th>Processed Date</th>
                                  <th>Uploaded Date</th>
                                  <th>Modefied Date</th>
                                </tr>
                              </thead>

                              <tbody style="background: aliceblue;">
                                <ng-container *ngFor="let jd of jivo_DSRDA_data;let i=index;">
                                  <tr [ngClass]="{'light-skyblue': i % 2 == 0, 'white': i % 2 != 0}">
                                    <td>{{i+1}}</td>
                                    <td>{{convert_Num_to_Month(jd.month, jd.year)}} -{{jd.year}}</td>
                                    <td>{{!jd.emp_name?'Not Found':jd.emp_name}}</td>
                                    <td>{{jd.tpayrefno}}</td>
                                    <td>{{jd.personid}}</td>
                                    <td>{{jd.days_per_month}}</td>
                                    <td>{{jd.data_type}}</td>
                                    <td>{{jd.is_processed}}</td>
                                    <td>{{jd.processed_dt}}</td>
                                    <td>{{jd.created_date}}</td>
                                    <td>{{jd.modefied_date}}</td>
                                  </tr>
                                </ng-container>
                              </tbody>
                            </table>
                            <alert></alert>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
    <!-- /#page-wrapper -->


  </div>
</section>
<app-footer></app-footer>