<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>
<section>
    <div id="wrapper" [ngClass]="{'active': showSidebar == false}">
        <div class="fakeLoader"></div>


        <div id="page-wrapper">

            <div class="row page-titles">
                <div class="col-md-5 align-self-center">
                    <h3 class="text-themecolor">Check-In/Check-Out Report</h3>
                </div>
                <div class="col-md-7 align-self-center">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a [routerLink]="['/reports']">Reports</a></li>
                        <li class="breadcrumb-item active">Check-In/Check-Out Report</li>
                    </ol>
                </div>
            </div>



            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 col-sm-12">

                        <div class="card filter-outer-main-box" style="z-index: 999;">
                            <div class="card-body ">
                                <div class="row">
                                    <form [formGroup]="checkin_Form">
                                        <div class="col-md-1 col-sm-1 text-right padd-0">
                                            <div class="form-group">
                                                <h3>Filter By :</h3>

                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <input id="ToDate" #rd class="form-control" type="text"
                                                    style="cursor: pointer;" formControlName="ToDate"
                                                    placeholder="dd-mm-yyyy" autocomplete="off" readonly>
                                            </div>
                                        </div>

                                        <div class="col-md-2 padd-0">
                                            <div class="form-group">
                                                <select id="markedDropdown" class="form-control"
                                                    formControlName="markedStatus">
                                                    <option value="Marked">Marked</option>
                                                    <option value="Not Marked">Not Marked</option>
                                                    <option value="All">All</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-1 padd-0">
                                            <a class="btn excel-btn-box results btn-primary"
                                                style="padding: 9px; border-radius: 0;" (click)="synced_punches()">
                                                <i class="fa fa-search" aria-hidden="true"></i>
                                            </a>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 col-sm-12">
                        <div class="card" style="white-space: nowrap;">
                            <div class="card-header">
                                <div class="row">

                                    <div class="col-md-12 col-sm-12">

                                        <div class="row">
                                            <!-- <div class="col-sm-12"> -->
                                            <!-- <div class="col-sm-2"></div> -->
                                            <div class="col-md-3">
                                                <span><strong>Check-In: {{ this.tot_check_in }} </strong></span>
                                            </div>
                                            <div class="col-md-3">
                                                <span><strong>Check-Out: {{ this.tot_check_out }} </strong></span>
                                            </div>
                                            <div class="col-md-3">
                                                <span><strong>Total:{{ this.employee_data.length }} </strong></span>
                                            </div>
                                            <div class="col-md-3 col-sm-3">
                                                <div class="Show-Fields-top-outer-box" style="float: right;">
                                                    <div class="dropdown float-right-box">
                                                        <a class="btn btn-round btn-success excel-btn-box"
                                                            style="padding-top: 9px;" (click)="exportToExcel()">&nbsp;<i
                                                                class="fa fa-file-excel-o" aria-hidden="true"></i></a>

                                                        <a class="btn btn-round btn-success pdf-btn-box"
                                                            (click)="exportToPdf()">&nbsp;<i class="fa fa-file-pdf-o"
                                                                aria-hidden="true"></i></a>

                                                    </div>
                                                </div>
                                            </div>


                                        </div>

                                    </div>

                                </div>
                            </div>
                            <!-- <div class="card-body" *ngIf="this.employee_data.length!=0"> -->
                            <!-- <ul class="list"> -->

                            <!-- <li class="manage-list-row manage-pay-select clearfix"
                    *ngFor="let emp of employee_data; let i = index">
                   -->

                            <!-- <div class="row"> -->
                            <!-- <div class="col-sm-3">
                        <div class="job-info" (click)="getEmp_code(emp,i)" style="cursor: pointer;"
                          title="Click to View Details">
                          <div class="profile-container">
                            <img src="{{emp.photopath}}" class="attachment-thumbnail" alt="user-images"
                              *ngIf="(emp.photopath != '' && emp.photopath != null)">
                            <div class="profile-img-box" *ngIf="(emp.photopath == '' || emp.photopath == null)">
                              <span>{{emp.emp_name.charAt(0)}}{{emp.emp_name.charAt(emp.emp_name.indexOf(' ') +
                                1)}}</span>
                            </div>
                          </div>
                          <div class="job-details">
                            <h5 class="job-name"><a class="job_name_tag" (click)="getEmp_code(emp,i)"
                                style="cursor: pointer;">{{emp.emp_name}}</a></h5>
                          </div>
                        </div>
                      </div> -->
                            <!-- <div class="col-sm-3"  >
                        <div class="job-company" ><strong>In Time:</strong> <span [ngClass]="{'has-time': emp.check_in_time!='00:00'}"> {{emp.check_in_time}}</span></div>
                        <br>
                        <div class="job-company" ><i class="fa fa-map-marker" aria-hidden="true"></i>
                          &nbsp; {{emp.check_in_location}}</div>
                      </div> -->
                            <!-- <div class="col-sm-3" >

                        <div class="job-company"  ><strong>Out Time:</strong> <span [ngClass]="{'has-time': emp.check_out_time!='00:00'}"> {{emp.check_out_time}}</span></div>
                        <br>
                        <div class="job-company"> <i class="fa fa-map-marker" aria-hidden="true"></i> &nbsp;
                          {{emp.check_out_location}}
                        </div> -->

                            <!-- <div class="job-company">
                              <button (click)="getEmp_code(emp,i)" class="btn">
                                <i class="fa fa-arrow-circle-right" style="font-size:36px"></i>
                              </button>
                            </div> -->


                            <!-- <div class="placeholder-image" style="display:none;" data-v-b4b8095a="">
                          <div class="placeholder-image__bg" data-v-b4b8095a=""></div>
                        </div>

                      </div> -->
                            <!-- <div class="col-md-3">
                        <div class="job-company"><strong>Hrs :</strong>{{emp.no_of_hours_worked}}</div>
                      </div> -->
                            <!-- </div> -->
                            <!-- </li> -->
                            <!-- </ul> -->
                            <!-- </div> -->
                            <div class="card-body padd-bot-0 padd-top-0" *ngIf="this.employee_data.length!=0">

                                <div class="row">
                                    <div class="col-md-12 padd-top-0">
                                        <div
                                            class="table-responsive bulk-attendance-outer-box Reimbursements-outer-box reports-main-outerbox-table">

                                            <table class="table user-list">
                                                <thead style="background: skyblue;">
                                                    <tr>
                                                        <th>Sr. No.</th>
                                                        <th>TPCode</th>
                                                        <th>Employee Code</th>
                                                        <th>Employee Name</th>

                                                        <th>Designation</th>

                                                        <th>Source</th>
                                                        <th>Check In Time</th>
                                                        <th>Check Out Time</th>
                                                        <th>Total Hours</th>
                                                        <th>Shift Name</th>
                                                        <th>Auto Assign Shift</th>
                                                        <th>Night Shift</th>
                                                        <th>Break </th>
                                                        <th>Department</th>
                                                        <th>Organisation Unit</th>
                                                        <th>Geofence Name</th>
                                                        <!-- *ngIf="sso_admin_id !=''" -->
                                                        <th *ngIf="this.sso_admin_id !=''">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <ng-container *ngFor="let emp of employee_data; let i = index">
                                                        <tr>
                                                            <td>{{i+1}}</td>
                                                            <td title="View attendance between two dates">
                                                                <h5 class="job-name">
                                                                    <a class="job_name_tag" style="cursor: pointer;"
                                                                        (click)="getEmp_code(emp,i)">{{emp.tpcode}}</a>
                                                                </h5>
                                                            </td>
                                                            <td> {{emp.orgempcode }}</td>
                                                            <td title="View Multiple Check-In / Check-Out">
                                                                <h5 class="job-name">
                                                                    <a [disabled]="emp.check_in_out_details == undefined || emp.check_in_out_details.length==0"
                                                                        (click)="openPanel(i, emp)" class="job_name_tag"
                                                                        style="cursor: pointer;">{{emp.emp_name}}</a>
                                                                </h5>
                                                            </td>

                                                            <td>{{emp.designation}}</td>

                                                            <td>{{emp.attendance_type}}</td>
                                                            <td>
                                                                <div class="punchin-Button-job-company-box">
                                                                    <strong>{{emp.check_in_time}} </strong>
                                                                    <div class="location-addre-box"
                                                                        *ngIf="emp.check_in_location && emp?.check_in_time !='00:00'">
                                                                        <a>
                                                                            <i aria-hidden="true"
                                                                                class="fa fa-map-marker"></i>
                                                                            <span class="hover-location-addre-box">
                                                                                <div class="profile-container">
                                                                                    <img src="{{emp?.check_in_image_path }}"
                                                                                        class="attachment-thumbnail"
                                                                                        alt="user-images"
                                                                                        *ngIf="(emp?.check_in_image_path != '' && emp?.check_in_image_path != null && emp?.check_in_time !='00:00')"
                                                                                        (click)="getCheckInImage(emp?.check_in_image_path)"
                                                                                        href="#Check_in"
                                                                                        data-toggle="modal"
                                                                                        data-placement="top">
                                                                                </div>
                                                                                {{emp?.check_in_location}}
                                                                            </span>
                                                                            <!-- <span class="hover-location-addre-box">{{emp.check_in_location}}</span> -->
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </td>

                                                            <td>
                                                                <div class="punchin-Button-job-company-box">
                                                                    <strong>{{emp.check_out_time}} </strong>
                                                                    <div class="location-addre-box"
                                                                        *ngIf="emp.check_out_location && emp?.check_out_time !='00:00'">
                                                                        <a>
                                                                            <i aria-hidden="true"
                                                                                class="fa fa-map-marker"></i>
                                                                            <span class="hover-location-addre-box">
                                                                                <div class="profile-container">
                                                                                    <img src="{{emp?.check_out_image_path }}"
                                                                                        class="attachment-thumbnail"
                                                                                        alt="user-images"
                                                                                        *ngIf="(emp?.check_out_image_path != '' && emp?.check_out_image_path != null && emp?.check_out_time !='00:00')"
                                                                                        (click)="getCheckInImage(emp?.check_out_image_path)"
                                                                                        href="#Check_in"
                                                                                        data-toggle="modal"
                                                                                        data-placement="top">
                                                                                </div>
                                                                                {{emp.check_out_location}}
                                                                            </span>
                                                                            <!-- <span class="hover-location-addre-box">{{emp.check_out_location}}</span> -->
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td title="View Total Hours">
                                                                <h5 class="job-name">
                                                                    <ng-container
                                                                        *ngIf="emp.no_of_hours_worked !== '00:00' && emp.no_of_hours_worked !== undefined; else noHours">
                                                                        <a (click)="open_new_Panel(i, emp)"
                                                                            class="job_name_tag"
                                                                            style="cursor: pointer;">
                                                                            {{ emp.no_of_hours_worked }}
                                                                        </a>
                                                                    </ng-container>
                                                                    <ng-template #noHours>
                                                                        <strong>{{ emp.no_of_hours_worked }}</strong>
                                                                    </ng-template>
                                                                </h5>
                                                            </td>

                                                            <td>{{emp.shift_name}}</td>
                                                            <td>{{emp.is_auto_shift_assign}}</td>
                                                            <td>{{emp.is_night_shift}}</td>
                                                            <td>{{formatBreakTotalTime(emp.break_total_time)}}</td>
                                                            <td> <span class="show-me-text"
                                                                    title="{{emp.department}}">{{emp.department}}</span>
                                                            </td>
                                                            <td> <span class="show-me-text"
                                                                    title="{{emp.assigned_ou_ids_names}}">{{emp.assigned_ou_ids_names}}</span>
                                                            </td>
                                                            <td> <span class="show-me-text"
                                                                    title="{{emp.assigned_geofence_ids_names}}">{{emp.assigned_geofence_ids_names}}</span>
                                                            </td>
                                                            <!-- *ngIf="this.sso_admin_id !='' " -->
                                                            <td *ngIf="this.sso_admin_id !=''"> <a
                                                                    (click)="reprocess_punches(emp.emp_code)"
                                                                    title="Re-process the attendance again if intime or outtime not correct"
                                                                    style="cursor :pointer;">
                                                                    <i class="fa fa-refresh" aria-hidden="true"></i>
                                                                </a>
                                                                <!-- this.sso_admin_id !='' && -->
                                                            </td>
                                                        </tr>

                                                        <tr id="collapseOne{{i}}" class="panel-collapse collapse"
                                                            role="tabpanel" aria-labelledby="designing">
                                                            <td colspan="8">

                                                                <div>

                                                                    <div
                                                                        class="panel-body Check-In-Check-Out-table-inner-box">
                                                                        <div class="box-body">


                                                                            <table class="table table-lg table-hover">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th>In Time</th>
                                                                                        <th>Out Time</th>
                                                                                        <th>Hrs</th>
                                                                                        <th>Source</th>
                                                                                        <th>Check-In Geofence</th>
                                                                                        <th>Check-Out Geofence</th>
                                                                                        <!-- <th>Meeting Name</th>
                                            <th>Meeting Feedback</th> -->


                                                                                    </tr>
                                                                                </thead>

                                                                                <tbody>


                                                                                    <ng-container
                                                                                        *ngFor="let ipd of innerPanelData.check_in_out_details; let j=index;">
                                                                                        <tr>
                                                                                            <td>
                                                                                                <div
                                                                                                    class="punchin-Button-job-company-box">
                                                                                                    <strong>{{ipd.check_in_time}}
                                                                                                    </strong>

                                                                                                    <div class="location-addre-box"
                                                                                                        *ngIf="ipd.check_in_location">
                                                                                                        <a>
                                                                                                            <i aria-hidden="true"
                                                                                                                class="fa fa-map-marker"></i>
                                                                                                            <span
                                                                                                                class="hover-location-addre-box">
                                                                                                                <div
                                                                                                                    class="profile-container">
                                                                                                                    <img src="{{ipd?.check_in_image_path }}"
                                                                                                                        class="attachment-thumbnail"
                                                                                                                        alt="user-images"
                                                                                                                        *ngIf="(ipd?.check_in_image_path != '' && ipd?.check_in_image_path != null)"
                                                                                                                        (click)="getCheckInImage(ipd?.check_in_image_path)"
                                                                                                                        href="#Check_in"
                                                                                                                        data-toggle="modal"
                                                                                                                        data-placement="top">
                                                                                                                </div>
                                                                                                                {{ipd?.check_in_location}}
                                                                                                            </span>

                                                                                                        </a>
                                                                                                    </div>

                                                                                                </div>
                                                                                            </td>
                                                                                            <td>
                                                                                                <div
                                                                                                    class="punchin-Button-job-company-box">
                                                                                                    <strong>{{ipd.check_out_time}}
                                                                                                    </strong>

                                                                                                    <div class="location-addre-box"
                                                                                                        *ngIf="ipd.check_out_location">
                                                                                                        <a>
                                                                                                            <i aria-hidden="true"
                                                                                                                class="fa fa-map-marker"></i>
                                                                                                            <span
                                                                                                                class="hover-location-addre-box">
                                                                                                                <div
                                                                                                                    class="profile-container">
                                                                                                                    <img src="{{ipd?.check_out_image_path }}"
                                                                                                                        class="attachment-thumbnail"
                                                                                                                        alt="user-images"
                                                                                                                        *ngIf="(ipd?.check_out_image_path != '' && ipd?.check_out_image_path != null)"
                                                                                                                        (click)="getCheckOutImage(ipd?.check_out_image_path)"
                                                                                                                        href="#Check_in"
                                                                                                                        data-toggle="modal"
                                                                                                                        data-placement="top">
                                                                                                                </div>
                                                                                                                {{ipd?.check_out_location}}
                                                                                                            </span>

                                                                                                        </a>
                                                                                                    </div>

                                                                                                </div>
                                                                                            </td>
                                                                                            <td>{{ipd.no_of_hours_worked}}
                                                                                            </td>
                                                                                            <td>{{ipd.attendance_type}}
                                                                                            </td>
                                                                                            <td>{{ipd.check_in_geofence_id_name}}
                                                                                            </td>
                                                                                            <td>{{ipd.check_out_geofence_id_name}}
                                                                                            </td>
                                                                                            <!-- <td>{{ipd.meeting_name}} </td>
                                              <td>{{ipd.meeting_feedback}} </td> -->



                                                                                        </tr>
                                                                                    </ng-container>



                                                                                </tbody>
                                                                                <tfoot>
                                                                                    <tr>

                                                                                        <th> </th>
                                                                                        <th></th>
                                                                                        <th class="text-right"> Total
                                                                                            Hrs: </th>
                                                                                        <th>{{innerTotalHrsWorked}}
                                                                                        </th>
                                                                                        <th> </th>
                                                                                        <th></th>
                                                                                        <!-- <th colspan="2"></th> -->
                                                                                    </tr>
                                                                                </tfoot>


                                                                            </table>

                                                                        </div>
                                                                    </div>


                                                                </div>


                                                            </td>
                                                        </tr>

                                                        <!-- New table box for attendance policy column by Arpit -->
                                                        <tr id="CollapseOne{{i}}" class="panel-collapse collapse"
                                                            role="tabpanel" aria-labelledby="designing">
                                                            <td colspan="7">

                                                                <div>

                                                                    <div
                                                                        class="panel-body Check-In-Check-Out-table-inner-box">
                                                                        <div class="box-body">


                                                                            <table class="table table-lg table-hover">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th>Is Overtime Applicable</th>
                                                                                        <th>No Of Overtime Hours Worked
                                                                                        </th>
                                                                                        <th>Deviation In Checkin</th>
                                                                                        <th>Deviation In Checkout</th>
                                                                                        <th>Deviation In Total Working
                                                                                            Hours</th>
                                                                                    </tr>
                                                                                </thead>

                                                                                <tbody>



                                                                                    <tr>
                                                                                        <td>{{is_overtime_applicable}}
                                                                                        </td>
                                                                                        <td>{{no_of_overtime_hours_worked}}
                                                                                        </td>
                                                                                        <td>{{deviation_in_checkin}}
                                                                                        </td>
                                                                                        <td>{{deviation_in_checkout}}
                                                                                        </td>
                                                                                        <td>{{deviation_in_total_working_hours}}
                                                                                        </td>


                                                                                    </tr>



                                                                                </tbody>


                                                                            </table>

                                                                        </div>
                                                                    </div>


                                                                </div>


                                                            </td>
                                                        </tr>
                                                        <!-- New table box for attendance policy column by Arpit -->

                                                    </ng-container>


                                                </tbody>
                                                <!-- <tfoot>
                          <tr>
                            <th colspan="12">Check-In: {{ this.tot_check_in}} </th>
                            <th colspan="12">Check-Out: {{ this.tot_check_out}} </th>
                            <th colspan="12">Total: {{ this.employee_data.length}} </th>
                          </tr>
                        </tfoot> -->
                                                <tfoot>
                                                    <tr>
                                                        <th colspan="12">
                                                            <div style="display: flex; justify-content: space-between;">
                                                                <span>Check-In: {{ this.tot_check_in }}</span>
                                                                <span>Check-Out: {{ this.tot_check_out }}</span>
                                                                <span>Total: {{ this.employee_data.length }}</span>
                                                            </div>
                                                        </th>
                                                    </tr>
                                                </tfoot>

                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <alert></alert>
                    </div>
                    <!-- Please Wait Loader -->
                    <div *ngIf="loading || !(data)" class="overlay">
                        <div class="please-wait">
                            <i class="fa fa-spinner fa-spin fa-3x"></i>
                            <b>Please wait...</b>
                        </div>
                    </div>
                    <!-- Loader -->
                </div>
            </div>


        </div>

        <!-- Check-in Image Popup -->

        <div id="Check_in" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header theme-bg">
                        <h4 class="modal-title">Check in Image</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="row text-center">
                            <img src="{{ pop_imgcheck_in_image_path }}" class="attachment-thumbnail large-image"
                                alt="user-images"
                                *ngIf="(pop_imgcheck_in_image_path != '' && pop_imgcheck_in_image_path != null)">
                        </div>
                    </div>


                </div>
            </div>
        </div>


        <!-- check-out Image Popup -->
        <div id="Check_out" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header theme-bg">
                        <h4 class="modal-title">Check out Image</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="row text-center">
                            <img src="{{ pop_check_out_image_path }}" class="attachment-thumbnail large-image"
                                alt="user-images"
                                *ngIf="(pop_check_out_image_path != '' && pop_check_out_image_path != null)">
                        </div>
                    </div>


                </div>
            </div>
        </div>

    </div>

</section>

<app-footer></app-footer>