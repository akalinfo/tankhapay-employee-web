<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>

<section>
  <div id="wrapper" [ngClass]="{'active': showSidebar==false}">
    <div class="fakeLoader"></div>

    <div id="page-wrapper">
      <div class="row page-titles">
        <div class="col-md-5 align-self-center">
          <h3 class="text-themecolor" style="margin-left: 10px;">Leave Taken and Balance</h3>
        </div>
        <div class="col-md-7 align-self-center">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a [routerLink]="['/reports']">Reports</a></li>

            <li class="breadcrumb-item active">Leave Taken and Balance</li>
          </ol>
        </div>
      </div>

      <div class="container-fluid element" id="element">
        <!-- /row -->
        <div class="row">
          <!--  add filter by pankaj dated. 24.04.2025-->
          <div class="col-md-12 col-sm-12">

            <div class="card filter-outer-main-box" style="z-index: 999;">
              <div class="card-body ">
                <div class="row">
                  <a (click)="openSidebar()" class="btn excel-btn-box results filter-onlick-btn"
                    style="padding-top: 9px;float:right;margin-right: 2rem;">Search<i class="fa fa-filter"></i></a>
                </div>
              </div>
            </div>
          </div>
          <!-- end -->


          <div class="col-md-12 mrg-top-0 mrg-bot-25">
            <div class="card filter-outer-main-box">
              <div class="card-header">
                <div class="row">
                  <div class="col-md-3">
                    <input type="text" width="200px" placeholder="Search" class="form-control"
                      (keyup)="search($event)" />&nbsp;&nbsp;
                  </div>

                  <div class="col-md-2">
                    <span style="font-weight: bold">Total:
                      {{ this.employee_leave_balance_data.length }}</span>
                  </div>
                  <div class="col-md-3" style="float: right">
                    <div class="Show-Fields-top-outer-box">
                      <div class="dropdown float-right-box">
                        <a class="btn btn-round btn-success excel-btn-box" style="padding-top: 9px;"
                          style="float: right;" (click)="exportToExcel()">&nbsp;<i class="fa fa-file-excel-o"
                            aria-hidden="true"></i></a>
                      </div>
                    </div>
                  </div>

                </div>
              </div>

              <div class="card-body padd-bot-0 padd-top-0">

                <div class="row">

                  <div class="col-md-12 padd-top-0">
                    <div
                      class="table-responsive bulk-attendance-outer-box Reimbursements-outer-box reports-main-outerbox-table"
                      id="leaveBalanceReport">

                      <table class="table table-hover table_fixed" id="leaveBalanceReportTable">
                        <thead class="TB_fxd">
                          <tr class="ZPLHRow">
                            <!-- Main Employee Header -->
                            <!-- <th>#</th> -->

                            <th class="colM1_sticky">Employee Name</th>
                            <!-- <th class="colM1_sticky">Email</th> -->
                            <th class="colM1_sticky">Org Unit Name</th>
                            <!-- Dynamic table headers based on leave types -->
                            <ng-container *ngFor="let leaveType of leave_appl_list_data">
                              <!-- Header for each leave type -->
                              <th class="P0I TBrdr TBrdr-Rgt" style="text-align: center;">
                                <table class="table leave-taken-table-box">
                                  <tbody>
                                    <tr>
                                      <th colspan="2" class="text-center B1" width="8.333333333333334%">
                                        {{leaveType.typename }} </th>
                                    </tr>
                                    <tr>
                                      <th class="text-center" width="8.333333333333334%"> Taken
                                      </th>
                                      <th class="text-center" width="8.333333333333334%">
                                        Balance
                                      </th>
                                    </tr>
                                  </tbody>
                                </table>
                                <!-- <br>
                                                <span class="paddcheck"> Taken </span>| <span
                                                   class="paddcheck">Balance</span> -->
                              </th>

                            </ng-container>
                            <th>Vendor Name </th>
                            <th>Project Name </th>
                            <th>Salary Book Project </th>
                          </tr>

                        </thead>

                        <tbody>
                          <tr *ngFor="let employee of filteredEmployees; let i = index" class="Report_row ZPLRow CP">

                            <td name="employee" class="fxdtd P_AM colM1_sticky">
                              <h5 class="job-name emp-name-blue">
                                <div class="job-img">
                                  <img *ngIf="employee.employee_detail.employee_photo"
                                    [src]="employee.employee_detail.employee_photo" class="attachment-thumbnail"
                                    alt="user-images">
                                  <div *ngIf="!employee.employee_detail.employee_photo"
                                    class="img-responsive txt circular-name" alt="user">
                                    {{ employee.employee_detail.emp_name.charAt(0) }}{{
                                    employee.employee_detail.emp_name.charAt(employee.employee_detail.emp_name.indexOf('
                                    ') + 1) }}
                                  </div>
                                </div>
                                <span>
                                  <a title="Click for leave history" (click)="get_leave_taken_history(employee)"
                                    style="cursor: pointer;">
                                    {{employee.employee_detail.emp_name}} [{{employee.employee_detail.orgempcode ||
                                    employee.employee_detail.cjcode}}]
                                  </a>
                                </span>
                              </h5>
                              <span>
                                {{ employee?.employee_detail?.email }}
                              </span>
                            </td>

                            <td>{{ employee?.employee_detail?.assignedous }}</td>
                            <td *ngFor="let leave of employee.balanceTxt" class="P0I TBrdr TBrdr-Rgt"
                              style="text-align: center;">
                              <table class="table leave-taken-table-inner-box">
                                <tbody>
                                  <tr>
                                    <td class="text-center"><span class="paddcheck">{{leave.leave_taken}}</span></td>
                                    <td class="text-center"><span class="paddcheck">{{leave.cur_bal}}</span></td>
                                  </tr>
                                </tbody>
                              </table>
                            </td>
                            <td>{{ employee?.employee_detail?.vendor_name }}</td>
                            <td>{{ employee?.employee_detail?.project_name }}</td>
                            <td>{{ employee?.employee_detail?.salary_book_project }}</td>
                          </tr>
                        </tbody>


                      </table>
                    </div>



                  </div>




                </div>

                <div class="flexbox padd-10" *ngIf="filteredEmployees.length >limit">
                  <div class="flexbox padd-10">
                    <pagination-controls (pageChange)="get_page($event)"
                      style="font-size: 2rem;padding: 6px;font-weight: bold" class="float-right"></pagination-controls>
                  </div>
                </div>
              </div>



            </div>
          </div>
        </div>

      </div>

    </div>
  </div>
</section>

<!-----Employee Leave History------->
<div class="modal contract-search-popup-box Contract-Panel-box" id="emp_history"
  [@grooveState]="showEmpHistory ? 'active' : 'inactive'" aria-labelledby="myModalLabel1">
  <div [@dongleState]="showEmpHistory ? 'active' : 'inactive'" class="modal-dialog modal-xl"
    style="width: 100rem; height: 50vh">
    <form>
      <div class="modal-content" id="Milestone-Mapping">
        <div class="modal-header theme-bg">
          <h4 style="color: white">
            <a title="Close" type="button" class="btn-close2" (click)="closeEmpHistory()">
              <i class="fa fa-window-close" style="color: #fff"></i>
            </a>&nbsp;{{employee_name}} Leave Taken History
          </h4>
        </div>

        <div *ngIf="currentEmp?.balance_txt?.length > 0" class="modal-body">
          <div class="row" style="height: 4rem;">
            <div class="col-md-12">
              <div class="col-md-8">
                <strong>Current Leave Balance :</strong>
                <ng-container *ngFor="let bt of currentEmp?.balance_txt;">
                  <span>
                    {{bt?.type_code}} - {{bt?.cur_bal}} &nbsp;
                  </span>
                </ng-container>
              </div>

              <div class="col-md-3">
                <strong>Total Leave Balance :</strong> &nbsp;
                <span>{{get_tot_leave_balance()}}</span>
              </div>

              <div class="col-md-1">
                <a (click)="downloadExcel()" style="cursor: pointer" *ngIf="leaveHistoryData?.length > 0"><i
                    class="fa fa-2x fa-file-excel-o"></i></a>
              </div>

            </div>
          </div>
        </div>

        <div class="modal-body" style="margin-top: -25px;">
          <div class="row" style="overflow: auto; height: 30rem;">
            <div style="margin: 0 16px; overflow: auto">
              <table class="table table-hover table-bordered" border="1">
                <thead style="background: skyblue">
                  <tr>
                    <th style="font-size: 14px">Month-Year</th>
                    <th style="font-size: 14px">Template Name</th>
                    <th style="font-size: 14px; width: 40rem;">Leave Taken</th>
                    <!-- <th style="font-size: 14px">Total Leave</th> -->
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let lhd of leaveHistoryData;">
                    <tr>
                      <td>{{lhd.att_date_txt}}</td>
                      <td>{{lhd.template_name}}</td>
                      <td>
                        {{lhd.tot_leave_taken}}
                        (
                        <ng-container *ngFor="let x of lhd.leave_taken_txt;">
                          <span>{{x.typecode}} - {{x.leave_taken}}</span> &nbsp;
                        </ng-container>
                        )
                      </td>
                      <!-- <td>
                        {{lhd.tot_leave_taken}}
                      </td> -->
                    </tr>

                  </ng-container>
                </tbody>
              </table>
            </div>
          </div>

          <div class="modal-footer" style="background: white">
            <!-- <button class="btn btn-primary">
              submit
            </button> -->
            <button title="Close" class="btn btn-close btn-danger" (click)="closeEmpHistory()">
              Close
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
<!-----Employee Leave History------->

<!---SideBar  added by pankaj dated. 24.04.2025--->
<div id="sidebar" class="sidebar bg-dark text-white sidebar-menu_filter-box">
  <h3 class="filter-menu-header-text-box">Filter</h3>
  <!-- <button type="button" class="btn btn-user1 btn-round" (click)="resetFilter()">Clear</button>-->
  <a class="clear-box-btn" title="Clear Filter" (click)="resetFilter()">Clear</a>
  <button class="close-btn btn btn-danger1" (click)="closeSidebar()"><i class="fa fa-close"></i></button>
  <div class="sidebar-content-box">

    <div class="col-md-12 ">

      <div id="filterComponent">
        <div class="panel-group">

          <div class="panel panel-default">
            <div class="panel-heading panel_heading_gray  card-header" role="tab" id="headingOne2"
              data-toggle="collapse" data-parent="#accordion2" href="#collapseOne2" aria-expanded="false"
              aria-controls="collapseOne">
              <h4>Daily Leave Report Filter <i class="fa fa-angle-down"></i></h4>
            </div>
            <div id="collapseOne2" class="panel-collapse collapse card-body in" role="tabpane2">
              <div class="row">
                <div class="col-sm-12">
<!-- *ngIf="decoded_token.isEmployer=='1'" -->
                  <div class="form-group"  style="margin-top: 40px;">
                    <label class="control-label col-sm-12">Organization Unit</label>
                    <div class="col-sm-12 padd-0 userOrgUnit">
                      <ng-multiselect-dropdown [placeholder]="'Select Organization Units'" [settings]="dropdownSettings"
                        [data]="orgList" [(ngModel)]="orgName_copy" [ngModelOptions]="{standalone: true}">
                      </ng-multiselect-dropdown>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="control-label col-sm-12">Department</label>
                    <div class="col-sm-12 padd-0 userOrgUnit">
                      <ng-multiselect-dropdown [placeholder]="'Select Department'" [settings]="deptDropdownSettings"
                        [data]="deptList" [(ngModel)]="deptName_copy" [ngModelOptions]="{standalone: true}">
                      </ng-multiselect-dropdown>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="control-label col-sm-12">Designation</label>
                    <div class="col-sm-12 padd-0 userOrgUnit">
                      <ng-multiselect-dropdown [placeholder]="'Select Designation'" [settings]="desgDropdownSettings"
                        [data]="desgList" [(ngModel)]="desgName_copy" [ngModelOptions]="{standalone: true}">
                      </ng-multiselect-dropdown>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>



        </div>
      </div>

      <div class="text-center mrg-bot-25" style="margin-top: 10px;">
        <button type="button" class="btn btn-user1 btn-round btn-primary" (click)="change_sidebar_filter()"
          id="btnSetFilter">
          &nbsp;Apply</button>

      </div>
    </div>
  </div>
</div>
<!---SideBar end --->