<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>

<section>
  <div id="wrapper" [ngClass]="{'active': showSidebar==false}">
    <div class="fakeLoader"></div>

    <div id="page-wrapper">
      <div class="row page-titles">
        <div class="col-md-5 align-self-center">
          <h3 class="text-themecolor">Payouts</h3>
        </div>
        <div class="col-md-7 align-self-center">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a [routerLink]="['/dashboard']">Dashboard</a></li>

            <li class="breadcrumb-item active">Payouts</li>
          </ol>
        </div>
      </div>
      <div class="container-fluid">
        <div class="row">

          <div class="col-md-12 col-sm-12">
            <div class="card">
              <div class="card-header">
                <div class="row">
                  <!--div class="col-md-4 col-sm-4">
										<input type="text" class="form-control wide-width" placeholder="Search and Type" maxlength="100"/>
									  </div payout_history days_left-->
                  <div class="col-md-3 col-sm-3">
                    <strong>Total Number of Employees :</strong>
                    {{ this.payoutDetailSummary[0]?.totalemployees }}<br>

                    <strong>Days Left to Payout :</strong>
                    {{ this.payoutDetailSummary[0]?.days_left }}

                  </div>
                  <div class="col-md-3 col-sm-3">
                    <strong>Status :</strong>
                    {{this.payoutDetailSummary[0]?.status}}<br>

                    <strong>Payout Date :</strong>
                    {{this.payoutDetailSummary[0]?.payoutdate1}}
                  </div>

                  <div class="col-md-2 col-sm-2">
                    <div class="top-right-outer-box">
                      <!-- <span style="margin: 1.0rem;font-weight: bold;">Month - Year</span> -->
                      <select class="form-control" style="margin: 0.2rem; width: 150px;" (change)="changeMonth($event)">
                        <option value="">Select Month</option>
                        <option *ngFor="let item of master_data" [value]="item.monthnumber">
                          {{ item.monthname }}
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-2">
                    <div class="top-right-outer-box">

                      <!-- <a (click)="openSendNotificationPopup()"  class="btn btn-secondary manage-btn" style="padding-top: 9px;border-color: lightblue;" title="Create Ticket"><i class="fa fa-plus"></i> Ticket
                        </a>  &nbsp;
                        <div class="header-notification-box">
                          <a class="dropdown-toggle notification-show" (click)="Get_Tickets()">
                            <i class="ti-bell"></i>
                            <span *ngIf="unread_query_cnt_data && unread_query_cnt_data.unread_tickets && unread_query_cnt_data.unread_tickets !='0'" class="email-notify noti-count">{{unread_query_cnt_data.unread_tickets}}</span>
                          </a>
                        </div> -->
                      <!-- <a (click)="Get_Tickets()" class="btn btn-primary" style="padding-top: 9px;"  title="View notification"><i class="fa fa-eye"></i> notification</a> -->


                    </div>

                  </div>
                  <div class="col-md-2 col-sm-2" style="float: right;text-align: right;">
                    <a *ngIf="monthSelected" (click)="openSidebar()" class="btn excel-btn-box results filter-onlick-btn"
                      style="padding-top: 9px;">Filter<i class="fa fa-filter"></i></a>
                  </div>

                  <!-- <div class="col-md-4 col-sm-4" style="margin-top: 0.8rem;">
										<button class="btn btn-primary" style="float: right;" [routerLink]="['/payouts/payout_history']">Payout History</button>
									</div>									 -->

                </div>
              </div>


              <div class="card-body" *ngIf="stepNo == '2'">

                <div class="col-lg-12 col-md-12 col-sm-12">
                  <div class="table-responsive reports-table-outer-box reports-new-table-outer-box"
                    style=" overflow-x: visible;">

                    <table class="table table-striped table-bordered ">
                      <thead style="background: skyblue;">
                        <tr>
                          <th>
                            <input type="checkbox" [(ngModel)]="selectAllChecked" (change)="selectAll($event)"
                              class="large-checkbox" *ngIf="payoutDetail.length"
                              [disabled]="(payout_mode_type == 'self' && payoutDetailSummary[0]?.status == 'Completed')" />
                          </th>
                          <th>Name</th>
                          <th>Pay Days</th>

                          <!-- comment on 05.06.2205 <th *ngIf="this.payout_mode_type!='self'">Amount</th>
                          <th *ngIf="this.payout_mode_type=='self'">CTC</th>
                          <th *ngIf="this.payout_mode_type=='self'">Net Pay</th> -->

                          <th *ngIf="this.payout_mode_type!='self'">Amount</th>
                          <th *ngIf="this.payout_mode_type=='self'">CTC</th>
                          <th>Net Pay</th>

                          <th>Status</th>
                          <!-- && this.payout_mode_type!='self' -->
                          <th *ngIf="this.payoutDetailSummary[0]?.status != 'Completed' && !(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear ==
													 this.payoutDetailSummary[0]?.mpryear)">Action </th>

                        </tr>
                      </thead>
                      <tbody style="background: aliceblue;">
                        <ng-container *ngFor="let payout of payoutDetail; let i = index">
                          <tr [ngClass]="{'light-skyblue': i % 2 == 0, 'white': i % 2 != 0}">
                            <td>
                              <input type="checkbox" [(ngModel)]="payout.checked" (change)="onCheckboxChange(payout)"
                                class="large-checkbox" *ngIf="payout.paystatus !== 'Paid'"
                                [disabled]="(payout_mode_type == 'self' && payoutDetailSummary[0]?.status == 'Completed')" />
                            </td>
                            <td>{{payout.emp_name}}</td>
                            <td>{{payout.paiddays}}</td>

                            <td>
                              <i class="fa fa-inr" aria-hidden="true"></i> {{
                              payout.amount }}
                              <a *ngIf="payout.appointment_status_id === '14'" style="color: rgb(253, 26, 26);">
                                <b>(Restructure Mode)</b>
                              </a>
                            </td>
                            <td>{{payout.nepay}}</td>
                            <td>
                              <ng-container
                                *ngIf="payout.paystatus=='Paid' && payout.approvalstatus=='Approved'; else dropdownContent">
                                <span style="color: rgb(33, 203, 233);"> Paid</span>
                              </ng-container>
                              <ng-template #dropdownContent>
                                <select class="form-control status-btn-box" [(ngModel)]="payout.approvalstatus"
                                  (change)="onApprovalStatusChange(i, payout)"
                                  [disabled]="payout_mode_type == 'self' && payoutDetailSummary[0]?.status == 'Completed'">
                                  <option value="Approved">Approved</option>
                                  <option value="Hold">Hold</option>
                                </select>
                              </ng-template>
                            </td>

                            <!-- && this.payout_mode_type!='self' -->
                            <td
                              *ngIf="this.payoutDetailSummary[0]?.status != 'Completed'  && !(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear ==
														  this.payoutDetailSummary[0]?.mpryear) && !(payout.paystatus=='Paid' && payout.approvalstatus=='Approved')">
                              <a *ngIf="payout.approvalstatus !== 'Hold'" data-toggle="modal"
                                class="btn btn-gary manage-btn emp-edit-btn-box12" data-placement="top" title="Edit"
                                (click)="openAllowDeductPopup(payout)"><i class="ti-pencil-alt"></i></a>
                            </td>
                            <td *ngIf="(payout.paystatus=='Paid' && payout.approvalstatus=='Approved') && this.payoutDetailSummary[0]?.status != 'Completed' && !(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear ==
                                                          this.payoutDetailSummary[0]?.mpryear)"> <span
                                style="color: rgb(33, 203, 233);"> Paid</span></td>




                          </tr>
                        </ng-container>
                        <tr *ngIf="payoutDetail.length==0">
                          <td colspan="5" style="text-align: center;">
                            <strong>No Data found</strong>
                          </td>
                        </tr>
                      </tbody>


                      <tfoot style="background: #ededed;" *ngIf="payoutDetail.length!=0">
                        <tr>

                          <th><b>Total Amount:</b></th>
                          <th> </th>
                          <th><b>â‚¹ {{this.payoutDetailSummary[0]?.amount}}</b> </th>



                          <th colspan="3">
                            <div class="job-buttons text-right">
                              <a class="btn btn-default manage-btn" *ngIf="checkedEmployees.length >0"
                                (click)="processSelected('Hold')">Hold</a>
                              <a class="btn btn-default manage-btn" *ngIf="checkedEmployees.length >0"
                                (click)="processSelected('Approved')">Approve</a>

                              <a *ngIf="(this.payout_mode_type === 'self' && (this.payoutDetailSummary[0]?.status != 'Low Balance' &&  !(this.payoutDetailSummary[0]?.status == 'Pending' && this.payoutDetailSummary[0]?.invoicevalue == 0))) && !button_status && (!(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear == this.payoutDetailSummary[0]?.mpryear)
													|| (this.payoutDetailSummary[0]?.days_left == 0)) && this.payoutDetailSummary[0]?.status != 'Completed' "
                                data-toggle="modal" data-placement="top" class="btn btn-primary manage-btn"
                                data-original-title="" title="" (click)="approve_popup()">Record Payment <i
                                  aria-hidden="true" class="fa fa-chevron-right"></i></a>

                              <!-- <a *ngIf="this.payout_mode_type === 'self' && button_status && !(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear ==
											 this.payoutDetailSummary[0]?.mpryear) && this.payoutDetailSummary[0]?.status != 'Completed' && !submit_button" data-toggle="modal" class="btn btn-primary manage-btn emp-edit-btn-box12" data-placement="top" title="Edit" (click)="open_record_popup()">Record Payment <i aria-hidden="true" class="fa fa-chevron-right"></i></a>    -->

                              <div class="dropdown float-right-box Download-Report-drop-btn"
                                *ngIf="this.payout_mode_type === 'self' && button_status && (!(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear == this.payoutDetailSummary[0]?.mpryear)
											 || (this.payoutDetailSummary[0]?.days_left == 0)) && report_button && this.payoutDetailSummary[0]?.status != 'Completed'">
                                <ul role="tablist" class="nav nav-pills">
                                  <li role="presentation" class="dropdown">
                                    <a data-toggle="dropdown" class="dropdown btn-round btn-primary"
                                      style="cursor: pointer;" aria-expanded="false">Download Reports <span
                                        class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                      <li><a [routerLink]="['/reports/pre-attendance']">Salary Advice</a></li>
                                      <li><a [routerLink]="['/reports/disbursement-report']">Disbursement Report</a>
                                      </li>
                                      <li> <a [routerLink]="['/reports/pay-summary']" data-toggle="modal"
                                          data-placement="top">Pay Slip</a> </li>
                                    </ul>
                                  </li>
                                </ul>
                              </div>

                              <div class="dropdown float-right-box Download-Report-drop-btn" *ngIf="this.payout_mode_type === 'self' && this.payoutDetailSummary[0]?.status == 'Completed'  && (!(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear == this.payoutDetailSummary[0]?.mpryear)
											 || (this.payoutDetailSummary[0]?.days_left == 0))">
                                <ul role="tablist" class="nav nav-pills">
                                  <li role="presentation" class="dropdown">
                                    <a data-toggle="dropdown" class="dropdown btn-round btn-primary"
                                      style="cursor: pointer;" aria-expanded="false">Download Reports <span
                                        class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                      <li><a [routerLink]="['/reports/pre-attendance']">Salary Advice</a></li>
                                      <li><a [routerLink]="['/reports/disbursement-report']">Disbursement Report</a>
                                      </li>
                                      <li> <a [routerLink]="['/reports/pay-summary']" data-toggle="modal"
                                          data-placement="top">Pay Slip</a> </li>
                                    </ul>
                                  </li>
                                </ul>
                              </div>

                            </div>
                          </th>

                          <th></th>


                        </tr>
                      </tfoot>



                    </table>

                    <div class="col-md-12 text-center large-text"
                      *ngIf="stepNo == '2' && payoutDetailSummary[0]?.status === 'Completed'"
                      [ngClass]="{'completed-status': true}">
                      <span><b>Status: Completed</b></span>
                    </div>
                    <alert></alert>
                  </div>
                </div>

              </div>


            </div>

          </div>

        </div>
      </div>
      <div *ngIf="monthChanged && !(payoutDetail && payoutDetail.length )" class="please-wait">
        <i class="fa fa-spinner fa-spin fa-3x"></i>
        <b>Please wait...</b>
      </div>
      <div class="col-md-12 col-sm-12 Reimbursement-outer-box " *ngIf="stepNo == '2'
		&& this.payoutDetailSummary[0]?.status !== 'Completed'
		&& (this.payout_mode_type != 'self'  || (this.payoutDetailSummary[0]?.status == 'Low Balance'  ))
		&& (!(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear == this.payoutDetailSummary[0]?.mpryear)
        || (this.payoutDetailSummary[0]?.days_left == 0))" style="overflow-x: auto;">
        <div class="row">


          <div class="col-md-3 mrg-top-25 mrg-bot-25">


            <div class="card">

              <div class="card-header">
                <h4>Current Balance </h4>

              </div>

              <div class="card-body" style=" height: 215px;">
                <div class="row">

                  <div class="col-md-12 padd-bot-15 padd-top-15">

                    <div class="col-sm-12">
                      <h1 class="Payment-due-outer-box1">â‚¹{{(customerSummary!=''?
                        customerSummary.balance:'0.00')}}</h1>
                    </div>

                  </div>

                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3 mrg-top-25 mrg-bot-25">


            <div class="card">

              <div class="card-header">
                <h4>Payout Amount </h4>

              </div>

              <div class="card-body" style="  height: 215px;">
                <div class="row">

                  <div class="col-md-12 padd-bot-15 ">

                    <div class="col-sm-12">
                      <h1 class="Payment-due-outer-box1">â‚¹ {{
                        this.payoutDetailSummary[0]?.amount}}</h1>
                    </div>
                    <div class="col-sm-12"
                      *ngIf="this.payoutDetailSummary[0]?.status === 'Low Balance' && this.payoutDetailSummary[0]?.invoicevalue == 0 && this.payoutDetailSummary[0]?.days_left == 0">
                      <table class="table noborder-table mrg-bot-0">
                        <tbody>
                          <tr>
                            <td class="payrun-label" style=" font-size: 11px; ">Service & GST Charges</td>

                          </tr>
                          <tr>

                            <td class="text-left"><strong>â‚¹{{ this.invoice_detail_data?.invoiceamount }}</strong></td>
                          </tr>
                          <tr>
                            <td class="payrun-label" style=" font-size: 11px; ">Total Amount</td>

                          </tr>

                          <tr>

                            <td class="text-left" style="font-size: large;"> <strong>â‚¹{{ this.total_Amount }}</strong>
                            </td>
                          </tr>


                        </tbody>
                      </table>

                    </div>

                    <div class="col-sm-12"
                      *ngIf="( this.payoutDetailSummary[0]?.status === 'Pending') && this.payoutDetailSummary[0]?.invoicevalue == 0 && this.payoutDetailSummary[0]?.days_left == 0 && this.payout_mode_type=='self' ">
                      <table class="table noborder-table mrg-bot-0">
                        <tbody>
                          <tr>
                            <td class="payrun-label" style=" font-size: 11px; ">Service & GST Charges</td>

                          </tr>
                          <tr>

                            <td class="text-left"><strong>â‚¹{{ this.invoice_detail_data?.invoiceamount }}</strong></td>
                          </tr>
                          <tr>
                            <td class="payrun-label" style=" font-size: 11px; ">Total Amount</td>

                          </tr>

                          <tr>

                            <td class="text-left" style="font-size: large;"> <strong>â‚¹{{ this.total_Amount }}</strong>
                            </td>
                          </tr>


                        </tbody>
                      </table>

                    </div>

                  </div>

                </div>
              </div>


            </div>
          </div>

          <div class="col-md-3 mrg-top-25 mrg-bot-25" *ngIf="this.payoutDetailSummary[0]?.days_left==0">


            <div class="card">

              <div class="card-header">
                <h4>Shortfall </h4>

              </div>

              <div class="card-body padd-top-0 " style=" height: 215px;">
                <div class="row">

                  <div class="col-md-12 padd-bot-15 padd-top-15">

                    <div class="col-sm-12">
                      <h5 class="Payment-due-outer-box1">
                        <!-- {{this.total_Amount|json}} -->
                        <input type="text" class="form-control Required-Balance-input-text"
                          [value]="formatAmount( this.total_Amount, customerSummary?.balance)" readonly>
                      </h5>
                      <p class="please-add-text-box ">Please add at least
                        <strong>{{ formatAmount( this.total_Amount,
                          customerSummary?.balance)
                          }}</strong>
                        to your account to proceed with your transaction.
                      </p>
                    </div>

                  </div>

                </div>
              </div>
            </div>
          </div>
          <!-- && this.payoutDetailSummary[0]?.days_left == 0 -->

          <div class="col-md-3 mrg-top-25 mrg-bot-25"
            *ngIf="stepNo == '2' && this.payoutDetailSummary[0]?.amount != '0' && this.payoutDetailSummary[0]?.days_left == 0  && this.payoutDetailSummary[0]?.status != 'Completed' ">
            <div class="card">

              <div class="card-header">
                <h4>Pay Now</h4>
              </div>
              <div class="card-body" style=" height: 215px;">
                <!-- <div class="row"> -->
                <div *ngIf="payoutDetailSummary && payoutDetailSummary.length > 0">
                  <div *ngFor="let payout of payoutDetailSummary; let i = index">
                    <!-- {{payoutDetail && (payout.status == 'Low Balance' || payout.status == 'Pending' || payout.status == 'PartiallyPending')&& isShortfallZero()|json}} -->

                    <div class="job-button"
                      *ngIf="payoutDetail && (payout.status == 'Low Balance' || payout.status == 'Pending')&& !isShortfallZero()">
                      <a class="btn btn-primary manage-btn emp-edit-btn-box12" data-toggle="tooltip"
                        data-placement="top"
                        (click)="addBalance(tb_account_id_ency,payout.amount,payout.totalemployees,payout.status)">Pay
                        Now
                        <i aria-hidden="true" class="fa fa-chevron-right"></i></a>
                      <p class="please-add-text-box" *ngIf="!isShortfallZero()" style="margin-top: 10px;"> &nbsp; &nbsp;
                        Your account balance is insufficient. Please add balance to make the payment.</p>
                    </div>
                    <div class="job-button"
                      *ngIf="payoutDetail && (payout.status == 'Low Balance')&& isShortfallZero()">
                      <a class="btn btn-primary manage-btn emp-edit-btn-box12" data-toggle="tooltip"
                        data-placement="top"
                        (click)="addBalance(tb_account_id_ency,payout.amount,payout.totalemployees,payout.status)">Pay
                        Now
                        <i aria-hidden="true" class="fa fa-chevron-right"></i></a>
                      <p class="please-add-text-box" *ngIf="!isShortfallZero()" style="margin-top: 10px;"> &nbsp; &nbsp;
                        Your account balance is insufficient. Please add balance to make the payment.</p>
                    </div>

                    <div class="job-button"
                      *ngIf="payoutDetail && (payout.status == 'PartiallyPending')&& !isShortfallZero()">
                      <a class="btn btn-primary manage-btn emp-edit-btn-box12" data-toggle="tooltip"
                        data-placement="top"
                        (click)="addBalance(tb_account_id_ency,payout.amount,payout.totalemployees,payout.status)">Pay
                        Now
                        <i aria-hidden="true" class="fa fa-chevron-right"></i></a>
                      <p class="please-add-text-box" *ngIf="!isShortfallZero()" style="margin-top: 10px;"> &nbsp; &nbsp;
                        Your account balance is insufficient. Please add balance to make the payment.</p>
                    </div>

                    <div class="job-button" *ngIf="(!payoutDetail)">
                      <a class="btn btn-blue manage-Update myButton-box" data-toggle="tooltip" data-placement="top"
                        (click)="PayoutDetails(payout)">Pay Now<i class="fa fa-chevron-right"
                          aria-hidden="true"></i></a>
                    </div>
                    <!-- && payout.days_left == 0 -->
                    <!-- {{payoutDetail && payout.status == 'Pending' && payout.days_left == 0 &&  payout.amount != '0' && isShortfallZero()|json}} -->
                    <div class="job-button"
                      *ngIf="payoutDetail && payout.status == 'Pending' && payout.days_left == 0 &&  payout.amount != '0' && isShortfallZero()">
                      <a class="btn btn-primary manage-btn emp-edit-btn-box12" (click)="submitPayButton(payout)">Make
                        Payout
                        <i aria-hidden="true" class="fa fa-chevron-right"></i>

                      </a>
                      <p class="please-add-text-box" *ngIf="!isShortfallZero()">&nbsp; &nbsp;
                        Your account balance is insufficient. Please add balance to make the payment.</p>
                    </div>
                    <!-- {{payoutDetail && payout.status == 'PartiallyPending' && payout.days_left == 0 &&  payout.amount != '0'|json}} -->
                    <div class="job-button"
                      *ngIf="payoutDetail && payout.status == 'PartiallyPending' && payout.days_left == 0 &&  payout.amount != '0' && isShortfallZero()">
                      <a class="btn btn-blue manage-Update myButton-box" (click)="submitPayButton(payout)">Make Payout
                        <i aria-hidden="true" class="fa fa-chevron-right"></i>
                      </a>
                      <p class="please-add-text-box" *ngIf="!isShortfallZero()">&nbsp; &nbsp;
                        Your account balance is insufficient. Please add balance to make the payment.</p>
                    </div>


                    <!-- </li> -->
                  </div>
                </div>
              </div>
              <!-- </div> -->
            </div>

          </div>

          <div class="col-md-3 mrg-top-25 mrg-bot-25"
            *ngIf="stepNo == '2' && this.payoutDetailSummary[0]?.days_left == 0  && this.payoutDetailSummary[0]?.status != 'Completed' && this.payoutDetailSummary[0]?.status != 'self' && this.payoutDetailSummary[0]?.amount == 0 && this.total_Amount > 0 ">
            <div class="card">
              <div class="card-header">
                <h4>Pay Now</h4>
              </div>
              <div class="card-body" style=" height: 215px;">
                <div *ngIf="payoutDetailSummary && payoutDetailSummary.length > 0">
                  <div *ngFor="let payout of payoutDetailSummary; let i = index">

                    <div class="job-button"
                      *ngIf="payoutDetail && payout.status == 'Low Balance' && payout.days_left == 0  ">
                      <a class="btn btn-primary manage-btn emp-edit-btn-box12" data-toggle="tooltip"
                        data-placement="top"
                        (click)="addBalance(tb_account_id_ency,payout.amount,payout.totalemployees,payout.status)">Pay
                        Now
                        <i aria-hidden="true" class="fa fa-chevron-right"></i></a>
                      <p class="please-add-text-box" *ngIf="!isShortfallZero()" style="margin-top: 10px;"> &nbsp; &nbsp;
                        Your account balance is insufficient. Please add balance to make the payment.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>


      <div class="col-md-12 col-sm-12 Reimbursement-outer-box " *ngIf="stepNo == '2'
				&& this.payoutDetailSummary[0]?.status !== 'Completed'
				&& (this.payout_mode_type == 'self'  &&  (this.payoutDetailSummary[0]?.status == 'Pending' && this.payoutDetailSummary[0]?.invoicevalue == 0))
				&& (!(this.currentMonth == this.payoutDetailSummary[0]?.mprmonth && this.currentYear == this.payoutDetailSummary[0]?.mpryear)
        		|| (this.payoutDetailSummary[0]?.days_left == 0))" style="overflow-x: auto;">
        <div class="row">


          <div class="col-md-3 mrg-top-25 mrg-bot-25">


            <div class="card">

              <div class="card-header">
                <h4>Current Balance </h4>

              </div>

              <div class="card-body" style=" height: 215px;">
                <div class="row">

                  <div class="col-md-12 padd-bot-15 padd-top-15">

                    <div class="col-sm-12">
                      <h1 class="Payment-due-outer-box1">â‚¹{{(customerSummary!=''?
                        customerSummary.balance:'0.00')}}</h1>
                    </div>

                  </div>

                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3 mrg-top-25 mrg-bot-25">


            <div class="card">

              <div class="card-header">
                <h4>Payout Amount </h4>

              </div>

              <div class="card-body" style="  height: 215px;">
                <div class="row">

                  <div class="col-md-12 padd-bot-15 ">

                    <div class="col-sm-12">
                      <h1 class="Payment-due-outer-box1">â‚¹ {{
                        this.payoutDetailSummary[0]?.amount}}</h1>
                    </div>

                    <div class="col-sm-12"
                      *ngIf="( this.payoutDetailSummary[0]?.status === 'Pending') && this.payoutDetailSummary[0]?.invoicevalue == 0 && this.payoutDetailSummary[0]?.days_left == 0 && this.payout_mode_type=='self' ">
                      <table class="table noborder-table mrg-bot-0">
                        <tbody>
                          <tr>
                            <td class="payrun-label" style=" font-size: 11px; ">Service & GST Charges</td>

                          </tr>
                          <tr>

                            <td class="text-left"><strong>â‚¹{{ this.invoice_detail_data?.invoiceamount }}</strong></td>
                          </tr>
                          <tr>
                            <td class="payrun-label" style=" font-size: 11px; ">Total Amount</td>

                          </tr>

                          <tr>

                            <td class="text-left" style="font-size: large;"> <strong>â‚¹{{ this.total_Amount }}</strong>
                            </td>
                          </tr>


                        </tbody>
                      </table>

                    </div>

                  </div>

                </div>
              </div>


            </div>
          </div>

          <div class="col-md-3 mrg-top-25 mrg-bot-25" *ngIf="this.payoutDetailSummary[0]?.days_left==0">


            <div class="card">

              <div class="card-header">
                <h4>Shortfall </h4>

              </div>

              <div class="card-body padd-top-0 " style=" height: 215px;">
                <div class="row">

                  <div class="col-md-12 padd-bot-15 padd-top-15">

                    <div class="col-sm-12">
                      <h5 class="Payment-due-outer-box1">
                        <!-- {{this.total_Amount|json}} -->
                        <input type="text" class="form-control Required-Balance-input-text"
                          [value]="formatAmount( this.total_Amount, customerSummary?.balance)" readonly>
                      </h5>
                      <p class="please-add-text-box ">Please add at least
                        <strong>{{ formatAmount( this.total_Amount,
                          customerSummary?.balance)
                          }}</strong>
                        to your account to proceed with your transaction.
                      </p>
                    </div>

                  </div>

                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 mrg-top-25 mrg-bot-25"
            *ngIf="stepNo == '2' && this.payoutDetailSummary[0]?.amount == '0' && this.payoutDetailSummary[0]?.days_left == 0  && this.payoutDetailSummary[0]?.status != 'Completed' && this.payout_mode_type == 'self'">
            <div class="card">

              <div class="card-header">
                <h4>Pay Now</h4>
              </div>
              <div class="card-body" style=" height: 215px;">
                <!-- <div class="row"> -->
                <div *ngIf="payoutDetailSummary && payoutDetailSummary.length > 0">
                  <div *ngFor="let payout of payoutDetailSummary; let i = index">
                    <!-- {{payoutDetail && (payout.status == 'Pending' && payout.invoicevalue == 0 ) && this.payout_mode_type == 'self'|json}} -->
                    <div class="job-button"
                      *ngIf="payoutDetail && (payout.status == 'Pending' && payout.invoicevalue == 0 ) && this.payout_mode_type == 'self'">
                      <a class="btn btn-primary manage-btn emp-edit-btn-box12" data-toggle="tooltip"
                        data-placement="top"
                        (click)="addBalance(tb_account_id_ency,payout.amount,payout.totalemployees,payout.status)">Pay
                        Now
                        <i aria-hidden="true" class="fa fa-chevron-right"></i></a>
                      <p class="please-add-text-box" *ngIf="!isShortfallZero()" style="margin-top: 10px;"> &nbsp; &nbsp;
                        Your account balance is insufficient. Please add balance to make the payment.</p>
                    </div>

                  </div>
                </div>
              </div>
            </div>

          </div>

          <div class="col-md-3 mrg-top-25 mrg-bot-25"
            *ngIf="stepNo == '2' && this.payoutDetailSummary[0]?.days_left == 0  && this.payoutDetailSummary[0]?.status != 'Completed' && this.payout_mode_type != 'self' && this.payoutDetailSummary[0]?.amount == 0 && this.total_Amount > 0 ">
            <div class="card">
              <div class="card-header">
                <h4>Pay Now</h4>
              </div>
              <div class="card-body" style=" height: 215px;">
                <div *ngIf="payoutDetailSummary && payoutDetailSummary.length > 0">
                  <div *ngFor="let payout of payoutDetailSummary; let i = index">

                    <div class="job-button"
                      *ngIf="payoutDetail && payout.status == 'Low Balance' && payout.days_left == 0  && isShortfallZero()">
                      <a class="btn btn-primary manage-btn emp-edit-btn-box12" data-toggle="tooltip"
                        data-placement="top"
                        (click)="addBalance(tb_account_id_ency,payout.amount,payout.totalemployees,payout.status)">Pay
                        Now
                        <i aria-hidden="true" class="fa fa-chevron-right"></i></a>
                      <p class="please-add-text-box" *ngIf="!isShortfallZero()" style="margin-top: 10px;"> &nbsp; &nbsp;
                        Your account balance is insufficient. Please add balance to make the payment.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>


    </div>
  </div>




</section>



<div class="modal" [ngStyle]="{'display':confirmPaymentPop?'block':'none'}" style="z-index: 2;">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Alert</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"
            (click)="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Do you want pay now ?</label>
          </div>

        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-danger" data-dismiss="modal" value="No" (click)="closeModal()">
          <input type="submit" class="btn btn-success" value="Yes" (click)="submitPaySalary()">
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit salary Popup by Arpit -->
<!--------Allowance & Deduction Popup-------->
<div [@grooveState]="showAllowDeductPopup?'active':'inactive'" id="allowanceDeduct" class="modal">
  <div [@dongleState]="showAllowDeductPopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form *ngIf="showAllowDeductPopup">
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Edit Salary</h4>
          <button type="button" class="close" (click)="closeAllowanceDeductPopup()" data-dismiss="modal"
            aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
          <div class="row">

            <form [formGroup]="allowanceDeductForm">

              <div class="col-md-12">
                <!-- <input id="adv_salary" type="radio" name="allowdeduct" [checked]="ad.type.value=='adv_salary'" (change)="allowDeductChange('adv_salary')">
				  <label for="adv_salary">Advance Salary</label> -->
                <!-- {{allowanceDeductForm.value | json}} -->
                <div class="col-md-12">
                  <input id="overtime" type="radio" name="allowdeduct" [checked]="ad.type.value=='overtime'"
                    (change)="allowDeductChange('overtime')">
                  <label for="overtime">Overtime </label>
                </div>

                <div class="col-md-12">
                  <input id="allowance" type="radio" name="allowdeduct" [checked]="ad.type.value=='allowance'"
                    (change)="allowDeductChange('allowance')">
                  <label for="allowance">Allowance </label>
                </div>
                <div class="col-md-12">
                  <input id="deduction" type="radio" name="allowdeduct" [checked]="ad.type.value=='deduction'"
                    (change)="allowDeductChange('deduction')">
                  <label for="deduction">Deduction </label>
                </div>

              </div>

              <div class="col-md-11">
                <input class="form-control" formControlName="value" placeholder="Enter Amount (in Rs.)">
              </div>

              <div class="col-md-12">
                <textarea rows="5" cols="70" formControlName="remarks" placeholder="Enter Remarks..."></textarea>
              </div>
            </form>


          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-info" (click)="saveAllowDeduct()">save</button>

          <button class="btn btn-cancel" (click)="closeAllowanceDeductPopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!--------Allowance & Deduction Popup-------->

<!-- Approve Payroll Popup By Arpit dated 15/05/24 -->
<div class="modal" [ngStyle]="{'display':open_approve_popup?'block':'none'}" style="z-index: 1;">
  <div class="modal-dialog ">
    <div class="modal-content">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Approve Payroll</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"
            (click)="close_approve_popup()">&times;</button>
        </div>
        <div class="modal-body">

          <p> You are about to approve this payroll for <strong>{{this.payoutDetailSummary[0]?.month_name}}</strong>.
            Once you approve it, you can make payments for all your employees on the paydate
            <strong>{{this.payoutDetailSummary[0]?.payoutdate1}}</strong>.
          </p>

        </div>

        <div class="modal-footer">
          <div *ngIf="payoutDetailSummary && payoutDetailSummary.length > 0">
            <div class="job-button" *ngFor="let payout of payoutDetailSummary; let i = index">
              <a class="btn btn-success" (click)="submit_Button(payout)">Submit and Approve</a>
              <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel"
                (click)="close_approve_popup()">
            </div>
          </div>


        </div>
      </form>
    </div>
  </div>
</div>

<!-- Record Payment Popup By Arpit dated 15/05/24-->

<div class="modal" [ngStyle]="{'display':record_popup?'block':'none'}">
  <div class="modal-dialog" style="max-height: 90vh; overflow-y: auto;">
    <div class="modal-content">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Record Payment</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"
            (click)="close_record_popup()">&times;</button>
        </div>
        <div class="modal-body col-sm-12">
          <form [formGroup]="payout_form">
            <div class="col-sm-12 mrg-bot-15">
              <p>You are about to record payment for this pay run.</p>
            </div>
            <div class="col-sm-12 mrg-bot-15">
              <div class="row">
                <label class="col-sm-4">Employee(s) paid on <span class="text-danger">*</span></label>
                <div class="col-sm-8">
                  <input id="FromDate2" #rd type="text" style="cursor: pointer;" class="form-control">
                </div>
              </div>
            </div>
            <div class="col-sm-12 mrg-bot-15">
              <div class="table-responsive reports-table-outer-box reports-new-table-outer-box">
                <table class="table table-striped table-bordered">
                  <thead>
                    <tr>
                      <th>Payment Mode</th>
                      <th>Employees</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <select class="form-control Payment-Mode-btn" formControlName="selected_payout_mode"
                          style="margin: 0.2rem; width: 133px;">
                          <option *ngFor="let mode of payment_mode_type" [value]="mode.id">
                            {{ mode.payment_type }}</option>
                        </select>
                      </td>
                      <td>{{checkedEmployees.length}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="col-lg-12 form-check">
            </div>

            <label class="form-check-label">
              <input id="ember695" class="ember-checkbox ember-view form-check-input" type="checkbox"
                formControlName="notificationCheckbox">
              <span class="font-medium"><b>App notification will be sent to the active employees to view the salary
                  slip</b></span> &nbsp;
              <span class="mr-1">
                <span id="ember696" class="tooltip-container ember-view">
                  <i class="fa fa-info-circle"></i>
                </span>
              </span>
            </label>
          </form>
          <!-- <div class="font-small mt-2 ml-n5 send-payslip-helptext">
						<div>An email with a link to view the payslip will be emailed to portal-enabled employees whereas the payslip will be attached along with the email for those who donâ€™t have the employee portal enabled.</div>
						<div class="media mt-5 send-payslip-portal-note">
							<div class="pr-4"><i class="fa fa-info-circle"></i> </div>
							<div class="media-body">Regardless of whether you choose to send payslip notification email or not, the payslip will be displayed in the ESS Portal once you record the payment.</div>
						  </div>
						</div> -->
        </div>
        <div class="modal-footer">
          <a class="btn btn-success" (click)="Record_Payment()">Submit</a>
          <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel"
            (click)="close_record_popup()">
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Search Filter Code  -->
<div id="sidebar" class="sidebar bg-dark text-white sidebar-menu_filter-box" [style.width]="sidebarWidth">
  <h3 class="filter-menu-header-text-box">Filter</h3>
  <a class="clear-box-btn" title="Clear Filter" style="float: right; cursor: pointer;" (click)="reset()">Clear</a>
  <button class="close-btn btn btn-danger1" (click)="closeSidebar()"><i class="fa fa-close"></i></button>
  <div class="sidebar-content-box">
    <form [formGroup]="searchForm">
      <div class="col-md-12 col-sm-12">
        <input type="text" placeholder="Search Employee(s)" formControlName="searchKeyword"
          class="form-control wide-width" style="width: 100%;" />
      </div>
      <div class="col-md-12 ">

        <div id="filterComponent">
          <div class="panel-group">

            <div class="panel panel-default">
              <div class="panel-heading panel_heading_gray  card-header" role="tab" id="headingOne2"
                data-toggle="collapse" data-parent="#accordion2" href="#collapseOne2" aria-expanded="false"
                aria-controls="collapseOne">
                <h4>Employees Filter <i class="fa fa-angle-down"></i></h4>
              </div>
              <div id="collapseOne2" class="panel-collapse collapse card-body in" role="tabpane2">
                <div class="row">
                  <div class="col-sm-12">
                    <div class="form-group">
                      <label class="control-label col-sm-12">Status</label>
                      <div class="col-sm-12 padd-0 userOrgUnit">
                        <select class="form-control " formControlName="statusoffilter">
                          <option value="">Select Status</option>
                          <option value="Approved">Approved</option>
                          <option value="Hold">Hold</option>
                          <option value="Paid">Paid</option>
                        </select>

                      </div>
                    </div>
                    <div class="form-group">
                      <label class="control-label col-sm-12">Organization Unit</label>
                      <div class="col-sm-12 padd-0 userOrgUnit">
                        <ng-multiselect-dropdown [placeholder]="'Select Organization Units'"
                          [settings]="dropdownSettings" [data]="unit_master_list_data" [(ngModel)]="selectedUnitId"
                          [ngModelOptions]="{standalone: true}">
                        </ng-multiselect-dropdown>
                        <!-- <select class="form-control" [(ngModel)]="selectedUnitId" >
								<option value="All">All Organization Units</option>
								<option *ngFor="let unit of unit_master_list_data" [value]="unit.unitname">
								  {{ unit.unitname }}
								</option>
							  </select> -->
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="control-label col-sm-12">Department</label>
                      <div class="col-sm-12 padd-0 userOrgUnit">
                        <ng-multiselect-dropdown [placeholder]="'Select Department'" [settings]="deptDropdownSettings"
                          [data]="department_master_list_data" [(ngModel)]="selectedDepartmentId"
                          [ngModelOptions]="{standalone: true}">
                        </ng-multiselect-dropdown>
                        <!-- <select class="form-control" [(ngModel)]="selectedDepartmentId" >
				  <option value="All">All Departments</option>
				  <option *ngFor="let department of department_master_list_data" [value]="department.posting_department">
					{{ department.posting_department }}
				  </option>
				</select> -->
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="control-label col-sm-12">Designation</label>
                      <div class="col-sm-12 padd-0 userOrgUnit">
                        <ng-multiselect-dropdown [placeholder]="'Select Designation'" [settings]="desgDropdownSettings"
                          [data]="role_master_list_data" [(ngModel)]="selectedDesignationId"
                          [ngModelOptions]="{standalone: true}">
                        </ng-multiselect-dropdown>
                        <!-- <select class="form-control" [(ngModel)]="selectedDesignationId">
				  <option value="All">All Designations</option>
				  <option *ngFor="let role of role_master_list_data" [value]="role.post_offered">
					{{ role.post_offered }}
				  </option>
				</select> -->
                      </div>
                    </div>

                  </div>

                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="text-center mrg-bot-25">
          <button type="button" class="btn btn-user2 btn-round btn-primary" style="color: #fff !important;"
            (click)="Apply_new_filter()"> &nbsp;Apply</button>
        </div>
      </div>
    </form>

  </div>
</div>
<!-- End of search filter code  -->





<!-----------Send Notification Popup-------->
<div [@grooveState]="showNotificationPopup?'active':'inactive'" id="sendNotification" class="modal"
  style="z-index:1000;">
  <div [@dongleState]="showNotificationPopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form [formGroup]="notificationForm">
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Send Notification
          </h4>
          <button type="button" class="close" aria-hidden="true" (click)="closeSendNotificationPopup()">&times;</button>
        </div>
        <div class="modal-body" style="height:25rem;">

          <div class="row" style="display: none;">
            <div class="col-md-4">
              <label>Subject :</label>
            </div>
            <div class="col-md-8">
              <select class="form-control" formControlName="subject_id">
                <option value="">Select</option>
                <option value="{{rmd.id}}" *ngFor="let rmd of ticketMasterData;">{{rmd?.tickettypename}}</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <label>Role</label>
            </div>
            <div class="col-md-8">
              <select class="form-control" formControlName="team" (change)="get_users_master()">
                <option value="">Select</option>
                <option value="{{rmd.role_id}}" *ngFor="let rmd of roles_master_data;">{{rmd.role_name}}</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <label>Users :</label>
            </div>
            <div class="col-md-8">
              <select class="form-control" formControlName="user_id">
                <option value="">Select</option>
                <option value="{{rmd.user_id}}" *ngFor="let rmd of user_by_role_id_data;">{{rmd.user_fullname}}
                </option>

              </select>
            </div>
          </div>


          <div class="row">
            <div class="col-md-4">
              <label>Message :</label>
            </div>
            <div class="col-md-8">
              <textarea style="width: 100%;" formControlName="query_comment"></textarea>
            </div>
          </div>

        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeSendNotificationPopup()" value="Cancel">
          <!-- <input type="submit" class="btn btn-success" (click)="createSupportRequest()" value="Confirm"> -->
          <input type="submit" class="btn btn-success" (click)="createTicket()" value="Confirm">
        </div>
      </form>
    </div>
  </div>
</div>
<!-----------Send Notification Popup-------->


<!--Tickets Table-->
<div [@grooveState]="showTicketsTable?'active':'inactive'" id="ticketsTbl" class="modal" style="z-index:1000;">
  <div [@dongleState]="showTicketsTable?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;width: 800px;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Notification
          </h4>
          <button type="button" class="close" aria-hidden="true" (click)="closeTicketsTable()">&times;</button>
        </div>
        <div class="modal-body" style="height:25rem;overflow: auto;">

          <table class="table" id="otherDeductionTable">
            <thead>
              <tr>
                <th>#</th>
                <th id="ember1089" class="sortable ember-view">
                  Ticket Id

                </th>
                <th id="ember1089" class="sortable ember-view">
                  Message

                </th>
                <th id="ember1089" class="sortable ember-view">
                  From User
                </th>
                <th id="ember1089" class="sortable ember-view">
                  To User
                </th>
                <!-- // <th id="ember1089" class="sortable ember-view">
         //   Name

         // </th>



         // <th id="ember1090" class="sortable header-role ember-view">
         //   Ticket Type

         // </th> -->
                <th id="ember1090" class="sortable header-role ember-view">
                  Created Date
                  <!---->
                </th>
                <th id="ember1090" class="sortable header-role ember-view">
                  Closing Date
                  <!---->
                </th>

                <th id="ember1090" class="sortable header-role ember-view">
                  Help & Support
                </th>

                <th id="ember1091" class="sortable ember-view">
                  Status
                  <!---->
                </th>
                <th id="ember1091" class="sortable ember-view">
                  Action
                  <!---->
                </th>

              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let ticket of ticketsDetails; let i = index">
                <tr [ngStyle]="ticket.read_flag == 'N' ? {'font-weight': 'bold'} : {}">
                  <td>{{i+1}}</td>
                  <td>{{ticket.ticket_id}}</td>

                  <td>{{ticket.ticket_comment}}</td>
                  <td> {{ticket.created_by_user}}</td>
                  <td> {{ticket.emp_name}}</td>
                  <!-- <td>{{ticket.emp_name}}</td>
           <td>
             {{ (ticket.orgempcode !== '' && ticket.orgempcode != null && ticket.orgempcode != undefined) ?
             ticket.orgempcode : ticket.tp_code }}
           </td>
           <td>{{ticket.ticket_type}}</td> -->
                  <td>{{ticket.ticket_created_date}}</td>
                  <td>{{ticket.ticket_closure_date}}</td>
                  <td><a href="#SendMessage" data-toggle="modal" data-placement="top" class=" btn comment-btn "
                      (click)="help_support_popup(ticket)"><i class="fa fa-commenting" aria-hidden="true"></i></a>
                  </td>
                  <td>{{ticket.status}}</td>

                  <td>
                    <div class="dropdown float-right ember-view dropleft" *ngIf="ticket.status!='Closed'">
                      <a class="dropdown-toggle no-caret text-muted cursor-pointer ember-view" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        <svg width="20" height="20" viewBox="0 0 512 512" class="icon"
                          style="height: 20px;height: 20px;">
                          <path
                            d="M162 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M256 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M350 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32"
                            id="Path"></path>
                          <path
                            d="M256 480c123.712 0 224-100.288 224-224S379.712 32 256 32 32 132.288 32 256s100.288 224 224 224zm0 32C114.615 512 0 397.385 0 256S114.615 0 256 0s256 114.615 256 256-114.615 256-256 256z"
                            id="Oval-1"></path>
                        </svg>
                      </a>
                      <ul class="dropdown-menu ember-view" aria-labelledby="dropdownMenuButton">
                        <li *ngFor="let status of filtered_ticket_status" class="dropdown-item"
                          (click)="UpdateTicketstatus(ticket,status)">{{status.Description}}</li>
                      </ul>
                    </div>
                  </td>

                </tr>

              </ng-container>

            </tbody>
          </table>

        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeTicketsTable()" value="Cancel">
        </div>
      </form>
    </div>
  </div>
</div>
<!--Tickets Table-->


<!----View Notification Popup // id="viewNotification"----->

<div id="SendMessage" class="modal fade add-address-form-box singal-help-box">
  <div class="modal-dialog ">
    <div class="modal-content">
      <form>
        <div class="modal-body">


          <div id="frame">

            <div class="content">
              <div class="contact-profile">
                <img src="assets/img/user-5.jpg" alt="">
                <p>{{this.emp_name}} ({{this.emp_code}})</p>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="onClose()">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="messages">
                <ul>
                  <li *ngFor="let item of ticket_trail_data"
                    [ngClass]="{'sent': item.ticket_created_by === 'Employee', 'replies': item.ticket_created_by === 'Employer'}">
                    <img src="assets/img/No img.png" alt="No img"
                      *ngIf="item.ticket_created_by === 'Employee' || item.ticket_created_by === 'Employer'">
                    <div class="message-content">
                      <p *ngIf="item.ticket_comment">{{ item.ticket_comment }}</p>
                      <p *ngIf="!item.ticket_comment && item.ticket_created_by === 'Employee'">No Conversation From
                        Employee End</p>
                      <p *ngIf="!item.ticket_comment && item.ticket_created_by === 'Employer'">No Conversation From
                        Employer End</p>
                      <div *ngIf="item.document_name" class="document-link"
                        [ngClass]="{'left-side': item.ticket_created_by === 'Employee', 'right-side': item.ticket_created_by === 'Employer'}">
                        <a [href]="item.document_path" target="_blank">
                          <i [ngClass]="getIconForDocumentType(item.document_type)" style="font-size:14px;"></i>
                        </a>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>



              <div class="message-input" *ngIf="status !== 'Closed' && status !== 'On-hold'">
                <form [formGroup]="Create_Ticket_Form">
                  <div class="wrap">
                    <input type="text" placeholder="Write your message..." formControlName="ticketComment">
                    <input type="file" #fileInput accept=".jpeg,.jpg,.png" (change)="onFileSelected($event)"
                      style="display: none;">
                    <i class="fa fa-paperclip attachment" aria-hidden="true" (click)="fileInput.click()"
                      style="display:none"></i>
                    <button class="submit" type="button" (click)="CreateTicket_Trail()"><i class="fa fa-paper-plane"
                        aria-hidden="true"></i></button>
                  </div>
                  <div class="attached-image-container" *ngIf="base64Data">
                    <div class="attached-image">
                      <img [src]="'data:image/' + documentType + ';base64,' + base64Data" alt="Attachment">
                      <i class="fa fa-times remove" (click)="removeImage()"></i>
                    </div>
                  </div>

                </form>
              </div>


            </div>
          </div>


        </div>

      </form>
    </div>
  </div>
</div>
<!----View Notification Popup----->