<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>

<section>
	<div id="wrapper" [ngClass]="{'active': showSidebar==false}">
		<div class="fakeLoader"></div>

		<div id="page-wrapper">
			<div class="row page-titles">
				<div class="col-md-5 align-self-center">
					<h3 class="text-themecolor">All Visitors</h3>
				</div>
				<div class="col-md-7 align-self-center">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a [routerLink]="['/dashboard']">Dashboard</a></li>

						<li class="breadcrumb-item active">All Visitors</li>
					</ol>
				</div>
			</div>

            <div class="container-fluid">
                <!-- /row -->
                <div class="row">
                    <div class="col-md-12 col-sm-12">
                      <form [formGroup]="Datepicker_Form">
                        <div class="card">
                        
                            <div class="card-header">
                            <div class="row">
                            <div class="col-md-2" style="display: flex; align-items: center;">
                               
                               <span style="margin: 1.5rem; font-weight: 500;" class="">Select Date:</span>
                              
                            </div>
                            
                            <div class="col-md-3">
                              <input id="FromDate2" #rd class="form-control" type="text" style="cursor: pointer;"
                                formControlName="FromDate" placeholder="dd-mm-yyyy" autocomplete="off" readonly>
                            </div>
  
                            <div class="col-md-3">
                              <input id="ToDate2" #rd class="form-control" type="text" style="cursor: pointer;"
                                formControlName="ToDate" placeholder="dd-mm-yyyy" autocomplete="off" readonly>
                            </div>
                            
                            <div class="col-md-2">
                               <button class="btn btn-primary" style=" padding: 10px;" (click)="Visitor_list()">Search</button>
                            </div>
                            
                            <div  class="col-md-2 ">
                               <div  class="top-right-outer-box ">
                                  
                                  <!--bindings={ "/visitor/new_visitor"
                                     "ng-reflect-ng-if": "false"
                                     }--><a [routerLink]="['/visitor/new_visitor']" class="btn btn-primary btn-sm Bulk-Attendance-btn " > Add Visitor</a>
                                     
                               </div>
                            </div>
                            
                            </div>
                            </div>
                            
                            <div class="card-body">
                                
                                <div class="row">
                            
                            <div class="col-md-12 padd-top-0">
                              <div class="row justify-content-end">
                                <div class="col-md-3 text">
                                    <p><strong>Total Visitors: {{ visitor_list_data?.length }}</strong></p>
                                </div>
                                <div class="col-md-3" style="float: right;">
                                    <input type="text" formControlName="searchKeyword" placeholder="Search" class="form-control" (keyup)="search($event)" />
                                </div>
                            </div>
                            
                          
                            
    

                            <div class="table-responsive bulk-attendance-outer-box Reimbursements-outer-box" style=" padding-bottom: 44px;">
                
                            
                                <table class="table user-list" >
                                   <thead>
                                      <tr>
                                         <th>#</th>
                                         <th>Name</th>
                                         <th>Card No.</th>
                                         <th>Date</th>
                                         <th>Check In Time</th>
                                         <th>Check Out Time</th>
                                         <th>Total Hours</th>
                                         <th> </th>
                                      </tr>
                                   </thead>
                                   <tbody>
                                    <ng-container *ngFor="let visitor of filteredEmployees; let i = index">
                                      <tr>
                                        <td>{{i+1}}
                                        </td>

                                      <td [style.color]="visitor.is_blacklist_visitor && visitor.visitor_id == this.idx ? 'red' : 'normal'">
                                       
                                        <!-- <div class="visitor-avatar12 job-img" *ngIf="visitor.identity_details">
                                            <img src="{{ visitor.identity_details }}" (click)="enlargeImage(visitor.identity_details)" alt="Identity Image">
                                        </div>
                                    
                                        <div class="Visitor-avatar12 job-img" *ngIf="!visitor.identity_details">
                                            <img src="../../../../assets/img/user-1.jpg"  alt="No Image" class="no-image">
                                        </div> -->
                                        {{ visitor.visitor_name }} {{ visitor.visitor_last_name }}
                                    </td>
                                    
                                        <!-- <td [style.color]="visitor.is_blacklist_visitor && visitor.visitor_id == this.idx ? 'red' : 'normal'">{{visitor.visitor_name}} {{visitor.visitor_last_name}}</td> -->
                                         <td>{{visitor.assign_visiting_card1}}</td>
                                         <td>{{ formatDate(visitor.visit_date_time) }}</td>
                                         <td>{{visitor.check_in_time}}</td>
                                         <td>{{visitor.check_out_time}}
                                          <button *ngIf="visitor.check_out_time === null || visitor.check_out_time === undefined" class="btn btn-primary btn-sm ml-2" (click)="Check_in_out_visitor(visitor)">Check out</button>
                                         </td>                                      
                                         <td>{{visitor.totalhours}}</td>
                                         <td>

                                          <div class="dropdown visitor-drop-down-btn">
                                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                              <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                                            </button>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

                                              <a class="btn dropdown-item manage-btn"
                                                (click)="showVisitingCard(visitor)">e-Pass</a>
                                              <a class="btn dropdown-item manage-btn"
                                              [class.disabled]="visitor.is_blacklist_visitor"
                                              [ngClass]="{'disabled': visitor.is_blacklist_visitor }"
                                              (click)="visitor.is_blacklist_visitor ? null : update_visitor(visitor)"
                                              data-toggle="tooltip" 
                                              data-placement="top" 
                                               >Visitor Details</a>

                                               <a class="btn dropdown-item manage-btn" 
                                               data-toggle="tooltip" 
                                               data-placement="top" 
                                                 
                                               (click)="openPopup(visitor.visitor_id)">Blacklist</a>

                                               
                                            </div>
                                          </div>

                                          <!-- <a class="btn btn-blue manage-btn"
                                              [class.disabled]="visitor.is_blacklist_visitor"
                                              [ngClass]="{'disabled': visitor.is_blacklist_visitor }"
                                              (click)="visitor.is_blacklist_visitor ? null : update_visitor(visitor)"
                                              data-toggle="tooltip" 
                                              data-placement="top" 
                                              title="Edit Details">
                                            <i class="fa fa-pencil" aria-hidden="true"></i>
                                          </a>
                                       
                                          <a class="btn btn-cancel manage-btn" 
                                             data-toggle="tooltip" 
                                             data-placement="top" 
                                             title="Blacklist" 
                                             (click)="openPopup(visitor.visitor_id)">
                                              <i class="ti-close"></i>
                                          </a>

                                          <a class="btn btn-blue manage-btn"
                                          (click)="showVisitingCard(visitor)">
                                            <i class="fa fa-eye"></i>
                                          </a> -->
                                      </td>
                                         </tr>
                                         <tr *ngIf="filteredEmployees.length==0">
                                          <td colspan="8" style="text-align: center;font-weight: 700;">No Data Found</td>
                                        </tr>
                                    </ng-container>
                                      
                                   </tbody>
                                   
                                </table>
                            
                            </div>

                            <!-- <div class="col-md-12 text-center" *ngIf="visitor_list_data?.length > 0">
                              <div class="d-flex justify-content-center align-items-center">
                                <span> <strong>Rows :</strong></span>&nbsp;&nbsp;
                                <select class="form-control large-select" class="btn btn-info" type="button"  (change)="changePageSize($event.target.value)">
                                  <option *ngFor="let size of pageSizes" [value]="size" [selected]="size === pageSize">{{ size === -1 ? 'All' : size }}</option>
                                </select>&nbsp;&nbsp;
                                
                              </div>
                            </div> -->
                            

<div class="col-md-12 text-center" *ngIf="visitor_list_data?.length > 0">
  <div class="d-flex justify-content-center align-items-center">
    <!-- <button class="btn btn-primary" (click)="previousPage()" [disabled]="pageIndex === 0">Previous</button>&nbsp;&nbsp;
    <button class="btn btn-primary" (click)="nextPage()" [disabled]="pageIndex === totalPages - 1">Next</button>&nbsp;&nbsp; -->
    <span> <strong>Rows :</strong></span>&nbsp;&nbsp;
   <select class="form-control large-select" class="btn btn-info" type="button" (change)="changePageSize($event.target.value)">
  <option *ngFor="let size of pageSizes" [value]="size" [selected]="size === pageSize">{{ size }}</option>
</select>&nbsp;&nbsp;

  </div>
</div> 


                            </div>
                            
                    
                                
                                
                            </div>		
                                
                            </div>
                        </div>
                      </form>
                    </div>
                </div>
                <!-- /row -->
            </div>	


        </div>
       
    </div>
</section>

<!--------Blacklist Popup-------->
 <div [@grooveState]="showPopup?'active':'inactive'"  class="modal">
	<div [@dongleState]="showPopup?'active':'inactive'" class="modal-dialog"
	  style="margin:auto auto auto auto;">
	  <div class="modal-content" style="height:100%;margin-top:100px;">
		<form>
		  <div class="modal-header theme-bg">
			<h4 class="modal-title">Visitor Blacklist</h4>
			<button type="button" class="close" (click)="closePopup()" data-dismiss="modal"
			  aria-hidden="true">&times;</button>
		  </div>
		  <alert></alert>
		  <div class="modal-body">
			<div class="row">
  
			  <form [formGroup]="Blacklist_Form">
  
            <div class="col-md-12">
                 <input type="radio" formControlName="p_is_blacklist_visitor" [value]="1" style="cursor: pointer;">&nbsp;
                 <span for="SearchByEmployeeCode"> Blacklist</span><br>
                 <input type="radio" formControlName="p_is_blacklist_visitor" [value]="0" style="cursor: pointer;"> &nbsp;
                 <span for="SearchByEmployeeCode"> Non-Blacklist</span><br>
             </div>
				<div class="col-md-12">
				  <textarea rows="5" cols="70" formControlName="remarks" placeholder="Enter Remarks..."></textarea>
				</div>
			  </form>
  
  
			</div>
		  </div>
		  <div class="modal-footer">
			<button class="btn btn-info" (click)="Update_blacklist_visitor()">save</button>
  
			<button class="btn btn-cancel" (click)="closePopup()">Cancel</button>
		  </div>
		</form>
	  </div>
	</div>
  </div> 
  <!--------Blacklist Popup-------->


  <!-------Visitng card Popup-------->
  <div id="final-bill" class="modal fade punchin-punchout-outer1-box in" [@grooveState]="isVisitorPopup?'active':'inactive'">
    <div class="modal-dialog modal-lg" [@dongleState]="isVisitorPopup?'active':'inactive'">
      <div class="modal-content">
        <form>
          <div class="modal-header theme-bg">						
             <h4 class="modal-title">Print e-pass</h4> 
            
            
            <span class="close-print-box">
             
            <a (click)="printFinalBill()"><i class="fa fa-print"></i></a>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true" (click)="hideVisitorModal()">×</button>
            </span>
       
            
          </div>
          <div class="modal-body final-bill-inner-box">	

         <div class="card-body">
            <div class="card-sales-split">
 
              <table class="table mb-0" style=" width: 100%;">

                <thead>
                  <tr>
                    <th style=" text-align: left;">
                      <div class="header-left-logo">
                        <a class="logo logo-normal">
                          <img [src]="visitor_data?.logopath" [alt]="visitor_data.accountname" style="width: 110px;margin:0">
                        </a>

                    </div>
                    
                    </th>

                    <th style="text-align: center;">
                      <h3 style="margin: 0;font-size: 20px;">{{visitor_data.accountname}}</h3>
                      <h6 style=" padding: 0 66px;">{{visitor_data.c_address + (visitor_data.c_adress_ii!=''?(', '+visitor_data.c_adress_ii):'')
                        + ', ' + visitor_data.c_city + ', ' + visitor_data.c_state + '-' + visitor_data.c_pincode}}</h6>
                    </th>
                    <th style="width: 18%;">
                      <h3 style="font-size: 14px;font-weight: 600;">VISITOR e-Pass</h3>
                    </th>
                  </tr>

                  <tr  class="ng-tns-c1575462285-0">
                    <td  colspan="4" style="text-align: right;padding: 0;font-size: 10px;" class="ng-tns-c1575462285-0">Valid Duration : {{visitor_data.check_in_time}} To {{validUptoTime}} | Printed on: {{printTime}} </td>
                  </tr>

                </thead>
              </table>
               
            </div>
          <div class="table-responsive top-table-date-box">
            <hr style="  margin: 5px 0;">
            <table class="table mb-0" style=" width: 100%;">
              <tbody>
                 
                <tr>
                 
                  <th style="text-align: left; ">Visitor id  </th>
                  <td style="text-align: left; ">{{visitor_data.visitor_id}}</td>
                  <td rowspan="5">
                  
                    <div class="take-picture-box e-pass-img" style="float: right;">
                      <img [src]="visitor_data.identity_details" class="img-responsive" alt="Logo">
                    </div>
                  
                  </td> 
                </tr>
                
                <tr>
                
                <th style="text-align: left; ">Name </th>
                    <td style="text-align: left; ">{{visitor_data.visitor_name}}</td>
                </tr>
                
                <tr>
                  <th style="text-align: left; ">Mobile No.  </th>
                  <td style="text-align: left; ">{{visitor_data.visitor_mobile}}</td>
                </tr>
                <tr>
                  <th style=" text-align: left;">Email (Optional)   </th>
                  <td style=" text-align: left;">{{visitor_data.visitor_email}} </td>
                </tr>
                
                <tr>
                   
                  <th style="   text-align: left; width: 166px; vertical-align: top;">Address  </th>
                  <td>{{visitor_data.address1 + (visitor_data.address2!=''?(', '+visitor_data.address2):'')
                    + ', ' + visitor_data.city + ', ' + visitor_data.state + '-' + visitor_data.pincode + ', ' + visitor_data.country}}</td>
                </tr>
                  

                                </tbody>
                            </table>
                        </div>
          
          
          
          <div class="table-responsive top-table-date-box"> <hr>
                 &nbsp;
                <table class="table mb-0">
            <tbody>
                <tr>
                  <th style="text-align: left; ">e-Pass No.</th>
                  <td style="text-align: left; ">{{visitor_data.e_pass}}</td>
                </tr>
                
                <tr>
                   
                  <th style="text-align: left; ">Date &amp; Time of Visit  </th>
                  <td style="text-align: left; ">{{visitor_data.visit_date_time}}</td>
                </tr>
                
                <tr>
                  <th style="  text-align: left; ">Person to Meet </th>
                  <td style=" text-align: left;">{{visitor_data.person_to_meet}}</td>
                </tr>
                
                <tr>
                   <th style="   text-align: left; width: 148px; vertical-align: top;">Purpose of Visit   </th>
                  <td colspan="3">{{visitor_data.purpose_of_visit}}</td>
                </tr>
                
                <!-- <tr></tr> -->
              </tbody>
            </table>
            <hr>
          </div>


          <div class="table-responsive top-table-date-box">

                  <table class="table mb-0" style=" width: 100%;">

                      <tbody>
                          <tr> <th colspan="4" style=" text-align: right;">&nbsp;</th> </tr>
                          <tr> <th colspan="4" style=" text-align: right;">Authorized Signature </th> </tr>
        
                      </tbody>
                  </table>
          </div>
          </div>       
          </div>
          <!-- <div class="modal-footer">
            <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
            <input (click)="printFinalBill()" type="submit" class="btn btn-success" value="Print">
          </div> -->
        </form>
      </div>
    </div>
  </div>
  <!-------Visitng card Popup Ends-------->