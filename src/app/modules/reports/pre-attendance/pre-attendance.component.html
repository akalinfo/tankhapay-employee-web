<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>
<section>
  <div id="wrapper" [ngClass]="{'active': showSidebar == false}">
    <div class="fakeLoader"></div>
    <div id="page-wrapper">
      <div class="row page-titles">
        <div class="col-md-5 align-self-center">
          <h3 class="text-themecolor">Payment Advice Report</h3>
        </div>
        <div class="col-md-7 align-self-center">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a [routerLink]="['/reports']">Reports</a></li>
            <li class="breadcrumb-item active">Payment Advice Report</li>
          </ol>
        </div>
      </div>

      <div class="container-fluid">
        <div class="row">
          <!-- [filters]="filters" -->
          <app-common-filter [extraFilters]="addOnFilters" [isSideBar]="isSideBar"
            (filterChanged)="searchOnFilters($event)"></app-common-filter>

          <div class="row notification-btns" style="margin-top: .5rem;">

            <!-- <div class="col-md-3 col-sm-3">

            </div>

            <div class="col-md-2">

            </div> -->

            <div class="col-md-12">
              <div class="top-right-outer-box">

                <button class="btn btn-secondary manage-btn transparent-lock-btn" (click)="lockAdvice()"
                  title="Lock Payment Advice"><i class="fa fa-lg fa-lock"></i> Lock</button>
                <button class="btn btn-secondary manage-btn transparent-unlock-btn" (click)="unlockAdvice()"
                  title="Unlock Payment Advice"><i class="fa fa-lg fa-unlock-alt"></i> Unlock</button>
                <button class="btn btn-secondary manage-btn transparent-reject-btn" (click)="rejectAdvice()"
                  title="Remove Payment Advice"><i class="fa fa-lg fa-times"></i> Remove</button>

                <!-- <a (click)="confirmAlertButton()" class="btn btn-secondary manage-btn"
                  style="padding-top: 9px;border-color: lightblue;" title="Verify Reject Attendance">
                  Reject Payment Advice
                </a> -->
                <!-- &nbsp;
                <a (click)="openSendNotificationPopup()" class="btn btn-secondary manage-btn" style="padding-top: 9px;border-color: lightblue;"
                  title="Create notification"><i class="fa fa-plus"></i> Ticket
                </a> &nbsp;

                <div class="header-notification-box">
                  <a class="dropdown-toggle notification-show" (click)="Get_Tickets()">
                    <i class="ti-bell"></i>
                    <span *ngIf="unread_query_cnt_data && unread_query_cnt_data.unread_tickets && unread_query_cnt_data.unread_tickets !='0'"
                      class="email-notify noti-count">{{unread_query_cnt_data.unread_tickets}}</span>
                  </a>
                </div> -->
                <!-- <a (click)="Get_Tickets()" class="btn btn-primary" style="padding-top: 9px;"  title="View notification"><i class="fa fa-eye"></i> notification</a> -->


              </div>
            </div>


          </div>
          <div class="col-md-12 col-sm-12">
            <div class="card">
              <div class="card-header">
                <div class="row">
                  <div class="col-md-8 col-sm-8 padd-0">
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="flexCheckDefault"
                          [(ngModel)]="includeEmployeeDetails" (click)="toggleShowFields()">
                        <label class="form-check-label" for="flexCheckDefault">Include Emp Details</label>
                      </div>
                    </div>



                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="netPayFilter"
                          [(ngModel)]="applyNetPayFilter" (change)="applyFilters()" [checked]="applyNetPayFilter">
                        <label class="form-check-label" for="netPayFilter"> Net Pay greater than 0</label>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="showRoundedVal"
                          [(ngModel)]="isShowRoundedVal" />
                        <label class="form-check-label" for="showRoundedVal">&nbsp; Show rounded values</label>
                      </div>
                    </div>

                  </div>

                  <div class="col-md-4 col-sm-4">
                    <div class="Show-Fields-top-outer-box" style="margin-left: 5px;">

                      <div class="dropdown float-right-box">
                        <a class="btn btn-round btn-success excel-btn-box" style="padding-top: 9px;"
                          (click)="SaveColumnValues()" title="Click to save reports">&nbsp; <i
                            class="fa fa-save"></i></a>
                        <a class="btn btn-round btn-success excel-btn-box" style="margin-left: 2px;padding-top: 9px;"
                          (click)="exportToExcelTable()">&nbsp;<i class="fa fa-file-excel-o" aria-hidden="true"></i></a>
                        <a class="btn btn-round btn-success excel-btn-box"
                          style="color: red;margin-left: 2px;padding-top: 9px;"
                          (click)="exportToPdf('Payment-Advice-Report.pdf','Payment Advice Report')">&nbsp;<i
                            class="fa fa-file-pdf-o" aria-hidden="true"></i></a>
                      </div>


                      <div class="dropdown btn-group Show-Fields-outer-box" style="margin-left: 10px;">
                        <button type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                          aria-expanded="false" class="btn btn-primary dropdown-toggle"> Show Fields <span
                            class="caret"></span></button>

                        <ul class="dropdown-menu showhide" aria-labelledby="dropdownMenuButton"
                          style="overflow-y: auto; margin-left: -15rem;max-height: 300px;">
                          <li *ngFor="let fields of fieldarray; let i = index">
                            <a class="dropdown-item" (click)="$event.stopPropagation()">
                              <label>
                                <input type="checkbox" (click)="hideshowfields($event,fields)"
                                  [checked]="showfields[fields.value] ? true : null">
                                <span style="font-size: small;">{{fields.name}}</span>
                              </label>
                            </a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

              </div>

              <div class="card-body">

                <div class="col-lg-12 col-md-12 col-sm-12 padd-0">
                  <div class="table-responsive reports-table-outer-box reports-new-table-outer-box c">
                    <table class="table table-striped table-bordered" id="preAttendaceTable" #preAttendaceTable>
                      <thead style="background: skyblue;">
                        <tr>
                          <th> <input class="form-check-input" type="checkbox" id="selectAll" [(ngModel)]="selectAll"
                              (change)="toggleSelectAll()" *ngIf="showSelectionCheckboxes"></th>
                          <th *ngIf="includeEmployeeDetails || showfields['S_No']">S.No.</th>
                          <th *ngIf="includeEmployeeDetails || showfields['mon']">Month</th>
                          <th>TP / Org Emp Code</th>
                          <th>Employee Name</th>
                          <th *ngIf="includeEmployeeDetails || showfields['email']">Email</th>
                          <th *ngIf="includeEmployeeDetails || showfields['fathername']">Father/husband Name</th>
                          <th *ngIf="includeEmployeeDetails || showfields['dateofbirth']">Date Of Birth</th>
                          <th *ngIf="includeEmployeeDetails || showfields['dateofjoining']">Date of Joining</th>
                          <th *ngIf="includeEmployeeDetails || showfields['dateofleaving']">Date of Leaving</th>
                          <th *ngIf="includeEmployeeDetails || showfields['unitparametername']">Organization Unit</th>
                          <th *ngIf="includeEmployeeDetails || showfields['posting_department']">Department</th>
                          <th *ngIf="includeEmployeeDetails || showfields['post_offered']">Designation</th>
                          <th *ngIf="includeEmployeeDetails || showfields['jobtype']">Job Type</th>
                          <th *ngIf="includeEmployeeDetails || showfields['pancard']">PAN Number</th>
                          <!-- <th *ngIf="includeEmployeeDetails || showfields['pfnumber']">PF Number</th> as per liability-->
                          <th *ngIf="includeEmployeeDetails || showfields['uannumber']">UAN Number</th>
                          <th *ngIf="includeEmployeeDetails || showfields['esinumber']">ESI Number</th>
                          <th>Bank Account No</th>
                          <th *ngIf="includeEmployeeDetails || showfields['ifsccode']">IFSC</th>
                          <th>Bank Name</th>
                          <th>Bank Branch </th>
                          <!--<th *ngIf="includeEmployeeDetails || showfields['monthdays']">Month Days</th> as per liability-->
                          <th *ngIf="includeEmployeeDetails || showfields['paiddays']">Total Paid Days</th>
                          <th *ngIf="includeEmployeeDetails || showfields['arrear_days']">Arrear Days</th>
                          <th *ngIf="includeEmployeeDetails || showfields['lossofpay']">Loss of Pay</th>
                          <!-- <th *ngIf="includeEmployeeDetails || showfields['totalleavetaken']">Total Leave Taken</th> as per liability-->

                          <!-- Rate fields  -->
                          <ng-container *ngFor="let header of rate_cols">
                            <th
                              *ngIf="(includeEmployeeDetails || isColumnVisible(header.reportcolumnname)) && isValueGreaterThanZero(header.reportcolumnname)">
                              {{ header.reportcomponentname }}
                            </th>
                          </ng-container>

                          <th *ngIf="includeEmployeeDetails || showfields['fixedallowancestotalrate']">
                            Fixed Allowances Total Rate</th>
                          <!-- Rate fields  -->
                          <!-- Requirement = Basic => Rate cols => Arrears => Earning + Allowances => Deductions  -->
                          <th *ngIf="includeEmployeeDetails || showfields['rate_employerinsuranceamount']">Rate Employer
                            Insurance Amount</th>
                          <th *ngIf="includeEmployeeDetails || showfields['rate_employerlwf']">Rate Employer LWF</th>
                          <th *ngIf="includeEmployeeDetails || showfields['rate_employerepf']">Rate Employer EPF</th>
                          <th *ngIf="includeEmployeeDetails || showfields['employeresirate']">Rate Employer ESI</th>



                          <!-- <th *ngIf="includeEmployeeDetails || showfields['rategross']">Rate Gross</th> as per liability-->


                          <th *ngIf="(includeEmployeeDetails || showfields['rate_employergratuity'])">Rate Employer
                            Gratuity</th>


                          <th *ngIf="includeEmployeeDetails || showfields['masterctc']">Master CTC</th>


                          <!-- Earnings => Allowances fields  -->
                          <ng-container *ngFor="let header of earnings_allowances_cols">
                            <th
                              *ngIf="(includeEmployeeDetails || isColumnVisible(header.reportcolumnname)) && isValueGreaterThanZero(header.reportcolumnname)">
                              {{ header.reportcomponentname }}
                            </th>
                          </ng-container>
                          <!-- Earnings => Allowances fields  -->

                          <th *ngIf="includeEmployeeDetails || showfields['gross']">Gross</th>
                          <th *ngIf="includeEmployeeDetails || showfields['incentive']">Incentive</th>
                          <th *ngIf="includeEmployeeDetails || showfields['refund']">Refund</th>
                          <th *ngIf="includeEmployeeDetails || showfields['bonus']">Bonus</th>
                          <th *ngIf="includeEmployeeDetails || showfields['otherdeductionswithesi']">Other Allowances
                            With ESI</th>
                          <th *ngIf="includeEmployeeDetails || showfields['othervariables']">Other Variables</th>

                          <th>Gross Earning</th>

                          <th *ngIf="(includeEmployeeDetails || showfields['paidmonthlyctc'])">CTC</th>

                          <!-- Arrear Rate => Arrear Amount  -->
                          <ng-container *ngFor="let header of arrear_rate_arrear_amt_cols">
                            <th
                              *ngIf="(includeEmployeeDetails || isColumnVisible(header.reportcolumnname)) && isValueGreaterThanZero(header.reportcolumnname)">
                              {{ header.reportcomponentname }}
                            </th>
                          </ng-container>
                          <!-- Arrear Rate => Arrear Amount  -->

                          <!-- start - new params - sidharth kaul dated. 14.05.2025 -->

                          <!-- <th *ngIf="includeEmployeeDetails || showfields['employeeesirate_arear']">Arrear Employee ESI
                            Rate</th> -->
                          <!-- <th *ngIf="includeEmployeeDetails || showfields['ac_1_arear']">Arrear AC 1</th>
                          <th *ngIf="includeEmployeeDetails || showfields['ac_10_arear']">Arrear AC 10</th>
                          <th *ngIf="includeEmployeeDetails || showfields['ac_2_arear']">Arrear AC 2</th>
                          <th *ngIf="includeEmployeeDetails || showfields['ac21_arear']">Arrear AC 21</th> -->
                          <!-- <th *ngIf="includeEmployeeDetails || showfields['paiddays_arear']">Arrear Paid Days</th> as per liability -->
                          <!-- <th *ngIf="includeEmployeeDetails || showfields['lwf_employer_arear']">Arrear LWF Employer
                          </th>
                          <th *ngIf="includeEmployeeDetails || showfields['employerepf_arear']">Arrear EPF Employer</th> -->
                          <th *ngIf="includeEmployeeDetails || showfields['otherledgerarears']">Other Ledger Arrear</th>
                          <th *ngIf="includeEmployeeDetails || showfields['otherledgerarearwithoutesi']">Other Ledger
                            Arrear Without ESI</th>
                          <!-- end - new params -->




                          <th *ngIf="includeEmployeeDetails || showfields['epf']"> EPF</th>

                          <th *ngIf="includeEmployeeDetails || showfields['vpf']">VPF</th>
                          <th *ngIf="includeEmployeeDetails || showfields['employeeesirate']">Employee ESI</th>
                          <th *ngIf="includeEmployeeDetails || showfields['tds']">TDS</th>
                          <th *ngIf="includeEmployeeDetails || showfields['epf_arear']">Arrear EPF</th>
                          <th *ngIf="includeEmployeeDetails || showfields['vpf_arear']">Arrear VPF</th>
                          <th *ngIf="includeEmployeeDetails || showfields['tds_arear']"> Arrear TDS</th>
                          <th *ngIf="includeEmployeeDetails || showfields['lwf_employee_arear']">Arrear LWF Employee
                          </th>
                          <th *ngIf="includeEmployeeDetails || showfields['loan']">Loan</th>
                          <th *ngIf="includeEmployeeDetails || showfields['loanrecovery']">Loan Recovery</th>
                          <!-- <th *ngIf="includeEmployeeDetails || showfields['lwf']">LWF</th> -->
                          <th *ngIf="includeEmployeeDetails || showfields['insurance']">Insurance</th>
                          <!-- <th *ngIf="includeEmployeeDetails || showfields['mobile']">Mobile</th> -->
                          <th *ngIf="includeEmployeeDetails || showfields['advance']">Advance</th>
                          <th *ngIf="includeEmployeeDetails || showfields['advancerecovery']">Advance Recovery</th>
                          <th *ngIf="includeEmployeeDetails || showfields['other']">Other</th>
                          <th *ngIf="includeEmployeeDetails || showfields['otherledgerdeductions']">Other Ledger
                            Deductions</th>
                          <th *ngIf="includeEmployeeDetails || showfields['otherdeductions']">Other Deductions</th>

                          <th *ngIf="includeEmployeeDetails || showfields['lwf_employee']">LWF Employee</th>
                          <th *ngIf="includeEmployeeDetails || showfields['professionaltax']">Professional Tax </th>
                          <th *ngIf="includeEmployeeDetails || showfields['security_amt']">Security Amount</th>
                          <!-- start - new param -->
                          <th *ngIf="includeEmployeeDetails || showfields['charity_contribution']">Charity Contribution
                          </th>
                          <th *ngIf="includeEmployeeDetails || showfields['gratuity']">Gratuity
                          </th>

                          <!--  end  -->
                          <th>Gross Deduction</th>
                          <th *ngIf="includeEmployeeDetails || showfields['totalarear']">Arrear Net Pay</th>
                          <th>Net Pay</th>
                          <th *ngIf="includeEmployeeDetails || showfields['ac_1']">A/c No.1</th>
                          <th *ngIf="includeEmployeeDetails || showfields['ac_10']">A/c No.10</th>
                          <th *ngIf="includeEmployeeDetails || showfields['ac_2']">A/c No.2</th>
                          <th *ngIf="includeEmployeeDetails || showfields['ac21']">A/c No.21</th>

                          <th *ngIf="includeEmployeeDetails || showfields['employerepf']">Employer EPF</th>
                          <th *ngIf="includeEmployeeDetails || showfields['employerinsuranceamount']">Employer Insurance</th>
                          <th *ngIf="includeEmployeeDetails || showfields['employergratuity']">Employer Gratuity</th>

                          <th *ngIf="includeEmployeeDetails || showfields['lwf_employer']">LWF Employer</th>




                          <th *ngIf="includeEmployeeDetails || showfields['orgempcode']">ORG Emp Code</th>
                          <th *ngIf="includeEmployeeDetails || showfields['customtaxablecomponents']">Custom Taxable
                            Components </th>
                          <th *ngIf="includeEmployeeDetails || showfields['customnontaxablecomponents']">Custom Non
                            Taxable Components</th>
                          <th *ngIf="includeEmployeeDetails || showfields['biometricid']">Biometric Id</th>
                          <th
                            *ngIf="(includeEmployeeDetails || showfields['tea_allowance']) && (isValueGreaterThanZero('tea_allowance'))">
                            Tea Allowance</th>

                          <!-- && tp_account_id != '5852' remove from ctc as discussed with Shiv & andy sir dated, 29.04.2025 -->

                          <th *ngIf="includeEmployeeDetails || showfields['vendor_name']">Vendor Name</th>
                          <th *ngIf="includeEmployeeDetails || showfields['project_name']">Project Name </th>
                          <th *ngIf="includeEmployeeDetails || showfields['salary_book_project']">Salary Book Project
                          </th>


                        </tr>
                      </thead>
                      <!-- *ngIf="includeEmployeeDetails==true and NotIncludeempDetails==true" -->
                      <tbody style="background: aliceblue;">
                        <ng-container *ngFor="let report of filteredEmployees;let i=index;">
                          <tr [ngClass]="{'light-skyblue': i % 2 == 0, 'white': i % 2 != 0}">
                            <td> <input type="checkbox" [(ngModel)]="report.selected"
                                (change)="onEmployeeCheckboxChange()"
                                *ngIf="showSelectionCheckboxes && !(filteredEmployees.length - 1 && report.emp_name==='Grand Total')">

                              &nbsp;<i class="fa fa-lock" style="color:green"
                                *ngIf="report.advicelockstatus=='Locked' && report.tpcode !='' " aria-hidden="true"></i>
                              <i class="fa fa-unlock-alt" style="color:blue"
                                *ngIf="report.advicelockstatus!='Locked' && report.tpcode !=''" aria-hidden="true"></i>
                            </td>
                            <td *ngIf="(includeEmployeeDetails || showfields['S_No'])">

                              <span
                                *ngIf="!(filteredEmployees.length - 1 && report.emp_name==='Grand Total')">{{i+1}}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['mon']">
                              <span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total' ? 'bold' : 'normal'}">{{report.mon}}</span>
                            </td>

                            <td> {{ (report.orgempcode !== '' && report.orgempcode != null && report.orgempcode !=
                              undefined) ? report.orgempcode : report.tpcode }} <span
                                *ngIf="report.appointment_status_id === '14'"
                                style="color: rgb(253, 26, 26);"><b>(Restructure Mode)</b></span>
                            </td>

                            <td>
                              <span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name==='Grand Total' ? 'bold' : 'normal'}">{{
                                report.emp_name }}</span>
                            </td>

                            <td
                              *ngIf="(includeEmployeeDetails || showfields['email']) && report.emp_name !=='Grand Total'">
                              <span>{{report.email}}</span>
                            </td>
                            <td
                              *ngIf="(includeEmployeeDetails || showfields['email']) && report.emp_name =='Grand Total'">

                            </td>

                            <!-- <td>
                              {{ report.emp_name }}
                              <span *ngIf="report.is_account_verified === '0'" style="color: red; font-weight: bold;">(Bank A/C not verified)</span>
                            </td> -->
                            <td *ngIf="includeEmployeeDetails || showfields['fathername']">{{report.fathername }}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['dateofbirth']">{{report.dateofbirth}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['dateofjoining']">{{report.dateofjoining}}
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['dateofleaving']">{{report.dateofleaving }}
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['unitparametername']">
                              {{report.unitparametername}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['posting_department']">{{
                              report.posting_department?.split('#')[0]}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['post_offered']">{{report.post_offered}}
                            </td>


                            <td *ngIf="includeEmployeeDetails || showfields['jobtype']">{{report.jobtype}}</td>

                            <td *ngIf="includeEmployeeDetails || showfields['pancard']">{{report.pancard}}</td>
                            <!-- <td *ngIf="includeEmployeeDetails || showfields['pfnumber']">{{report.pfnumber}}</td> as per liability -->
                            <td *ngIf="includeEmployeeDetails || showfields['uannumber']">{{report.uannumber}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['esinumber']">{{report.esinumber}}</td>
                            <td> <ng-container *ngIf="report.bankaccountno">
                                '{{report.bankaccountno }}
                              </ng-container>
                            </td>
                            <!-- <span *ngIf="report.is_account_verified === '0'" style="font-weight: bold;">(N/A)</span>  -->
                            <td *ngIf="includeEmployeeDetails || showfields['ifsccode']">{{report.ifsccode }}</td>
                            <td>{{report.bankname }}</td>
                            <td>{{report.bankbranch}}</td>

                            <!--<td *ngIf="includeEmployeeDetails || showfields['monthdays']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{report.monthdays}}</span>
                            </td> as per liability -->
                            <td *ngIf="includeEmployeeDetails || showfields['paiddays']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{report.paiddays
                                }}</span>
                            </td>
                            <!-- as per liability -->
                            <td *ngIf="includeEmployeeDetails || showfields['arrear_days']">{{report.arrear_days}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['lossofpay']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total' ? 'bold' : 'normal'}">{{report.lossofpay
                                }}</span></td>
                            <!-- <td *ngIf="includeEmployeeDetails || showfields['totalleavetaken']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{report.totalleavetaken}}</span>
                            </td> as per liability -->

                            <ng-container *ngFor="let header of rate_cols">
                              <td
                                *ngIf="(includeEmployeeDetails || isColumnVisible(header.reportcolumnname)) && isValueGreaterThanZero(header.reportcolumnname)">
                                <span
                                  [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name === 'Grand Total' ? 'bold' : 'normal'}">
                                  {{!isShowRoundedVal ? (report[header.reportcolumnname] || '0') :
                                  getRoundedVal(report[header.reportcolumnname])}}
                                </span>
                              </td>
                            </ng-container>
                            <td *ngIf="includeEmployeeDetails || showfields['fixedallowancestotalrate']">
                              {{!isShowRoundedVal ? truncateToTwoDecimals(report.fixedallowancestotalrate) :
                              getRoundedVal(report.fixedallowancestotalrate)}}</td>

                            <td *ngIf="includeEmployeeDetails || showfields['rate_employerinsuranceamount']">
                              {{!isShowRoundedVal ?
                              truncateToTwoDecimals(report.rate_employerinsuranceamount) :
                              getRoundedVal(report.rate_employerinsuranceamount)
                              }}
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['rate_employerlwf']"> {{!isShowRoundedVal ?
                              truncateToTwoDecimals(report.rate_employerlwf) :
                              getRoundedVal(report.rate_employerlwf)
                              }}
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['rate_employerepf']">{{!isShowRoundedVal ?
                              truncateToTwoDecimals(report.rate_employerepf) :
                              getRoundedVal(report.rate_employerepf)
                              }}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['employeresirate']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.employeresirate : getRoundedVal(report.employeresirate)}}</span>
                            </td>


                            <!-- <td *ngIf="includeEmployeeDetails || showfields['rategross']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.rategross : getRoundedVal(report.rategross)}}</span></td> as per liability -->
                            <td *ngIf="(includeEmployeeDetails || showfields['rate_employergratuity'])">
                              {{!isShowRoundedVal ? (report.rate_employergratuity) :
                              getRoundedVal(report.rate_employergratuity)}}
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['masterctc']">{{report?.masterctc}}</td>
                            <!-- <td *ngIf="(includeEmployeeDetails || showfields['paidmonthlyctc'])">
                              {{!isShowRoundedVal ? (report.paidmonthlyctc | number: '1.2-2') : getRoundedVal(report.paidmonthlyctc)}}
                            </td> -->


                            <!-- Earnings => Allowances fields  -->
                            <ng-container *ngFor="let header of earnings_allowances_cols">
                              <td
                                *ngIf="(includeEmployeeDetails || isColumnVisible(header.reportcolumnname)) && isValueGreaterThanZero(header.reportcolumnname)">
                                <span
                                  [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name === 'Grand Total' ? 'bold' : 'normal'}">
                                  {{!isShowRoundedVal ? (report[header.reportcolumnname] || '0') :
                                  getRoundedVal(report[header.reportcolumnname])}}
                                </span>
                              </td>
                            </ng-container>
                            <!-- Earnings => Allowances fields  -->

                            <td *ngIf="includeEmployeeDetails || showfields['gross']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.gross : getRoundedVal(report.gross)}}</span></td>

                            <td *ngIf="includeEmployeeDetails || showfields['incentive']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.incentive : getRoundedVal(report.incentive)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['refund']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.refund : getRoundedVal(report.refund)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['bonus']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.bonus : getRoundedVal(report.bonus)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['otherdeductionswithesi']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.otherdeductionswithesi : getRoundedVal(report.otherdeductionswithesi)}}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['othervariables']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.othervariables : getRoundedVal(report.othervariables)}}</span></td>
                            <td><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? (report.grossearning ) : getRoundedVal(report.grossearning)}}</span>
                            </td>
                            <!-- | number:'1.2-2' -->

                            <td *ngIf="(includeEmployeeDetails || showfields['paidmonthlyctc'])">
                              {{!isShowRoundedVal ? (report.paidmonthlyctc) : getRoundedVal(report.paidmonthlyctc)}}
                            </td>

                            <!-- Arrear Rate => Arrear Amount fields  -->
                            <ng-container *ngFor="let header of arrear_rate_arrear_amt_cols">
                              <td
                                *ngIf="(includeEmployeeDetails || isColumnVisible(header.reportcolumnname)) && isValueGreaterThanZero(header.reportcolumnname)">
                                <span
                                  [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name === 'Grand Total' ? 'bold' : 'normal'}">
                                  {{!isShowRoundedVal ? (report[header.reportcolumnname] || '0') :
                                  getRoundedVal(report[header.reportcolumnname])}}
                                </span>
                              </td>
                            </ng-container>
                            <!-- Arrear Rate => Arrear Amount fields  -->

                            <!-- start - new params - sidharth kaul dated. 14.05.2025 -->
                            <!-- <td *ngIf="includeEmployeeDetails || showfields['employeeesirate_arear']">
                              {{report?.employeeesirate_arear}}</td> -->
                            <!-- <td *ngIf="includeEmployeeDetails || showfields['ac_1_arear']">{{report?.ac_1_arear}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['ac_10_arear']">{{report?.ac_10_arear}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['ac_2_arear']">{{report?.ac_2_arear}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['ac21_arear']">{{report?.ac21_arear}}</td> -->
                            <!-- <td *ngIf="includeEmployeeDetails || showfields['paiddays_arear']">
                              {{report?.paiddays_arear}}</td> as per liability -->
                            <!-- <td *ngIf="includeEmployeeDetails || showfields['lwf_employer_arear']">
                              {{report?.lwf_employer_arear}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['employerepf_arear']">
                              {{report?.employerepf_arear}}</td> -->
                            <td *ngIf="includeEmployeeDetails || showfields['otherledgerarears']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.otherledgerarears : getRoundedVal(report.otherledgerarears)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['otherledgerarearwithoutesi']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.otherledgerarearwithoutesi :
                                getRoundedVal(report.otherledgerarearwithoutesi)}}</span></td>
                            <!-- end - new params -->


                            <td *ngIf="includeEmployeeDetails || showfields['epf']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.epf : getRoundedVal(report.epf)}}</span></td>

                            <td *ngIf="includeEmployeeDetails || showfields['vpf']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.vpf : getRoundedVal(report.vpf)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['employeeesirate']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.employeeesirate : getRoundedVal(report.employeeesirate)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['tds']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.tds : getRoundedVal(report.tds)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['epf_arear']">{{report?.epf_arear}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['vpf_arear']">{{report?.vpf_arear}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['tds_arear']">{{report?.tds_arear}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['lwf_employee_arear']">
                              {{report?.lwf_employee_arear}}</td>

                            <td *ngIf="includeEmployeeDetails || showfields['loan']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.loan : getRoundedVal(report.loan)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['loanrecovery']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.loanrecovery : getRoundedVal(report.loanrecovery)}}</span></td>
                            <!-- <td *ngIf="includeEmployeeDetails || showfields['lwf']"><span [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{report.lwf}}</span></td> -->
                            <td *ngIf="includeEmployeeDetails || showfields['insurance']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.insurance : getRoundedVal(report.insurance)}}</span></td>
                            <!-- <td *ngIf="includeEmployeeDetails || showfields['mobile']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{report.mobile}}</span>
                            </td> -->
                            <td *ngIf="includeEmployeeDetails || showfields['advance']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.advance : getRoundedVal(report.advance)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['advancerecovery']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.advancerecovery : getRoundedVal(report.advancerecovery)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['other']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.other : getRoundedVal(report.other)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['otherledgerdeductions']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.otherledgerdeductions : getRoundedVal(report.otherledgerdeductions)}}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['otherdeductions']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.otherdeductions : getRoundedVal(report.otherdeductions)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['lwf_employee']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.lwf_employee : getRoundedVal(report.lwf_employee)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['professionaltax']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.professionaltax : getRoundedVal(report.professionaltax)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['security_amt']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.security_amt : getRoundedVal(report.security_amt)}}</span></td>

                            <!-- start - new param -->
                            <td *ngIf="includeEmployeeDetails || showfields['charity_contribution']">
                              <span>{{report?.charity_contribution_amount}}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['gratuity']">{{!isShowRoundedVal ?
                              truncateToTwoDecimals(report?.gratuity) :
                              getRoundedVal(report?.gratuity)
                              }}
                            </td>
                            <!--  end  -->

                            <td><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? (report.grossdeduction ) :
                                getRoundedVal(report.grossdeduction)}}</span></td>
                            <!-- | number:'1.2-2' -->
                            <td *ngIf="includeEmployeeDetails || showfields['totalarear']">{{report?.totalarear}}</td>
                            <td><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? (report.netpay ) : getRoundedVal(report.netpay)}}</span></td>
                            <!-- | number:'1.2-2' -->
                            <td *ngIf="includeEmployeeDetails || showfields['ac_1']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.ac_1 : getRoundedVal(report.ac_1)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['ac_10']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.ac_10 : getRoundedVal(report.ac_10)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['ac_2']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.ac_2 : getRoundedVal(report.ac_2)}}</span></td>
                            <td *ngIf="includeEmployeeDetails || showfields['ac21']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.ac21 : getRoundedVal(report.ac21)}}</span></td>

                            <td *ngIf="includeEmployeeDetails || showfields['employerepf']">
                              <span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">
                                {{ report.employerepf }}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['employerinsuranceamount']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.employerinsuranceamount :
                                getRoundedVal(report.employerinsuranceamount)}}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['employergratuity']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.employergratuity :
                                getRoundedVal(report.employergratuity)}}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['lwf_employer']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{!isShowRoundedVal
                                ? report.lwf_employer : getRoundedVal(report.lwf_employer)}}</span></td>


                            <td *ngIf="includeEmployeeDetails || showfields['orgempcode']">{{report.orgempcode}}</td>
                            <td *ngIf="includeEmployeeDetails || showfields['customtaxablecomponents']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{report.customtaxablecomponents}}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['customnontaxablecomponents']"><span
                                [ngStyle]="{'font-weight': i === filteredEmployees.length - 1 && report.emp_name=='Grand Total'? 'bold' : 'normal'}">{{report.customnontaxablecomponents}}</span>
                            </td>
                            <td *ngIf="includeEmployeeDetails || showfields['biometricid']">{{report.biometricid}}</td>
                            <td
                              *ngIf="(includeEmployeeDetails || showfields['tea_allowance']) && (isValueGreaterThanZero('tea_allowance'))">
                              {{!isShowRoundedVal ? report.tea_allowance : getRoundedVal(report.tea_allowance)}}</td>


                            <!-- && tp_account_id != '5852' remove from ctc as discussed with Shiv & andy sir dated, 29.04.2025 -->

                            <td
                              *ngIf="(includeEmployeeDetails || showfields['vendor_name'])&&report.emp_name !='Grand Total'">
                              {{report.vendor_name}}</td>
                            <td
                              *ngIf="(includeEmployeeDetails || showfields['vendor_name'])&&report.emp_name =='Grand Total'">

                            </td>
                            <td
                              *ngIf="(includeEmployeeDetails || showfields['project_name'])&&report.emp_name !='Grand Total'">
                              {{report.project_name}}
                            </td>
                            <td
                              *ngIf="(includeEmployeeDetails || showfields['project_name'])&&report.emp_name =='Grand Total'">

                            </td>
                            <td
                              *ngIf="(includeEmployeeDetails || showfields['salary_book_project'] )&&report.emp_name !='Grand Total'">
                              {{report.salary_book_project}}</td>
                            <td
                              *ngIf="(includeEmployeeDetails || showfields['salary_book_project'])&&report.emp_name =='Grand Total'">

                            </td>

                          </tr>
                        </ng-container>
                      </tbody>
                    </table>



                    <alert></alert>
                  </div>
                </div>


              </div>
            </div>

            <!-- <div class="col-lg-12 col-md-12 col-sm-12">
                                <div *ngIf="data.length == 0 && !show_label" class="alert alert-danger text-center">
                                    No Record Found.
                                </div>
                                <div *ngIf="data.length==0 && show_label" class="alert alert-success text-center">
                                    Please filter to view records.
                                </div>
                            </div> -->
          </div>

        </div>
        <div *ngIf="loading || !(data)" class="please-wait">
          <i class="fa fa-spinner fa-spin fa-3x"></i>
          <b>Please wait...</b>
        </div>

        <!-- Search Filter Code  -->
        <div id="sidebar" class="sidebar bg-dark text-white sidebar-menu_filter-box" [style.width]="sidebarWidth">
          <h3 class="filter-menu-header-text-box">Filter</h3>
          <a class="clear-box-btn" title="Clear Filter" style="float: right; cursor: pointer;"
            (click)="reset()">Clear</a>
          <button class="close-btn btn btn-danger1" (click)="closeSidebar()"><i class="fa fa-close"></i></button>
          <div class="sidebar-content-box">
            <div class="col-md-12 col-sm-12">
              <input type="text" [(ngModel)]="invKey" value="" placeholder="Search Employee(s)"
                class="form-control wide-width" style="width: 100%;" (keyup)="search($event)" />
              <!-- <input type="text" value="" placeholder="Search with employee / mobile no." class="form-control wide-width" style="width: 100%;"> -->
            </div>

            <div class="col-md-12 ">

              <div id="filterComponent">
                <div class="panel-group">

                  <div class="panel panel-default">
                    <div class="panel-heading panel_heading_gray  card-header" role="tab" id="headingOne2"
                      data-toggle="collapse" data-parent="#accordion2" href="#collapseOne2" aria-expanded="false"
                      aria-controls="collapseOne">
                      <h4>Employees Filter <i class="fa fa-angle-down"></i></h4>
                    </div>
                    <div id="collapseOne2" class="panel-collapse collapse card-body in" role="tabpane2">
                      <div class="row">
                        <div class="col-sm-12">

                          <div class="form-group">
                            <label class="control-label col-sm-12">Status</label>
                            <div class="col-sm-12 padd-0">

                              <select class="form-control" id="statusFilter" [(ngModel)]="selectedFilter"
                                (change)="Attendance_Report()">
                                <option value="All">All</option>
                                <option value="Approved">Approved</option>
                                <option value="Hold">Hold</option>
                              </select>

                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label col-sm-12">Organization Unit</label>
                            <div class="col-sm-12 padd-0">
                              <ng-multiselect-dropdown [placeholder]="'Select Organization Units'"
                                [data]="unit_master_list_data" [(ngModel)]="selectedUnitId"
                                [settings]="dropdownSettings">
                              </ng-multiselect-dropdown>
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label col-sm-12">Department</label>
                            <div class="col-sm-12 padd-0">
                              <ng-multiselect-dropdown [placeholder]="'Select Departments'"
                                [data]="department_master_list_data" [(ngModel)]="selectedDepartmentId"
                                [settings]="dropdownSettings_department">
                              </ng-multiselect-dropdown>
                            </div>
                          </div>

                          <div class="form-group">
                            <label class="control-label col-sm-12">Designation</label>
                            <div class="col-sm-12 padd-0">
                              <ng-multiselect-dropdown [placeholder]="'Select Designations'"
                                [data]="role_master_list_data" [(ngModel)]="selectedDesignationId"
                                [settings]="dropdownSettings_designation">
                              </ng-multiselect-dropdown>
                            </div>
                          </div>


                        </div>

                      </div>
                    </div>
                  </div>

                </div>
              </div>

              <div class="text-center mrg-bot-25">
                <button type="button" class="btn btn-user2 btn-round btn-primary" style="color: #fff !important;"
                  (click)="Apply_new_filter()"> &nbsp;Apply</button>
                <!-- <button type="button" class="btn btn-user1 btn-round" (click)="reset()">Reset</button> -->
              </div>
            </div>


          </div>
        </div>
        <!-- End of search filter code  -->
      </div>
    </div>
    <app-footer></app-footer>



    <!-----------Send Notification Popup-------->
    <div [@grooveState]="showNotificationPopup?'active':'inactive'" id="sendNotification" class="modal"
      style="z-index:1000;">
      <div [@dongleState]="showNotificationPopup?'active':'inactive'" class="modal-dialog"
        style="margin:auto auto auto auto;">
        <div class="modal-content" style="height:100%;margin-top:100px;">
          <form [formGroup]="notificationForm">
            <div class="modal-header theme-bg">
              <h4 class="modal-title">Send Notification
              </h4>
              <button type="button" class="close" aria-hidden="true"
                (click)="closeSendNotificationPopup()">&times;</button>
            </div>
            <div class="modal-body" style="height:25rem;">

              <div class="row" style="display: none;">
                <div class="col-md-4">
                  <label>Subject :</label>
                </div>
                <div class="col-md-8">
                  <select class="form-control" formControlName="subject_id">
                    <option value="">Select</option>
                    <option value="{{rmd.id}}" *ngFor="let rmd of ticketMasterData;">{{rmd?.tickettypename}}</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label>Role</label>
                </div>
                <div class="col-md-8">
                  <select class="form-control" formControlName="team" (change)="get_users_master()">
                    <option value="">Select</option>
                    <option value="{{rmd.role_id}}" *ngFor="let rmd of roles_master_data;">{{rmd.role_name}}</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <label>Users :</label>
                </div>
                <div class="col-md-8">
                  <select class="form-control" formControlName="user_id">
                    <option value="">Select</option>
                    <option value="{{rmd.user_id}}" *ngFor="let rmd of user_by_role_id_data;">{{rmd.user_fullname}}
                    </option>

                  </select>
                </div>
              </div>


              <div class="row">
                <div class="col-md-4">
                  <label>Message :</label>
                </div>
                <div class="col-md-8">
                  <textarea style="width: 100%;" formControlName="query_comment"></textarea>
                </div>
              </div>


              <div class="row">
                <div class="col-md-4">
                  <label>Revert back to HR team for attendance check :</label>
                </div>
                <div class="col-md-8">

                  <input type="checkbox" (click)="check_isAdviceLockedForPayoutFlag($event)"
                    [checked]="notificationForm.value.isAdviceLockedForPayoutFlag=='R'">
                </div>
              </div>

            </div>
            <div class="modal-footer">
              <input type="button" class="btn btn-default" (click)="closeSendNotificationPopup()" value="Cancel">
              <!-- <input type="submit" class="btn btn-success" (click)="createSupportRequest()" value="Confirm"> -->
              <input type="submit" class="btn btn-success" (click)="createTicket()" value="Confiirm">
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-----------Send Notification Popup-------->


    <!--Tickets Table-->
    <div [@grooveState]="showTicketsTable?'active':'inactive'" id="ticketsTbl" class="modal" style="z-index:1000;">
      <div [@dongleState]="showTicketsTable?'active':'inactive'" class="modal-dialog"
        style="margin:auto auto auto auto;width: 800px;">
        <div class="modal-content" style="height:100%;margin-top:100px;">
          <form>
            <div class="modal-header theme-bg">
              <h4 class="modal-title">Notification
              </h4>
              <button type="button" class="close" aria-hidden="true" (click)="closeTicketsTable()">&times;</button>
            </div>
            <div class="modal-body" style="height:25rem;overflow: auto;">

              <table class="table" id="otherDeductionTable">
                <thead>
                  <tr>
                    <th>#</th>
                    <th id="ember1089" class="sortable ember-view">
                      Ticket Id

                    </th>
                    <th id="ember1089" class="sortable ember-view">
                      Message

                    </th>
                    <th id="ember1089" class="sortable ember-view">
                      From User
                    </th>
                    <th id="ember1089" class="sortable ember-view">
                      To User
                    </th>
                    <!-- // <th id="ember1089" class="sortable ember-view">
              //   Name

              // </th>



              // <th id="ember1090" class="sortable header-role ember-view">
              //   Ticket Type

              // </th> -->
                    <th id="ember1090" class="sortable header-role ember-view">
                      Created Date
                      <!---->
                    </th>
                    <th id="ember1090" class="sortable header-role ember-view">
                      Closing Date
                      <!---->
                    </th>

                    <th id="ember1090" class="sortable header-role ember-view">
                      Help & Support
                    </th>

                    <th id="ember1091" class="sortable ember-view">
                      Status
                      <!---->
                    </th>
                    <th id="ember1091" class="sortable ember-view">
                      Action
                      <!---->
                    </th>
                    <th id="ember1091" class="sortable ember-view">
                      Remark
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container *ngFor="let ticket of ticketsDetails; let i = index">
                    <tr [ngStyle]="ticket.read_flag == 'N' ? {'font-weight': 'bold'} : {}">
                      <td>{{i+1}}</td>
                      <td>{{ticket.ticket_id}}</td>

                      <td>{{ticket.ticket_comment}}</td>
                      <td> {{ticket.created_by_user}}</td>
                      <td> {{ticket.emp_name}}</td>

                      <!-- <td>{{ticket.emp_name}}</td>
                <td>
                  {{ (ticket.orgempcode !== '' && ticket.orgempcode != null && ticket.orgempcode != undefined) ?
                  ticket.orgempcode : ticket.tp_code }}
                </td>
                <td>{{ticket.ticket_type}}</td> -->

                      <td>{{ticket.ticket_created_date}}</td>
                      <td>{{ticket.ticket_closure_date}}</td>
                      <td><a href="#SendMessage" data-toggle="modal" data-placement="top" class=" btn comment-btn "
                          (click)="help_support_popup(ticket)"><i class="fa fa-commenting" aria-hidden="true"></i></a>
                      </td>
                      <td>{{ticket.status}}</td>

                      <td>
                        <div class="dropdown float-right ember-view dropleft" *ngIf="ticket.status!='Closed'">
                          <a class="dropdown-toggle no-caret text-muted cursor-pointer ember-view"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <svg width="20" height="20" viewBox="0 0 512 512" class="icon"
                              style="height: 20px;height: 20px;">
                              <path
                                d="M162 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M256 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M350 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32"
                                id="Path"></path>
                              <path
                                d="M256 480c123.712 0 224-100.288 224-224S379.712 32 256 32 32 132.288 32 256s100.288 224 224 224zm0 32C114.615 512 0 397.385 0 256S114.615 0 256 0s256 114.615 256 256-114.615 256-256 256z"
                                id="Oval-1"></path>
                            </svg>
                          </a>
                          <ul class="dropdown-menu ember-view" aria-labelledby="dropdownMenuButton">
                            <li *ngFor="let status of filtered_ticket_status" class="dropdown-item"
                              (click)="UpdateTicketstatus(ticket,status)">{{status.Description}}</li>
                          </ul>
                        </div>
                      </td>
                      <td> {{ticket.attendance_locked_msg}}</td>
                    </tr>

                  </ng-container>

                </tbody>
              </table>

            </div>
            <div class="modal-footer">
              <input type="button" class="btn btn-default" (click)="closeTicketsTable()" value="Cancel">
            </div>
          </form>
        </div>
      </div>
    </div>
    <!--Tickets Table-->


    <!----View Notification Popup // id="viewNotification"----->

    <div id="SendMessage" class="modal fade add-address-form-box singal-help-box">
      <div class="modal-dialog ">
        <div class="modal-content">
          <form>
            <div class="modal-body">


              <div id="frame">

                <div class="content">
                  <div class="contact-profile">
                    <img src="assets/img/user-5.jpg" alt="">
                    <p>{{this.emp_name}} ({{this.emp_code}})</p>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="onClose()">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="messages">
                    <ul>
                      <li *ngFor="let item of ticket_trail_data"
                        [ngClass]="{'sent': item.ticket_created_by === 'Employee', 'replies': item.ticket_created_by === 'Employer'}">
                        <img src="assets/img/No img.png" alt="No img"
                          *ngIf="item.ticket_created_by === 'Employee' || item.ticket_created_by === 'Employer'">
                        <div class="message-content">
                          <p *ngIf="item.ticket_comment">{{ item.ticket_comment }}</p>
                          <p *ngIf="!item.ticket_comment && item.ticket_created_by === 'Employee'">No Conversation From
                            Employee End</p>
                          <p *ngIf="!item.ticket_comment && item.ticket_created_by === 'Employer'">No Conversation From
                            Employer End</p>
                          <div *ngIf="item.document_name" class="document-link"
                            [ngClass]="{'left-side': item.ticket_created_by === 'Employee', 'right-side': item.ticket_created_by === 'Employer'}">
                            <a [href]="item.document_path" target="_blank">
                              <i [ngClass]="getIconForDocumentType(item.document_type)" style="font-size:14px;"></i>
                            </a>
                          </div>
                        </div>
                      </li>
                    </ul>
                  </div>



                  <div class="message-input" *ngIf="status !== 'Closed' && status !== 'On-hold'">
                    <form [formGroup]="Create_Ticket_Form">
                      <div class="wrap">
                        <input type="text" placeholder="Write your message..." formControlName="ticketComment">
                        <input type="file" #fileInput accept=".jpeg,.jpg,.png" (change)="onFileSelected($event)"
                          style="display: none;">
                        <i class="fa fa-paperclip attachment" aria-hidden="true" (click)="fileInput.click()"
                          style="display:none"></i>
                        <button class="submit" type="button" (click)="CreateTicket_Trail()"><i class="fa fa-paper-plane"
                            aria-hidden="true"></i></button>
                      </div>
                      <div class="attached-image-container" *ngIf="base64Data">
                        <div class="attached-image">
                          <img [src]="'data:image/' + documentType + ';base64,' + base64Data" alt="Attachment">
                          <i class="fa fa-times remove" (click)="removeImage()"></i>
                        </div>
                      </div>

                    </form>
                  </div>


                </div>
              </div>


            </div>

          </form>
        </div>
      </div>
    </div>
    <!----View Notification Popup----->


    <!-- Modal -->
    <div class="modal" id="myModal" role="dialog" [ngStyle]="{'display':alertModalStatus?'block':'none'}">
      <div class="modal-dialog modal-sm">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" (click)="closeAlertModal()">&times;</button>
            <h4 class="modal-title">Alert</h4>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to reject and unlock payment advice for approval records? Please confirm.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="closeAlertModal()">No</button>
            <button type="button" class="btn btn-success" data-dismiss="modal"
              (click)="Verify_Lock_Payment_attednace()">Yes</button>
          </div>
        </div>

      </div>
    </div>
