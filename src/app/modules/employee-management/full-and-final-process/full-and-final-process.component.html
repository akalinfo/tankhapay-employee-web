<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>

<section>
  <div id="wrapper" [ngClass]="{'active': showSidebar}">
    <div id="page-wrapper" style="margin-left: 5px;">
      <!-- Page Title and Breadcrumbs -->
      <div class="row page-titles">
        <div class="col-md-5 align-self-center">
          <h3 class="text-themecolor">Employee Exit List</h3>
        </div>
        <div class="col-md-7 align-self-center">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a [routerLink]="['/employee-mgmt/employees']">Employee Management</a></li>
            <li class="breadcrumb-item active">Exit Process</li>
          </ol>
        </div>
      </div>

      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12 col-sm-12">
            <div class="card">
              <div class="card-header">
                <h4>Employees in Exit Process</h4>
              </div>
              <div class="card-body">
                <!-- added 20/06/2025 -->
                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="statusFilter" class="form-label">Filter by Process Status </label>
                    <select id="statusFilter" class="form-select ml-2" [(ngModel)]="selectedStatus"
                      (change)="onStatusChange()">
                      <!-- <option value="">All</option> -->
                      <option value="FNFPending"> Pending </option>
                      <option value="FNFCompleted"> Completed </option>
                    </select>
                  </div>
                </div>
                <!-- end -->
                <div class="table-responsive reports-table-outer-box">
                  <table class="table table-striped table-bordered">
                    <thead>
                      <tr>
                        <!-- Updated table headers -->
                        <th>S.No</th>
                        <th>Employee Name</th>
                        <th>Employee Code</th>
                        <th>Department</th>
                        <th>Designation</th>
                        <th>Status</th>
                        <th>Action</th>
                        <!-- ADDED: New header for the Approve button -->
                        <th>Approve Process</th>

                      </tr>
                    </thead>
                    <tbody>
                      <!-- Loading State -->
                      <!-- UPDATED: Colspan increased from 7 to 8 -->
                      <tr *ngIf="isLoading">
                        <td [attr.colspan]="8" class="text-center">Loading data...</td>
                      </tr>
                      <!-- Empty State -->
                      <tr *ngIf="!isLoading && employeesInFullFinal.length === 0">
                        <td [attr.colspan]="8" class="text-center">
                          No employees found.
                        </td>
                      </tr>
                      <!-- Data Rows -->
                      <tr *ngFor="let emp of employeesInFullFinal; let i = index">
                        <td>{{ i + 1 }}</td>
                        <td>{{ emp.emp_name }}</td>
                        <!-- This shows orgempcode if available, otherwise it shows tpcode -->
                        <td>{{ emp.orgempcode || emp.tpcode }}</td>
                        <td>{{ emp.posting_department }}</td>
                        <td>{{ emp.post_offered }}</td>
                        <td>
                          <!-- Status badge with dynamic coloring based on the text -->
                          <span class="badge" [ngClass]="{
                                  'bg-success': emp.exit_status === 'Full and Final Completed',
                                  'bg-warning': emp.exit_status?.includes('Pending'),
                                  'bg-info': emp.exit_status?.includes('Progress')
                                }">
                            {{ emp.exit_status }}
                          </span>
                        </td>
                        <td>
                          <button class="btn btn-info btn-sm" (click)="openConfirmModal(emp)"
                            *ngIf="!emp.is_feedback_link_status; else disabledBlock">
                            Send
                          </button>

                          <ng-template #disabledBlock>
                            <span class="badge bg-success text-white">
                              <i class="fa fa-check-circle me-1"></i> Form Sent
                            </span>
                          </ng-template>
                        </td>

                        <!-- ADDED: New column with the Approve button -->
                        <td>
                          <!-- Only show approve button if status is pending -->
                          <!-- <button *ngIf="selectedStatus?.includes('FNFPending')" class="btn btn-success btn-sm" -->
                          <button class="btn btn-success btn-sm" (click)="openApproveModal(emp)">
                            Approve
                          </button>
                        </td>

                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Confirmation Modal -->
<div class="modal" [ngStyle]="{'display': confirmationModalVisible ? 'block' : 'none'}">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Alert</h4>
        <button type="button" class="close modal-close-btn" aria-label="Close" (click)="closeConfirmModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12" style="min-height:100px;">
            <p>Are you sure you want to send Exit Interview Questionnaire form and Exit Clearance form to employee?
            </p>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer" style="background-color: #fff;">
          <button class="btn btn-success" (click)=" sendForm()">Yes</button>
          <button type="button" class="btn btn-danger" (click)="closeConfirmModal()">No</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Tracking Modal (remains available for the 'View Details' button) -->
<div *ngIf="showTrackingModal && selectedEmployeeForTracking" class="modal fade show" tabindex="-1" role="dialog"
  style="display: block; background-color: rgba(0,0,0,0.5); height: auto; ">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" style="margin-top: 185px;">
      <div class="modal-header">
        <h5 class="modal-title">Track Process: {{ selectedEmployeeForTracking.emp_name }} ({{
          selectedEmployeeForTracking.orgempcode || selectedEmployeeForTracking.tpcode }})</h5>
        <button type="button" class="btn-close" (click)="closeTrackingModal()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- You might want to update the modal body to use the new field names like emp.exit_status -->
        <p><strong>Current Status:</strong> {{ selectedEmployeeForTracking.exit_status }}</p>
        <hr>
        <h6>Process Steps Overview:</h6>
        <!-- This section may need to be updated based on your actual process tracking data -->
        <ul>
          <li>Initiation: <span class="text-muted">Pending</span></li>
          <li>Clearance Form Submission: <span class="text-muted">Pending</span></li>
          <li>HR Verification: <span class="text-muted">Pending</span></li>
          <li>Final Settlement: <span class="text-muted">Pending</span></li>
          <li>Process Completed: <span
              [ngClass]="{'text-success': selectedEmployeeForTracking.exit_status === 'Full and Final Completed'}">{{selectedEmployeeForTracking.exit_status
              === 'Full and Final Completed' ? 'Yes' : 'No'}}</span></li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeTrackingModal()">Close</button>
      </div>
    </div>
  </div>
</div>



<div *ngIf="showApproveModal" class="modal fade show" tabindex="-1" role="dialog" style="display: block;">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Full and Final Process for: {{ selectedEmployeeForApproval?.emp_name }}</h5>
        <!-- <button type="button" class="btn-close" (click)="closeApproveModal()" aria-label="Close"></button> -->
         <button (click)="closeApproveModal()" type="button" class="close" data-dismiss="modal" >×</button>
      </div>

      <!-- THE MODAL BODY NOW CONTAINS THE FULL FORM -->
      <div class="modal-body" style="max-height: 65vh; overflow-y: auto;">
        <div *ngIf="!selectedForm">

          <div class="row">

            <div class="col-md-6">
              <div class="card hover-shadow" (click)="selectForm('interview')" style="cursor: pointer;">
                <div class="card-body text-center">
                  <h4 class="card-title">Exit Interview</h4>
                  <!-- <p class="card-text">View exit reasons and rankings</p> -->
                  <span class="approval" *ngIf="is_submitted">Approved</span>
                  <span class="approval" *ngIf="!is_submitted">Approval Pending</span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="card hover-shadow" (click)="selectForm('clearance')" style="cursor: pointer;">
                <div class="card-body text-center">
                  <h4 class="card-title">Clearance Form</h4>
                  <!-- <p class="card-text">Review assets & final remarks</p> -->
                  <span class="approval" *ngIf="is_clearance_submitted">Approved</span>
                  <span class="approval" *ngIf="!is_clearance_submitted">Approval Pending</span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card hover-shadow" (click)="selectForm('settlement')" style="cursor: pointer;">
                <div class="card-body text-center">
                  <h4 class="card-title">Full and Final Settlement</h4>
                  <!-- <p class="card-text">View exit reasons and rankings</p> -->
                  <span class="approval" *ngIf="is_settled">Approved</span>
                  <span class="approval" *ngIf="!is_settled">Approval Pending</span>
                </div>
              </div>
            </div>


          </div>
          <div class="alert alert-danger mt-3" *ngIf="hasClearanceError || hasInterviewError">
            <strong>Error fetching data:</strong>
            <div *ngIf="hasClearanceError">Clearance form data could not be loaded.</div>
            <div *ngIf="hasInterviewError">Exit interview form data could not be loaded.</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
          </div>
        </div>

        <div *ngIf="selectedForm === 'clearance' && clearanceForm">
          <button class="btn btn-link mb-2" (click)="goBackToCards()">← Back </button>
          <!-- <div *ngIf="clearanceForm_submitted"> -->
          <div>
            <form [formGroup]="clearanceForm">

              <!-- Employee Details Section -->
              <div class="section-container mb-4">
                <div class="section-header p-3" (click)="toggleEmployeeInfo()">
                  <span class="section-title">Employee Details</span>
                  <i class="fa toggle-icon" [ngClass]="showEmployeeInfo ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                </div>
                <div class="section-body border border-top-0 p-3" *ngIf="showEmployeeInfo">
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Employee Name:</label>
                      <input type="text" class="form-control" formControlName="employeeName">
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Employee Code:</label>
                      <input type="text" class="form-control" formControlName="employeeCode">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Designation:</label>
                      <input type="text" class="form-control" formControlName="designation">
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Department:</label>
                      <input type="text" class="form-control" formControlName="department">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Date of Joining:</label>
                      <input type="text" class="form-control" formControlName="dateOfJoining">
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">HoD/ RO:</label>
                      <input type="text" class="form-control" formControlName="hodRo">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Date of Resignation:</label>
                      <input type="text" class="form-control" formControlName="dateOfResignation">
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Last Working Day:</label>
                      <input type="text" class="form-control" formControlName="lastWorkingDay">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Assets Section -->
              <div class="section-container mb-4">
                <div class="section-header p-3" (click)="toggleTable()">
                  <span class="section-title">Asset Record</span>
                  <i class="fa toggle-icon" [ngClass]="showTable ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                </div>
                <div class="section-body border border-top-0 p-3" *ngIf="showTable">
                  <div class="mb-4 p-3 border rounded">
                    <div class="table-responsive">
                      <table class="table table-bordered align-middle">
                        <thead>
                          <tr>
                            <th style="width:13%;">Department</th>
                            <th style="width: 26%;">Assets / Item Description</th>
                            <th style="width: 13%;">Handed Over? (Y/N)</th>
                            <th style="width: 30%;">Verification/ Remarks</th>
                            <th style="width: 20%;">Deductions</th>
                          </tr>
                        </thead>
                        <tbody formArrayName="clearanceItems">
                          <ng-container *ngFor="let deptKey of departmentKeys">
                            <ng-container *ngFor="let item of groupedItems[deptKey]; let isFirst = first">
                              <tr [formGroupName]="item.originalIndex">
                                <td *ngIf="isFirst" [attr.rowspan]="groupedItems[deptKey].length">
                                  <b>{{ item.department_name }}</b>
                                </td>
                                <td>{{ item.asset_item }}</td>
                                <td>
                                  <!-- Show current value and allow update -->
                                  <ng-container>
                                    <!-- Select dropdown for update -->
                                    <select class="form-select" formControlName="status">
                                      <option value="" disabled>-- Select --</option>
                                      <option value="Yes">Yes</option>
                                      <option value="No">No</option>
                                    </select>

                                    <!-- Validation message -->
                                    <div *ngIf="clearanceItemsArray.controls[item.originalIndex].get('status')?.invalid &&
            clearanceItemsArray.controls[item.originalIndex].get('status')?.touched" class="text-danger small mt-1">
                                      Selection is required.
                                    </div>
                                  </ng-container>

                                </td>
                                <td>
                                  <input type="text" class="form-control" formControlName="remarks"
                                    placeholder="Enter remarks">
                                </td>
                                <td>
                                  <input type="number" class="form-control" formControlName="deducation_amount" min="0"
                                    placeholder="Enter amount">
                                </td>
                              </tr>
                            </ng-container>
                          </ng-container>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </form>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
              <button type="button" class="btn btn-success" (click)="submitApproval()">Approve and Submit</button>
            </div>
          </div>
        </div>
        <!-- Step 3: Show Interview Form -->

        <div *ngIf="selectedForm === 'interview' && questionnaireForm">
          <button class="btn btn-link mb-2" (click)="goBackToCards()">← Back </button>
          <div *ngIf="interviewForm_submitted">
            <form [formGroup]="questionnaireForm">
              <!-- EMPLOYEE INFO SECTION -->
              <div class="section-container mb-4">
                <div class="section-header p-3" (click)="toggleEmployeeDetail()">
                  <span class="section-title">Employee Information </span>
                  <i class="fa toggle-icon" [ngClass]="showEmployeeDetail ? 'fa-chevron-up' : 'fa-chevron-down'"
                    aria-hidden="true"></i>
                </div>
                <div class="section-body border border-top-0 p-3" *ngIf="showEmployeeDetail">
                  <fieldset class="mb-4 p-3 border rounded">

                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="employeeName" class="form-label">Employee Name:</label>
                        <input type="text" id="employeeName" class="form-control" formControlName="employeeName">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="employeeId" class="form-label">Employee ID:</label>
                        <input type="text" id="employeeId" readonly class="form-control" formControlName="employeeId">
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="department" class="form-label">Department:</label>
                        <input type="text" id="department" readonly class="form-control" formControlName="department">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="designation" class="form-label">Designation:</label>
                        <input type="text" id="designation" readonly class="form-control" formControlName="designation">
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="annualSalary" class="form-label">Annual Salary (at exit):</label>
                        <input type="text" id="annualSalary" readonly class="form-control"
                          formControlName="annualSalary">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="dateOfJoining" class="form-label">Date of Joining:</label>
                        <input type="text" id="dateOfJoining" readonly class="form-control"
                          formControlName="dateOfJoining">
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="designationAtJoining" class="form-label">Designation at Joining:</label>
                        <input type="text" id="designationAtJoining" class="form-control"
                          formControlName="designationAtJoining">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="salaryAtJoining" class="form-label">Salary at Joining:</label>
                        <input type="text" id="salaryAtJoining" class="form-control" formControlName="salaryAtJoining">
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="payroll" class="form-label">Payroll / Business Unit:</label>
                        <input type="text" id="payroll" class="form-control" formControlName="payroll">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="lastWorkingDay" class="form-label">Last Working Day:</label>
                        <input type="text" id="lastWorkingDay" class="form-control" formControlName="lastWorkingDay">
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="contactAddress" class="form-label">Contact Address :
                      </label>
                      <textarea id="contactAddress" class="form-control" formControlName="contactAddress"
                        rows="3"></textarea>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="phoneNo" class="form-label">Phone No: </label>
                        <input type="tel" id="phoneNo" class="form-control" formControlName="phoneNo">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="emailId" class="form-label">Personal Email ID:
                        </label>
                        <input type="email" id="emailId" class="form-control" formControlName="emailId">
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>



              <div class="section-container mb-4">

                <div class="section-header p-3" (click)="toggleReasons()">
                  <span class="section-title">Reason for Leaving </span>
                  <i class="fa toggle-icon" [ngClass]="showReasons ? 'fa-chevron-up' : 'fa-chevron-down'"
                    aria-hidden="true"></i>
                </div>

                <div class="section-body border border-top-0 p-3" *ngIf="showReasons">
                  <fieldset class="mb-4 p-3 border rounded">

                    <div formArrayName="reasonsControls" class="row row-cols-1 row-cols-sm-2 row-cols-md-3">
                      <div *ngFor="let group of reasonsControlsArray.controls; let i = index" [formGroupName]="i"
                        class="col mb-2">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" formControlName="selected"
                            [id]="resignationReasons[i].masterreasoinid">
                          <label class="form-check-label" [for]="resignationReasons[i].masterreasoinid">
                            {{ resignationReasons[i].reason_resignation_name }}
                          </label>
                        </div>
                      </div>
                    </div>

                    <!-- If "Other" , show text input -->
                    <div *ngIf="reasonsControlsArray.length > 0" class="mt-3">
                      <label class="form-label">If any other reason, please specify:</label>
                      <input type="text" class="form-control" formControlName="reasonOtherSpecify"
                        placeholder="Type here...">
                    </div>
                  </fieldset>
                </div>
              </div>


              <!-- Rank Your Experience -->
              <div class="section-container mb-4">
                <div class="section-header p-3" (click)="toggleRankings()">
                  <span class="section-title">Rank Your Experience </span>

                  <i class="fa toggle-icon" [ngClass]="showRankings ? 'fa-chevron-up' : 'fa-chevron-down'"
                    aria-hidden="true"></i>

                </div>
  <div class="section-body border border-top-0 p-3" *ngIf="showRankings">
              <fieldset class="mb-4 p-3 border rounded">
                <div formArrayName="rankingsControls">
                  <ng-container *ngFor="let group of rankingsControlsArray.controls; let i = index" [formGroupName]="i">
                    <div class="mb-4">
                      <label [for]="rankingAspects[i]?.masteraspectid" class="form-label d-block">
                        {{ rankingAspects[i]?.aspect_name }}
                      </label>

                    
                      <!-- [UPDATED] NPS Rating Buttons Horizontal -->
                      <div class="nps-container">
                        <!-- This div will hold the buttons and arrange them horizontally -->
                        <div class="nps-scale">
                          <button *ngFor="let score of scores" type="button" class="nps-btn nps-score-{{score}}"
                            [disabled]="interviewForm_submitted"
                            [ngClass]="{ 'selected': group.get('rank_assigned')?.value === score }"
                            (click)="toggleRank(group, score)">
                            {{ score }}
                          </button>
                        </div>
                        <!-- Optional: Labels below the scale for better user context -->
                        <div class="nps-labels">
                          <span class="nps-label-start">Lowest</span>
                          <span class="nps-label-end">Highest</span>
                        </div>
                      </div>
                      <!-- Validation -->
                      <div
                        *ngIf="group.get('rank_assigned')?.invalid && (group.get('rank_assigned')?.dirty || group.get('rank_assigned')?.touched)"
                        class="text-danger small mt-1">
                        <div *ngIf="group.get('rank_assigned')?.errors?.['required']">Rank is required.</div>
                        <div
                          *ngIf="group.get('rank_assigned')?.errors?.['min'] || group.get('rank_assigned')?.errors?.['max']">
                          Rank must be between 1–10.
                        </div>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </fieldset>
            </div>
              
              </div>

              <!-- Additional Feedback -->
              <div class="section-container mb-4">
                <div class="section-header p-3" (click)="toggleFeedback()">
                  <span class="section-title">Additional Feedback </span>
                  <i class="fa toggle-icon" [ngClass]="showFeedback ? 'fa-chevron-up' : 'fa-chevron-down'"
                    aria-hidden="true"></i>
                </div>
                <div class="section-body border border-top-0 p-3" *ngIf="showFeedback">
                  <fieldset class="mb-4 p-3 border rounded">
                    <div formArrayName="additionalFeedback">
                      <div *ngFor="let feedback of additionalFeedbackArray.controls; let i = index" [formGroupName]="i"
                        class="mb-3">
                        <label class="form-label">
                          {{ feedback.value.label }}

                        </label>
                        <textarea class="form-control" formControlName="questionnaire_response" rows="3"></textarea>
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>



              <!-- NEW ORG + SIGNATURE + APPROVAL -->
              <div class="section-container mb-4">
                <div class="section-header p-3" (click)="toggleNewOrgDetails()">
                  <span class="section-title">New Organization Details and Remarks</span>
                  <i class="fa toggle-icon" [ngClass]="showNewOrgDetails ? 'fa-chevron-up' : 'fa-chevron-down'"
                    aria-hidden="true"></i>
                </div>
                <div class="section-body border border-top-0 p-3" *ngIf="showNewOrgDetails">
                  <div formGroupName="newOrganizationDetails">
                    <fieldset class="mb-4 p-3 border rounded">
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label>New Organization Name:</label>
                          <input class="form-control" formControlName="neworganizationname" />
                        </div>
                        <div class="col-md-6 mb-3">
                          <label>New Designation:</label>
                          <input class="form-control" formControlName="newdesignation" />
                        </div>
                      </div>
                      <!-- <div class="row">
                      <div class="col-md-6 mb-3">
                        <label>Employer Signature: <span class="text-danger">*</span></label>
                        <input class="form-control" formControlName="exiting_employee_signature" />
                      </div>
                      <div class="col-md-6 mb-3">
                        <label>Employer Submission Date: <span class="text-danger">*</span></label>
                        <input type="date" class="form-control" formControlName="exiting_employee_submissiondate" />
                      </div>
                    </div> -->
                    </fieldset>
                  </div>

                  <fieldset class="mb-4 p-3 border rounded">
                    <div class="mb-3">
                      <label class="form-label">Remarks:</label>
                      <textarea class="form-control" formControlName="remarks" rows="4"></textarea>
                    </div>
                  </fieldset>
                </div>
              </div>


              <!-- <div class="section-container mb-4">
                <div class="section-header p-3">
                  <span class="section-title">Remarks</span>
                </div>
                <div class="section-body border border-top-0 p-3">
                  <fieldset class="mb-4 p-3 border rounded">
                    <div class="mb-3">
                      <label class="form-label">Remarks:</label>
                      <textarea class="form-control" formControlName="remarks" rows="4"></textarea>
                    </div>
                  </fieldset>
                </div>
              </div> -->

              <fieldset class="mb-4 p-3 border rounded">
                <div class="mb-3">
                  <label class="form-label">Final Approver's Remarks:</label>
                  <textarea class="form-control" formControlName="approver_remarks" rows="4"></textarea>
                </div>
              </fieldset>

              <!-- SUBMIT BUTTONS -->

              <div class="modal-footer" *ngIf="!is_submitted">
                <button type="button" class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
                <button type="button" class="btn btn-success" (click)="approveExitFeedback()">Approve and
                  Submit</button>
              </div>
              <div class="modal-footer" *ngIf="is_submitted">
                <button type="button" class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>

              </div>
            </form>
            <!-- <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
              <button type="button" class="btn btn-success" (click)="submitApproval()">Approve and Submit</button>
            </div> -->
          </div>
          <div *ngIf="!interviewForm_submitted">
            <h3>No response from Employee Side</h3>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
            </div>
          </div>

        </div>

        <div *ngIf="selectedForm === 'settlement' ">
          <button class="btn btn-link mb-2" (click)="goBackToCards()">← Back </button>
          <!-- <div *ngIf="clearanceForm_submitted"> -->
          <div>
            <form [formGroup]="settlementForm">

              <!-- Employee Details Section -->
              <div class="section-container mb-4">
                <div class="section-header p-3" (click)="toggleEmployeeInfo()">
                  <span class="section-title">Employee Details</span>
                  <i class="fa toggle-icon" [ngClass]="showEmployeeInfo ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                </div>
                <div class="section-body border border-top-0 p-3" *ngIf="showEmployeeInfo">
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Employee Name:</label>
                      <input type="text" class="form-control" formControlName="employeeName">
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Employee Code:</label>
                      <input type="text" class="form-control" formControlName="employeeCode">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Designation:</label>
                      <input type="text" class="form-control" formControlName="designation">
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Department:</label>
                      <input type="text" class="form-control" formControlName="department">
                    </div>
                  </div>
                  <!-- <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Date of Joining:</label>
                      <input type="text" class="form-control" formControlName="dateOfJoining">
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">HoD/ RO:</label>
                      <input type="text" class="form-control" formControlName="hodRo">
                    </div>
                  </div> -->
                  <div class="row">
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Date of Resignation:</label>
                      <input type="text" class="form-control" formControlName="dateOfResignation">
                    </div>
                    <div class="col-md-6 mb-2">
                      <label class="form-label">Last Working Day:</label>
                      <input type="text" class="form-control" formControlName="lastWorkingDay">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Assets Section -->
              <div class="section-container mb-4">
                <div class="section-header p-3" (click)="togglesettlement()">
                  <span class="section-title">Earnings And Deductions</span>
                  <i class="fa toggle-icon" [ngClass]="showSettlement ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                </div>
                <div class="section-body border border-top-0 p-3">
                  <div class="mb-4 p-3 border rounded">
                    <div class="table-responsive">
                      Earnings
                      <table class="table table-bordered align-middle">
                        <thead>
                          <tr>
                            <th style="width: 40%;">Earning Type</th>
                            <th style="width: 30%;">Amount</th>
                          </tr>
                        </thead>
                        <tbody>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <div class="section-body border border-top-0 p-3">
                  <div class="mb-4 p-3 border rounded">
                    <div class="table-responsive">
                      Deductions
                      <table class="table table-bordered align-middle">
                        <thead>
                          <tr>
                            <th style="width: 30%;">Assets / Item Description</th>
                            <th style="width: 20%;">Handed Over? (Y/N)</th>
                            <th style="width: 30%;">Deduction Amount</th>
                          </tr>
                        </thead>
                        <tbody>
                          <!-- <ng-container *ngFor="let deptKey of departmentKeys">
                            <ng-container *ngFor="let item of groupedItems[deptKey]; let isFirst = first">
                              <tr [formGroupName]="item.originalIndex">
                                <td *ngIf="isFirst" [attr.rowspan]="groupedItems[deptKey].length">
                                  <b>{{ item.department_name }}</b>
                                </td>
                                <td>{{ item.asset_item }}</td>
                                <td>
                                 
                                  <ng-container>
                              
                                    <select class="form-select" formControlName="status">
                                      <option value="" disabled>-- Select --</option>
                                      <option value="Yes">Yes</option>
                                      <option value="No">No</option>
                                    </select>

                                    
                                    <div *ngIf="clearanceItemsArray.controls[item.originalIndex].get('status')?.invalid &&
            clearanceItemsArray.controls[item.originalIndex].get('status')?.touched" class="text-danger small mt-1">
                                      Selection is required.
                                    </div>
                                  </ng-container>

                                </td>
                                <td>
                                  <input type="text" class="form-control" formControlName="remarks"
                                    placeholder="Enter remarks">
                                </td>
                                <td>
                                  <input type="number" class="form-control" formControlName="deducation_amount" min="0"
                                    placeholder="Enter amount">
                                </td>
                              </tr>
                            </ng-container>
                          </ng-container> -->
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <div class="section-body border border-top-0 p-3">
                  <div class="mb-4 p-3 border rounded">

                    <div class="row">
                      <div class="col-md-12">
                        <label class="form-label">Final Amount</label>
                        <input type="text" class="form-control" formControlName="final_amount">
                      </div>
                    
                    </div>
                  </div>
                </div>
             


          </div>



          </form>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
            <button type="button" class="btn btn-success" (click)="submitApproval()">Approve and Submit</button>
          </div>
        </div>
        <!-- <div *ngIf="!clearanceForm_submitted">
            <h3>No response from Employee Side</h3>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="closeApproveModal()">Cancel</button>
            </div>
          </div> -->
      </div>


    </div>

  </div>
</div>
</div>


<app-footer></app-footer>