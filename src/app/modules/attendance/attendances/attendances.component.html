<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>
<section>

  <div id="wrapper" [class.active]="!showSidebar" [class]="accountClass">
    <div class="fakeLoader"></div>
    <!-- Navigation -->

    <!-- Sidebar Navigation -->

    <div id="page-wrapper">
      <div class="row page-titles">
        <div class="col-md-5 align-self-center">
          <h3 class="text-themecolor">&nbsp;&nbsp;Attendance <span style="font-size: 1.5rem;color: #01b6ed;">[
              {{get_month_year_name()}} ]</span></h3>
        </div>
        <div class="col-md-7 align-self-center">
          <ol class="breadcrumb">
            <li class="breadcrumb-item" title="Home"><a [routerLink]="['/dashboard']">Home</a></li>

            <li class="breadcrumb-item active">Attendance</li>
          </ol>
        </div>
      </div>
      <div class="container-fluid">
        <!-- /row -->
        <div class="row">
          <div *ngIf="is_insufficient_fund" class="col-md-12 col-sm-12">
            <div class="alert-group alert-box">
              <div class="notice notice-danger alert-dismissable">

                <strong>Insufficient Account Balance:</strong> Please add funds to your account to cover payroll
                expenses.
                <a class="Add-balancebtn" [routerLink]="['/payouts']" title="Click for Add balance"><strong>Add
                    balance</strong></a>
              </div>
            </div>
          </div>
          <div class="col-md-12 col-sm-12" [ngClass]="{'blur': is_insufficient_fund}">
            <div class="card" style="z-index:10;">

              <div class="card-header">
                <div class="row" style="margin-top: .5rem;">
                  <!-- <option value={{filteredEmployees.length}} [selected]="limit==filteredEmployees.length">All
                  </option> -->
                  <!-- <div class="col-md-1 col-sm-1">
                    <b>Row(s)</b>
                    <br>
                    <select class="form-control" (change)="changePage($event)" style="font-size: 12px;">
                      <option value="10" [selected]="limit==10">10</option>
                      <option value="20" [selected]="limit==20">20</option>
                      <option value="20" [selected]="limit==20">20</option>
                      <option value="50" [selected]="limit==50">50</option>
                      <option value="100" [selected]="limit==100">100</option>
                    </select>
                  </div> -->
                  <!-- <div class="col-md-3 col-sm-3"> -->

                  <!-- (keyup)="search($event)" -->
                  <!-- <input type="text" class="form-control wide-width" placeholder="Search Employee(s)"
                      (keyup)="search($event.target.value)" maxlength="200" [(ngModel)]="search_key" />
                  </div>

                  <div class="col-md-2" style="margin-top: 3rem;">
                    <span style="font-weight: bold;">&nbsp;</span>
                    <span style="color: blue; font-weight: bold;  font-size: 12px;"> Total :
                      {{attendanceSummaryData.total_att}}</span>
                    &nbsp; <i aria-hidden="true" class="fa fa-file-excel-o fa-lg" title="Download Attendance in Excel"
                      style="cursor: pointer;" (click)="download_bulk_att()"></i>

                  </div> -->

                  <!-- <div class="col-md-2 col-sm-2" style="display: none;">
                    <b> Status</b>
                    <select class="form-control" (change)="filter_emp($event.target.value)">
                      <option value="All">All</option>
                      <option value="UnMarked">Yet to Mark</option>
                      <option value="Marked">Marked</option>
                      <option value="Verified">Verified</option>
                    </select>
                  </div> -->
                  <!-- <div class="col-md-3" style="display: none;">
                    <span style="margin: 10px;font-weight: bold;">Month-Year</span>
                    <p style="display: inline-flex;">
                      <select class="form-control" (change)="changeMonth($event)">
                        <!-- <option value="">Select</option> -->
                  <!-- <option *ngFor="let ma of monthsArray" [selected]="month==ma.id" [value]="ma.id">{{ma.month}}
                        </option>
                      </select>
                      <select class="form-control" (change)="changeYear($event)">

                        <option *ngFor="let ya of yearsArray" [selected]="year==ya" [value]="ya">{{ya}}</option>

                      </select>
                    </p> -->


                  <!-- </div>

                  <div class="col-md-5 col-sm-5">
                    <div class="row">

                      <div class="col-md-6 text-right" style="padding: 0px;float: right;">
                        <span style="margin: 6px;font-weight: bold;">&nbsp;</span>
                        <ul class="nav nav-pills" role="tablist">
                          <li role="presentation" class="dropdown">
                            <a href="javascript:void();" class="dropdown-toggle btn-round btn-primary"
                              data-toggle="dropdown">Bulk Upload
                              <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                              <li><a (click)="routeToBulkAttn()" style="cursor: pointer;">Attendance(s)</a></li>
                              <li><a (click)="go_to_upload_allowance()" style="cursor: pointer;">Allowance &
                                  Deduction</a></li>
                              <li><a (click)="go_to_dadsrkm_allowance()" style="cursor: pointer;">DSR Days & Kilometers
                                </a></li>
                             <li><a (click)="routeToMissedPunch()" style="cursor: pointer;">Missed Punch</a></li>

                            </ul>
                          </li>
                        </ul> -->


                  <!-- <b>&nbsp;</b> <br>
                        <a class="btn btn-primary btn-sm Bulk-Attendance-btn" (click)="routeToBulkAttn()">
                          Bulk Attendance</a>
                        <b>&nbsp;</b>
                        <a class="btn btn-primary" (click)="go_to_upload_allowance()" style="border-color: black;">Bulk
                          Upload Allowance & Deduction</a> -->
                  <!-- </div>
                      <div class="col-md-6 text-right">
                        <span style="font-weight: bold;">&nbsp;</span> -->
                  <!-- <a style="font-weight: 500;color: black;border-color: #0e49ed !important;"
                        class="btn btn-secondary manage-btn" (click)="routeToMissedPunch()">
                          Missed Punch</a> -->

                  <!-- <span style="margin: 6px;font-weight: bold;">&nbsp;</span>
                        <ul class="nav nav-pills" role="tablist">
                          <li role="presentation" class="dropdown">
                            <a href="javascript:void();" class="dropdown-toggle btn-round btn-primary"
                              data-toggle="dropdown">Missed Punch
                              <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                              <li><a (click)="routeToMissedPunch('MP')" style="cursor: pointer;">Missed Punch</a></li>
                              <li><a (click)="routeToMissedPunch('DE')" style="cursor: pointer;">Deviation</a></li>
                            </ul>
                          </li>
                        </ul>

                      </div> -->

                  <!-- <div class="col-md-2"> <b>&nbsp;</b> <br> <a class="btn btn-primary btn-sm Bulk-Attendance-btn "
                          routerLink="/attendance/self-checkin" *ngIf="show_check_in_out">
                          Check In</a></div> -->

                  <!-- <div class="col-md-2">
                        <b>&nbsp;</b> <br>
                        <select class="form-control" (change)="changeProductType($event)" title="Product Type"
                          *ngIf="this.show_product_type_dropdown">
                          <option *ngFor="let ya of product_type_array" [selected]="product_type==ya.product_type_id"
                            [value]="ya.product_type_id">{{ya.product_type}}</option>
                        </select>

                      </div>
                    </div>

                  </div> -->


                  <!-- <div class="col-md-2" style="margin-top: 2.5rem;float: right;">
                    <span style="font-weight: bold;">&nbsp;</span>
                    <a (click)="openSidebar()" class="btn excel-btn-box results filter-onlick-btn"
                      style="padding-top: 9px;">Search<i class="fa fa-filter"></i></a>
                  </div> -->



                  <div class="col-md-2 col-sm-2">
                    <!-- (keyup)="search($event)" -->
                    <input type="text" class="form-control wide-width" placeholder="Search Employee(s)"
                      (keyup)="search($event.target.value)" maxlength="200" [(ngModel)]="search_key" />
                  </div>

                  <div class="col-md-2" style="padding-top: 9px;">

                    <span style="color: blue; font-weight: bold;  font-size: 12px;"> Total :
                      {{attendanceSummaryData.total_att}}</span>


                  </div>

                  <div class="col-md-2">
                    <div class="top-right-outer-box">

                      <!-- <a (click)="confirmAlertButton()" class="btn btn-secondary manage-btn"
                        style="padding-top: 9px;border-color: lightblue;" title="Lock Payment Advice">
                        Lock All Payment Advice</a> -->
                      <!--  &nbsp;

                      <a (click)="openSendNotificationPopup()" class="btn btn-secondary manage-btn"
                        style="padding-top: 9px;border-color: lightblue;" title="Create Ticket"><i class="fa fa-plus">
                        </i> Ticket
                      </a> &nbsp;

                      <div class="header-notification-box">
                        <a class="dropdown-toggle notification-show" (click)="Get_Tickets()">
                          <i class="btn btn-secondary manage-btn ti-bell" style="padding: 2px;"></i>
                          <span
                            *ngIf="unread_query_cnt_data && unread_query_cnt_data.unread_tickets && unread_query_cnt_data.unread_tickets !='0'"
                            class="email-notify noti-count">{{unread_query_cnt_data.unread_tickets}}</span>
                        </a>
                      </div> -->
                      <!-- <a (click)="Get_Tickets()" class="btn btn-primary" style="padding-top: 9px;"  title="View notification"><i class="fa fa-eye"></i> notification</a> -->


                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="top-right-outer-box">

                      <a (click)="download_bulk_att()" title="View Report"
                        class="btn btn-round btn-success excel-btn-box" style="padding-top: 9px;">&nbsp;<i
                          aria-hidden="true" class="fa fa-file-pdf" style="color: red;"></i></a>


                      <div class="mag-left-5">

                        <ul class="nav nav-pills" role="tablist">
                          <li role="presentation" class="dropdown">
                            <a href="javascript:void();" class="dropdown-toggle btn-round btn-primary"
                              data-toggle="dropdown">Bulk Upload
                              <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                              <!-- <li><a (click)="routeToBulkAttn()" style="cursor: pointer;">Attendance(s)</a></li> -->
                              <li><a (click)="routeToBulkAttnNew()" style="cursor: pointer;">Attendance(s) New</a></li>
                              <li><a (click)="go_to_generate_payment_advice()" style="cursor: pointer;">Generate Payment
                                  Advice
                                </a></li>
                              <li><a (click)="go_to_upload_allowance()" style="cursor: pointer;">Allowance &
                                  Deduction</a></li>
                              <li><a (click)="go_to_dadsrkm_allowance()" style="cursor: pointer;">DSR Days & Kilometers
                                </a></li>
                              <li><a (click)="routeToLockAttn()"
                                  *ngIf="(filteredEmployees?.length >0 && filteredEmployees[0]?.payout_with_attendance == 'P')"
                                  style="cursor: pointer;">Lock Attendance</a>
                              </li>

                              <!-- <li><a (click)="routeToMissedPunch()" style="cursor: pointer;">Missed Punch</a></li> -->

                            </ul>
                          </li>
                        </ul>

                      </div>

                      <div class="mag-left-5">

                        <ul class="nav nav-pills" role="tablist">
                          <li role="presentation" class="dropdown">
                            <a href="javascript:void();" class="dropdown-toggle btn-round btn-primary"
                              data-toggle="dropdown">Missed Punch
                              <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                              <li><a (click)="routeToMissedPunch('MP')" style="cursor: pointer;">Missed Punch</a></li>
                              <li><a (click)="routeToMissedPunch('DE')" style="cursor: pointer;">Deviation</a></li>
                            </ul>
                          </li>
                        </ul>

                      </div>




                      <a (click)="openSidebar()" class="btn excel-btn-box results filter-onlick-btn"
                        style="padding-top: 9px;">Search<i class="fa fa-filter"></i></a>


                    </div>
                  </div>


                </div>




              </div>




            </div>

            <div class="card-body" style="font-size: 12px;">
              <!-- <div class="row" style="margin-top: .5rem;">

                <div class="col-md-3 col-sm-3">

                </div>

                <div class="col-md-2">

                </div>

                <div class="col-md-7">
                  <div class="top-right-outer-box">

                    <a (click)="openSendNotificationPopup()" class="btn btn-secondary manage-btn" style="padding-top: 9px;border-color: lightblue;"
                      title="Create Ticket"><i class="fa fa-plus">  </i> Ticket
                    </a> &nbsp;

                    <div class="header-notification-box">
                      <a class="dropdown-toggle notification-show" (click)="Get_Tickets()">
                        <i class="btn btn-secondary manage-btn ti-bell" style="padding: 2px;"></i>
                        <span *ngIf="unread_query_cnt_data && unread_query_cnt_data.unread_tickets && unread_query_cnt_data.unread_tickets !='0'" class="email-notify noti-count">{{unread_query_cnt_data.unread_tickets}}</span>
                      </a>
                    </div>


                  </div>
                </div>


              </div> -->
              <ul class="list">

                <ng-container
                  *ngFor="let emp_data of filteredEmployees | paginate: { itemsPerPage: limit, currentPage: p, totalItems: attendanceSummaryData.total_att };let i=index">
                  <li class="manage-list-row clearfix">

                    <div class="job-info">
                      <div class="job-img">
                        <!-- <img src="{{emp_data.photopath==''?'/assets/img/user-1.jpg':emp_data.photopath}}"
                            class="attachment-thumbnail" alt="user images"> -->

                        <img src="{{emp_data.photopath}}" class="attachment-thumbnail" alt="user-images"
                          *ngIf="(emp_data.photopath != '' && emp_data.photopath != null)">
                        <div class="img-responsive img-circle txt"
                          *ngIf="(emp_data.photopath == '' || emp_data.photopath == null)" alt="user">
                          {{emp_data.emp_name.charAt(0)}}{{emp_data.emp_name.charAt(emp_data.emp_name.indexOf('
                          ') + 1)}}</div>


                      </div>
                      <div class="job-details">
                        <h3 class="job-name"><a class="job_name_tag">{{emp_data.emp_name}}
                            [{{emp_data.mobile}}]</a>
                          <!-- <span class="full-time-btn">{{emp_data.time_criteria}}</span> -->
                        </h3>
                        <small class="job-company" title="Designation"><i
                            class="ti-briefcase"></i>{{emp_data.post_offered}}&nbsp;&nbsp;</small>


                        <small class="job-company"><strong>Marked Attn.:</strong>
                          {{emp_data.marked_attendance}}</small>
                        <small class="job-sallery"><strong>Approved Attn.: </strong>
                          {{emp_data.approved_attendance}}</small>
                        <small><strong>DOJ:</strong>
                          {{emp_data.dateofjoining}}</small>
                        <small *ngIf="emp_data.dateofrelieveing"><strong>DOL:</strong>
                          {{emp_data.dateofrelieveing}}</small>

                        <div class="candi-skill">
                          <small *ngIf="emp_data.orgempcode; else elseblock;" class="job-sallery"><strong>Emp Code
                            </strong>
                            {{emp_data.orgempcode}}</small>
                          <ng-template #elseblock>
                            <small class="job-sallery"><strong>TP Code </strong>
                              {{emp_data.tp_code}}</small>
                          </ng-template>
                          <!-- <small *ngIf="emp_data.tds;" class="job-sallery"><strong>TDS
                            </strong>
                            &#8377; {{emp_data.tds}}</small> -->
                          <span class="social-box"
                            title="Salary Setup Manday(s) | Mandays (Days Opted) ">{{emp_data.salary_days_opted=='N'?'Full-Day':emp_data.salarydays}}
                            ({{emp_data.salary_days_opted}})</span> &nbsp;
                          <!-- {{emp_data.monthly_att_approval_status|json}} -->
                          <span class="social-box-new" title="Attendance Marking Status"
                            [ngStyle]="{'color': (emp_data.monthly_att_approval_status == 'Y') ? 'green':  (emp_data?.monthly_att_approval_status == 'N' && (emp_data.marked_attendance?.split(' ')[0])>0) ? 'blue' : '#e63946'}">
                            {{emp_data.monthly_att_approval_status == 'Y'?'Verified':
                            (emp_data.monthly_att_approval_status == 'N' && (emp_data.marked_attendance?.split('
                            ')[0])>0)?'Marked':'Yet to Mark'}}</span>&nbsp;
                          <small class="job-company" title="Department"><i class="fa fa-sitemap">
                            </i> {{emp_data.posting_department}}</small>
                          <small class="job-company" title="Organization Unit"><i class="fa fa-building-o">
                            </i> {{emp_data.assignedous}}</small>
                        </div>

                      </div>
                    </div>
                    <div *ngIf="(emp_data.time_criteria =='Full Time' && (emp_data.lockstatus!='Locked'))"
                      class="job-buttons">

                      <!-- <a (click)="openViewNotificationPopup()">
                        <i class="fa fa-eye"></i>
                      </a>

                      <a (click)="openSendNotificationPopup()">
                        <i class="fa fa-edit"></i>
                      </a> -->
                      &nbsp;
                      <a class="btn btn-blue manage-Update myButton-box" data-toggle="tooltip" data-placement="top"
                        (click)="toggleCalendar(i, emp_data, 'toggle')">
                        Update
                        Attendance</a>

                    </div>
                    <div
                      *ngIf="(emp_data.time_criteria =='Full Time' && ((emp_data.lockstatus == 'Locked' && emp_data?.payout_with_attendance=='P' && emp_data.deviationpaystatus=='N')))"
                      class="job-buttons">
                      <a class="btn btn-primary manage-btn myButton-box" data-toggle="tooltip" data-placement="top"
                        (click)="toggleCalendar(i, emp_data, 'toggle')">
                        Payout
                        Generated</a>

                    </div>


                    <div
                      *ngIf="(emp_data.time_criteria =='Full Time' && (emp_data.lockstatus == 'Locked' && emp_data?.payout_with_attendance != 'P') || ((emp_data.lockstatus == 'Locked' && emp_data?.payout_with_attendance=='P' && emp_data.deviationpaystatus=='Y')))"
                      class="job-buttons">
                      <a class="btn btn-success manage-btn myButton-box" data-toggle="tooltip" data-placement="top"
                        (click)="toggleCalendar(i, emp_data, 'toggle')">View
                        Attendance</a>


                    </div>
                    <div *ngIf="(emp_data.time_criteria =='Flexible Time' && (emp_data.lockstatus!='Locked'))"
                      class="job-buttons">
                      &nbsp;
                      <a class="btn btn-blue manage-Update myButton-box" data-toggle="tooltip" data-placement="top"
                        (click)="openWorkReportModal(emp_data)">Approve Work Report</a>

                    </div>

                    <!-- <div *ngIf="(emp_data?.time_criteria =='' || emp_data?.time_criteria != 'Full Time')"
                      class="job-buttons not-a-full-time-btn" style="color: blanchedalmond;">
                      {{emp_data?.time_criteria ==''?'Not a Full-Time Employee': emp_data?.time_criteria}}

                    </div> -->

                    <div class="hide-show-outer-box" [ngClass]="{'start': emp_data.showCalendar==true}">

                      <ul class="calendar-inner-box " style="overflow: hidden;">


                        <li class="nav-item head-title-box  "><span class="day-box1 ">Mon</span> </li>
                        <li class="nav-item head-title-box  "><span class="day-box1 ">Tue</span> </li>
                        <li class="nav-item head-title-box  "><span class="day-box1 ">Wed</span> </li>
                        <li class="nav-item head-title-box  "><span class="day-box1 ">Thu</span> </li>
                        <li class="nav-item head-title-box  "><span class="day-box1 ">Fri</span> </li>
                        <li class="nav-item head-title-box  "><span class="day-box1 ">Sat</span> </li>
                        <li class="nav-item head-title-box  "><span class="day-box1 ">Sun</span> </li>

                        <ng-container *ngFor="let dd of blankCalendar; let im=index;">
                          <!-- {{calendar_data[0]?.attday==dd.w_date.split('-')[0]}} -->

                          <li
                            [ngClass]="{'present-days': dd?.attendance_type=='PP' ,'od-days': dd?.attendance_type=='OD',
                              'absent-days': dd?.attendance_type=='AA' , 'weekoff-days': dd?.attendance_type=='WO',
                              'half-days': dd?.attendance_type=='HD', 'holiday': dd?.attendance_type=='HO', 'restricted-holiday': dd?.attendance_type=='RH', 'tr-days': dd?.attendance_type=='TR','tr-lwp': dd?.attendance_type=='LWP','tr-asl': dd?.attendance_type=='ASL','tr-swl': dd?.attendance_type=='SWL',
                              'leave-days': dd?.attendance_type=='LL' || dd?.leavetype=='CO'|| dd?.attendance_type=='HL', 'missed-punch': dd?.attendance_type=='MP',
                              'disabled-date-color': check_date(dd.w_date, im), 'wfh-days': dd?.attendance_type=='WFH',}"
                            class="nav-item" (click)="calendarClick(dd, im)" (mousedown)="onMouseDown($event, dd)"
                            (mousemove)="onMouseMove($event, dd)" (mouseup)="onMouseUp($event)">
                            <a class="calender-box"><span
                                [ngStyle]="{'color': check_date(dd.w_date, im) || !dd.attendance_type || dd.attendance_type=='CLS' ? 'black': 'white'}"
                                [ngClass]="{'selected-items':dd.localSelection == true}" class="date-box">{{dd.w_date
                                != '' ? dd.w_date.split('-')[0] : ''}} </span>

                              <span
                                *ngIf="dd.attendance_type != undefined && dd.attendance_type!='CLS' && dd.attendance_type != 'LL' && dd.attendance_type != 'HD'&& dd.attendance_type != 'HL'"
                                class="label-design"
                                [ngClass]="{'important-text': check_date(dd.w_date, im) && dd.attendance_type}"
                                [ngStyle]="dd.localSelection ? {'margin-left':'70px', 'margin-right': '-4px'} : {}"><i
                                  *ngIf="dd.approval_status=='A'" style="left:-85px;" class="fa fa-check"
                                  aria-hidden="true"></i>{{check_holiday_type(dd.attendance_type,
                                dd.w_date.split('-')[0])}}
                              </span>

                              <span
                                *ngIf="dd.attendance_type != undefined && dd.attendance_type!='CLS' && (dd.attendance_type == 'LL' || dd.attendance_type == 'HD'|| dd.attendance_type == 'HL')"
                                class="label-design"
                                [ngClass]="{'important-text': check_date(dd.w_date, im) && dd.attendance_type}"
                                [ngStyle]="{
                                  'margin-left': dd.localSelection ? '70px' : '',
                                  'margin-right': dd.localSelection ? '-4px' : '',
                                }"><i *ngIf="dd.approval_status=='A'" style="left:-75px;" class="fa fa-check"
                                  aria-hidden="true"></i>({{dd.attendance_type}} <ng-container
                                  *ngIf="dd.leavetype">-{{dd.leavetype}}</ng-container>)

                              </span>

                              <!-- {{check_date(dd.w_date, im)}} -->
                            </a>
                          </li>


                        </ng-container>

                      </ul>

                      <div class="payout-breakup" (click)="remove_selection()"
                        *ngIf="(emp_data.time_criteria =='Full Time'  && !((emp_data.lockstatus == 'Locked' && emp_data?.payout_with_attendance=='P')))">

                        <ng-container *ngIf="(is_att_sal_hide!='Y')">
                          <div class="row" style="border: 1px; border-collapse: collapse;">

                            <div class="col-md-2"><strong>Pay Days</strong></div>
                            <div class="col-md-2">{{payroll_data?.salarydays}}</div>
                            <div class="col-md-2"><strong>EPF Contribution</strong></div>
                            <div class="col-md-2">&#8377; {{payroll_data?.epfcontribution}}</div>
                            <div class="col-md-2"><strong>Pay Amount</strong></div>
                            <div class="col-md-2">&#8377; {{payroll_data?.costtoemployer}}</div>

                          </div>

                          <div class="row">
                            <div class="col-md-2"><strong>ESIC Contribution</strong></div>
                            <div class="col-md-2">&#8377; {{payroll_data?.esicontribution}}</div>

                            <ng-container *ngIf="emp_data.tds == 0 || emp_data.tds">
                              <div class="col-md-2"><strong>TDS</strong></div>
                              <div class="col-md-2">&#8377; {{emp_data?.tds}}</div>
                            </ng-container>

                            <ng-container *ngFor="let vd of voucher_data;">
                              <div class="col-md-2"><strong>{{vd?.voucher_name}} </strong></div>
                              <div class="col-md-2">
                                <span *ngIf="vd?.amount"> &#8377; {{vd?.amount}}</span>
                              </div>
                            </ng-container>
                          </div>
                        </ng-container>




                        <!-- <div class="row">
                          <div class="col-md-2"><strong>{{voucher_data[1]?.voucher_name}}</strong></div>
                          <div class="col-md-2"> <span *ngIf="voucher_data[1]?.amount">&#8377;
                              {{voucher_data[1]?.amount}}</span></div>

                        </div>

                        <div class="row">

                          <div class="col-md-8">&nbsp;</div>

                          <div class="col-md-2"><strong>{{voucher_data[2]?.voucher_name}}</strong></div>
                          <div class="col-md-2"><span *ngIf="voucher_data[2]?.amount">&#8377;
                              {{voucher_data[2]?.amount}}</span></div>
                        </div>

                        <div class="row">

                          <div class="col-md-8">&nbsp;</div>

                          <div class="col-md-2"><strong>{{voucher_data[3]?.voucher_name}}</strong></div>
                          <div class="col-md-2"><span *ngIf="voucher_data[3]?.amount">&#8377;
                              {{voucher_data[3]?.amount}}</span></div>
                        </div>

                        <div class="row">

                          <div class="col-md-8">&nbsp;</div>

                          <div class="col-md-2"><strong>{{voucher_data[4]?.voucher_name}}</strong></div>
                          <div class="col-md-2"><span *ngIf="voucher_data[4]?.amount">&#8377;
                              {{voucher_data[4]?.amount}}</span></div>
                        </div> -->




                      </div>

                      <div class="row" style="font-size: 14px;border-style:groove;" (click)="remove_selection()"
                        *ngIf="(emp_data.time_criteria =='Full Time' && (is_att_sal_hide!='Y') && !((emp_data.lockstatus == 'Locked' && emp_data?.payout_with_attendance=='P')))">
                        <div class="col-md-3"><strong>Cost To Employer</strong></div>
                        <div class="col-md-3">&#8377; {{payroll_data?.costtoemployer}}
                        </div>

                        <div class="col-md-3"><strong>Payout of Associate</strong>

                        </div>
                        <div class="col-md-3"> &#8377; {{payroll_data?.inhandsalary}}</div>
                      </div>
                      <div class="row" style="font-size: 12px;border-style: groove;border-top: 2px solid #eef5f7;">
                        <div class="col-md-2">
                          <label>Leave Template</label>
                          <label *ngIf="emp_data?.holiday_state_name !=''">Holiday State</label>
                        </div>
                        <div class="col-md-2">
                          <span *ngIf='emp_data.template_txt'>
                            {{emp_data?.template_txt[0]?.templatedesc}}
                          </span>
                          <span *ngIf="emp_data?.holiday_state_name !=''">
                            {{emp_data?.holiday_state_name}}
                          </span>
                        </div>
                        <div class="col-md-8">
                          <div class="row" style="padding: 0px;">
                            <ng-container *ngFor="let x of emp_data.balance_txt">
                              <div class="col-md-4" style="padding: 0px;">
                                <label>{{x.typename}}</label>&nbsp;
                                <span>[{{x.typecode}}] : {{x.prev_bal}} </span>
                              </div>
                            </ng-container>
                            <ng-container *ngIf='emp_data.template_txt'>
                              <label>Weekly Off : </label>&nbsp;
                              <span>[WO]
                                <!-- :{{emp_data?.template_txt[0]?.leave_details?.weekly_off_days_name?.split(',')}} -->
                                :
                                {{display_week_off(emp_data?.template_txt[0]?.leave_details?.weekly_off_days_name_txt)}}
                              </span>
                              <!-- {{emp_data?.template_txt[0]?.leave_details?.weekly_off_days_name_txt |json}} -->
                            </ng-container>


                          </div>
                        </div>
                      </div>

                      <ng-container *ngIf="check_access_right_cdn(); else noAccess">
                        <div class="attendance-btn-inner-box padd-top-5" (click)="remove_selection()"
                          *ngIf="emp_data.lockstatus !='Locked' || (emp_data.lockstatus == 'Locked' && emp_data?.payout_with_attendance=='P' && emp_data.deviationpaystatus=='N')">

                          <span style="display: inline-block;" (click)="handleInnerClick($event)">

                            <button type="button" class="btn btn-primary btn-design"
                              (click)="present_click()">Present</button>
                            <button type="button" class="btn btn-primary btn-design wfh-days"
                              (click)="wfh_click()">WFH</button>
                            <button type="button" class="btn btn-primary btn-design" (click)="onduty_click()"
                              style="color: #fff;background: #002dd38e;">On
                              Duty</button>

                            <button type="button" class="btn btn-danger btn-design"
                              (click)="absent_click()">Absent</button>
                            <button type="button" class="btn btn-success btn-design" (click)="half_click(i)">Half
                              Day</button>
                            <button type="button" class="btn btn-warning btn-design"
                              (click)="leave_click(i)">Leave</button>
                            <button type="button" class="btn btn-info btn-design"
                              style="color: #fff;background: #c1e309;" (click)="holiday_click()">Holiday</button>
                            <!-- <button type="button" class="btn btn-secondary btn-design"
                            (click)="clear_click()">Clear</button> -->
                            <button type="button" class="btn btn-info btn-design" (click)="weekoff_click()">Weekly
                              off</button><button type="button" class="btn btn-primary btn-design"
                              (click)="ontour_click()" style="color: #fff;background: #232d4e8e;">On
                              Tour</button>
                            <button type="button" class="btn btn-primary btn-design" (click)="onlwp_click()"
                              style="color: #fff;background: #f16f85;">LWP</button>
                            <button type="button" class="btn btn-primary btn-design" (click)="onasl_click()"
                              style="color: #fff;background: #6b84d88e;">ASL</button>
                            <!-- <button type="button" class="btn btn-primary btn-design"
                              (click)="getOpeningBalance(emp_data.emp_id, emp_data.leave_bank_id)">Opening
                              Balance</button> -->
                          </span>

                        </div>

                        <div class="attendance-btn-inner-box padd-top-1" (click)="remove_selection()"
                          *ngIf="emp_data.lockstatus!='Locked' || (emp_data.lockstatus == 'Locked' && emp_data?.payout_with_attendance=='P' && emp_data.deviationpaystatus=='N')">
                          <!-- <a class="btn btn-primary manage-btn myButton-box"
                            (click)="save_approve_attendance('SaveBulkAttendance')">Save Attendance</a> -->

                          <!-- *ngIf="emp_data.tdsmode != 'Auto'" -->

                          <!-- {{attendanceSummaryData?.tds_enablestatus}} -->
                          <!-- <a *ngIf="emp_data.lockstatus!='Locked' && emp_data.advicelockstatus != 'Locked' && payroll_data && payroll_data?.salarydays > 0"
                            class="btn manage-btn myButton-box transparent-btn" (click)="lockAdvice(emp_data.emp_code)"
                            style="border-color: #0e49ed !important;">Lock Payment Advice
                          </a> -->
                          <!-- <a *ngIf="emp_data.approval_status && emp_data.approval_status=='A'"
                            class="btn manage-btn myButton-box transparent-btn" (click)="generate_payment_advice(emp_data)"
                            style="border-color: #0e49ed !important;">Generate Payment Advice
                          </a> -->
                          <span class="btn manage-btn myButton-box transparent-btn"
                            style="border-color: #0e49ed !important;" *ngIf="(emp_data.advicelockstatus == 'Locked')"><i
                              class="fa fa-lock" aria-hidden="true"> </i> Payment Advice Locked</span>

                          <a *ngIf="attendanceSummaryData && attendanceSummaryData?.tds_enablestatus=='N'"
                            style="width: 18rem;font-weight: 500;color: black;border-color: #0e49ed !important;"
                            class="btn btn-secondary manage-btn" (click)="openTDSPopup(emp_data.emp_code)">
                            TDS
                          </a>

                          <a *ngIf="emp_data.lockstatus!='Locked'" class="btn btn-success manage-btn myButton-box"
                            (click)="save_approve_attendance('ApproveBulkAttendance')"
                            style="border-color: black;">Approve Attendance</a>

                          <a *ngIf="emp_data.lockstatus=='Locked'" class="btn btn-success manage-btn myButton-box"
                            (click)="getDeviationSalaryDetails(emp_data)" style="border-color: black;">Lock Attendance
                          </a>

                          <a *ngIf="emp_data.lockstatus!='Locked'" class="btn btn-cancel btn-sm  manage-btn"
                            title="Click for Allowance & deduction" style="border-color: black;"
                            (click)="openAllowDeductPopup()">
                            Allowance & Deduction
                          </a>
                          <a class="btn btn-primary manage-btn myButton-box"
                            (click)="getOpeningBalance(emp_data.emp_id, emp_data.leave_bank_id)">
                            Opening
                            Balance
                          </a>
                          <a class="btn btn-secondary manage-btn transparent-btn"
                            style="border-color: #0e49ed !important;" (click)="clear_click()">
                            Clear
                          </a>
                          <!-- *ngIf="(tp_account_id == '6441' || tp_account_id == '3088' || tp_account_id == '653' || tp_account_id == '981'|| tp_account_id == '6099')" -->
                          <a class="btn btn-blue manage-Update myButton-box transparent-btn"
                            (click)="getEmp_code(emp_data)">
                            Early / Late Fine
                          </a>

                          <!-- <a style="width: 18rem;font-weight: 500;color: black;border-color: #0e49ed !important;"
                          class="btn btn-secondary manage-btn" (click)="routeToMissedPunch()">
                          Missed Punch
                        </a> -->

                          <!-- <a class="btn btn-danger manage-btn myButton-box">Cancel</a> -->
                        </div>
                      </ng-container>
                      <ng-template #noAccess>
                        <div class="attendance-btn-inner-box padd-top-5">
                          <span class="text-info" style="color: lightcoral;font-size: 1.3rem;">You only have permission
                            to view attendance records. Any changes or modifications are not allowed</span>
                        </div>
                      </ng-template>
                      <div style="height: 5%;" (click)="remove_selection()">

                      </div>

                    </div>

                  </li>
                </ng-container>


              </ul>

              <div class="flexbox padd-10 pagination-outer-box" *ngIf="attendanceSummaryData.total_att > limit">
                <pagination-controls (pageChange)="get_page($event)" maxSize="9" directionLinks="true" autohide="true"
                  responsive="true" previousLabel="Prev" nextLabel="Next" screenReaderPaginationLabel="Pagination"
                  screenReaderPageLabel="page" screenReaderCurrentLabel="You're on page"
                  style="font-size: 2rem;padding: 6px;font-weight: bold" class="float-right"></pagination-controls>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- /row -->
    </div>
  </div>
  <!-- /#page-wrapper -->



</section>
<app-footer></app-footer>


<!--------Allowance & Deduction Popup-------->
<div [@grooveState]="showAllowDeductPopup?'active':'inactive'" id="allowanceDeduct" class="modal">
  <div [@dongleState]="showAllowDeductPopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form *ngIf="showAllowDeductPopup">
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Allowance and Deduction</h4>
          <button type="button" class="close" (click)="closeAllowanceDeductPopup()" data-dismiss="modal"
            aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
          <div class="row">

            <form [formGroup]="allowanceDeductForm">
              <div class="col-md-12">
                <div class="col-md-12" *ngFor="let head of dynamicHeads">
                  <input type="radio" name="allowdeduct"
                    [id]="head.voucher_name.toLowerCase().replace(' ', '_')+head.headid"
                    [checked]="ad.id.value == head.headid.toLowerCase()" (change)="allowDeductChange(head)">
                  <label [for]="head.voucher_name.toLowerCase().replace(' ', '_')+head.headid">{{ head.voucher_name
                    }}</label>
                  <span>{{ showTaxble(head.headid) }}</span>
                </div>
              </div>

              <div class="col-md-11">
                <input class="form-control" formControlName="value" placeholder="Enter Amount (in Rs.)">
              </div>

              <div class="col-md-12">
                <textarea rows="5" cols="70" formControlName="remarks" placeholder="Enter Remarks..."></textarea>
              </div>
            </form>


          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-info" (click)="saveTpVoucher()">save</button>

          <button class="btn btn-cancel" (click)="closeAllowanceDeductPopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!--------Allowance & Deduction Popup-------->


<!-----------Leave Types Popup-------->
<div [@grooveState]="showLeaveTypes?'active':'inactive'" id="LeaveType" class="modal" style="z-index:1000;">
  <div [@dongleState]="showLeaveTypes?'active':'inactive'" class="modal-dialog" style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form *ngIf="showLeaveTypes" [formGroup]="markLeaveForm">
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Mark Leave Type [ {{filteredEmployees[markLeaveForm.value.emp_index].emp_name}} ]
          </h4>
          <button type="button" class="close" aria-hidden="true" (click)="closeLeaveTypes()">&times;</button>
        </div>
        <div class="modal-body">
          <!-- <div class="col-md-6">
            <label>Select Date</label>
            <input class="form-control" type="text" autocomplete="off" formControlName="attendancedate" readonly>
          </div> -->
          <div class="form-group">
            <!-- <label>Mark Leave Type</label> -->
            <div class="custom-radio">

              <div
                *ngIf="filteredEmployees && filteredEmployees.length>0 && filteredEmployees[markLeaveForm.value.emp_index].balance_txt && markLeaveForm.value.att_type !='HD'"
                style="margin-bottom:2rem">
                <div class="row">
                  <div class="col-md-4" style="font-weight: bold;"> Select Leave Day Type</div>
                  <div class="col-md-6"><input type="radio" id="full_day" name="full_half_day" value="LL"
                      (change)="changeLeaveHalfFullDay($event)" [checked]="markLeaveForm.value.att_type=='LL'">
                    <label for="full_day">Full-Day</label>

                    <input type="radio" id="half_day" name="full_half_day" value="HL"
                      (change)="changeLeaveHalfFullDay($event)" [checked]="markLeaveForm.value.att_type=='HL'">
                    <label for="half_day">Half-Day</label>
                  </div>
                </div>

              </div>

              <ng-container *ngFor="let fe of filteredEmployees[markLeaveForm.value.emp_index].balance_txt">
                <input type="radio" id="{{fe.typecode}}" name="leave_options" value="{{fe.typecode}}"
                  (change)="changeLeaveType($event, fe.prev_bal)"
                  [checked]="markLeaveForm.value.leavetype=='{{fe.typecode}}'">
                <label for="{{fe.typecode}}">{{fe.typename}} [{{fe.typecode}}] - <strong>{{fe.prev_bal}}</strong>
                  Days</label> <span style="color:#0e49ed;font-size:12px">({{get_pay_type(fe.typecode)}}) </span><br>
              </ng-container>

              <ng-container *ngIf="markLeaveForm.value.att_type=='HD'">
                <input type="radio" id="AA" name="leave_options" value="AA" (change)="changeLeaveType($event,'')"
                  [checked]="markLeaveForm.value.leavetype==''">
                <label for="AA">Absent [AA] </label><br>
              </ng-container>

              <ng-container
                *ngIf="(markLeaveForm.value.att_type=='LL' || markLeaveForm.value.att_type=='HL' ) && filteredEmployees[markLeaveForm.value.emp_index].comp_off_txt?.is_comp_off_applicable=='Y'">
                <input type="radio" id="CO" name="leave_options" value="CO"
                  (change)="changeLeaveType($event, filteredEmployees[markLeaveForm.value.emp_index].comp_off_txt?.tot_co_bal)"
                  [checked]="markLeaveForm.value.leavetype=='CO'">
                <label for="CO">Compensatory Off [CO] -
                  <strong>{{filteredEmployees[markLeaveForm.value.emp_index].comp_off_txt?.tot_co_bal}} </strong> Days
                </label><br>
              </ng-container>


              <!-- <input type="radio" id="casual" name="leave_options" value="CL" (change)="changeLeaveType('CL')"
              [checked]="markLeaveForm.value.leavetype=='CL'">
              <label for="casual">Casual Leave [CL]</label><br>

              <input type="radio" id="privilege" name="leave_options" value="PL" (change)="changeLeaveType('PL')"
              [checked]="markLeaveForm.value.leavetype=='PL'">
              <label for="privilege">Privilege Leave [PL]</label><br>

              <input type="radio" id="medical" name="leave_options" value="ML" (change)="changeLeaveType('ML')"
              [checked]="markLeaveForm.value.leavetype=='ML'">
              <label for="medical">Medical Leave [ML]</label><br>

              <input type="radio" id="maternity" name="leave_options" value="MatL" (change)="changeLeaveType('MatL')"
              [checked]="markLeaveForm.value.leavetype=='MatL'">
              <label for="maternity">Maternity Leave [MatL]</label><br> -->

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeLeaveTypes()" value="Cancel">
          <input type="submit" class="btn btn-success" (click)="updateLeaveType()" value="Update">
        </div>
      </form>
    </div>
  </div>
</div>
<!-----------Leave Types Popup-------->



<!-----------Opening Balance Popup-------->
<div [@grooveState]="showOpenBalance?'active':'inactive'" id="openBalance" class="modal" style="z-index:1000;">
  <div [@dongleState]="showOpenBalance?'active':'inactive'" class="modal-dialog" style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:50px;width:75rem;margin-left:-5rem;">
      <form *ngIf="showOpenBalance" [formGroup]="markLeaveForm">
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Opening Balance</h4>
          <button type="button" class="close" aria-hidden="true" (click)="closeOpenBalance()">&times;</button>
        </div>
        <div class="modal-body" style="overflow: auto;height: 44rem;">

          <ng-container *ngIf="showGenerateBtn== false">
            <div class="row">
              <div class="col-md-4">
                <label>Leaves Calender</label>
                <input type="text" class="form-control disable-background"
                  value="{{openLeaveBalanceForm.value.intial_leave_bal_txt[0].leaves_calender}}">
              </div>

              <div class="col-md-4">
                <label>Period From</label>
                <input type="text" class="form-control disable-background"
                  value="{{openLeaveBalanceForm.value.intial_leave_bal_txt[0].periodfrom}}">
              </div>

              <div class="col-md-4">
                <label>Period To</label>
                <input type="text" class="form-control disable-background"
                  value="{{openLeaveBalanceForm.value.intial_leave_bal_txt[0].periodto}}">
              </div>
            </div>

            <br>

            <ng-container *ngFor="let olb of openLeaveBalanceForm.value.intial_leave_bal_txt;let i=index;">
              <div class="card">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <label>Leave Type</label>
                      <input type="text" class="form-control disable-background"
                        value="{{olb.typename}}- ({{olb.typecode}})">
                    </div>

                    <div class="col-md-6">
                      <label>Opening Balance</label>
                      <input type="text" class="form-control" value="{{olb.opening_bal}}" maxlength="5"
                        (keyup)="changeOpenBal($event, i)">
                    </div>


                  </div>


                </div>
              </div>
            </ng-container>
          </ng-container>

          <ng-container *ngIf="showGenerateBtn">
            <div>
              <button class="btn btn-primary" (click)="getGenerateOpeningBalance()">Generate Opening Balance</button>
            </div>
          </ng-container>


        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeOpenBalance()" value="Cancel">
          <input type="submit" class="btn btn-success" (click)="getUpdateLeaveBalance()" value="Update">
        </div>
      </form>
    </div>
  </div>
</div>
<!-----------Opening Balance Popup (keyup)="search($event.target.value)"-------->
<div id="sidebar" class="sidebar bg-dark text-white sidebar-menu_filter-box">
  <h3 class="filter-menu-header-text-box">Filter</h3>
  <!-- <button type="button" class="btn btn-user1 btn-round" (click)="resetFilter()">Clear</button>-->
  <a class="clear-box-btn" title="Clear Filter" (click)="resetFilter()">Clear</a>
  <button class="close-btn btn btn-danger1" (click)="closeSidebar()"><i class="fa fa-close"></i></button>
  <div class="sidebar-content-box">

    <div class="col-md-12 col-sm-12">
      <input type="text" [(ngModel)]="search_key_copy" placeholder="Search with employee(s)"
        class="form-control wide-width" style="width: 100%;" maxlength="200">
    </div>

    <div class="col-md-12 ">

      <div id="filterComponent">
        <div class="panel-group">

          <div class="panel panel-default">
            <div class="panel-heading panel_heading_gray  card-header" role="tab" id="headingOne2"
              data-toggle="collapse" data-parent="#accordion2" href="#collapseOne2" aria-expanded="false"
              aria-controls="collapseOne">
              <h4>Attendance Filter <i class="fa fa-angle-down"></i></h4>
            </div>
            <div id="collapseOne2" class="panel-collapse collapse card-body in" role="tabpane2">
              <div class="row">
                <div class="col-sm-12">


                  <div class="col-md-12">
                    <span style="margin: 10px;">Month-Year</span>
                    <!-- (change)="changeMonth($event)"  (change)="changeYear($event)"-->
                    <p style="display: inline-flex;">
                      <select class="form-control" [(ngModel)]="month_copy" style="width: 15rem;">
                        <!-- <option value="">Select</option> -->
                        <option *ngFor="let ma of monthsArray" [selected]="month==ma.id" [value]="ma.id">{{ma.month}}
                        </option>
                      </select>
                      <select class="form-control" [(ngModel)]="year_copy">
                        <!-- <option value="">Select</option> -->
                        <option *ngFor="let ya of yearsArray" [selected]="year==ya" [value]="ya">{{ya}}</option>

                      </select>
                    </p>

                  </div>



                  <!-- (change)="filter_emp($event.target.value)"-->

                  <div class="form-group">
                    <label class="control-label col-sm-12">Page Size</label>
                    <div class="col-sm-12 padd-0">
                      <select class="form-control" style="font-size: 12px;" [(ngModel)]="limit_copy">
                        <!-- <option value={{filteredEmployees.length}} [selected]="limit_copy==filteredEmployees.length">All
                        </option> -->
                        <option value="10" [selected]="limit_copy==10">10</option>
                        <option value="20" [selected]="limit_copy==20">20</option>
                        <option value="50" [selected]="limit_copy==50">50</option>
                        <option value="100" [selected]="limit_copy==100">100</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="control-label col-sm-12">Status</label>
                    <div class="col-sm-12 padd-0">
                      <select class="form-control" [(ngModel)]="filter_emp_val_copy">
                        <option value="All">All</option>
                        <option value="UnMarked">Yet to Mark</option>
                        <option value="Marked">Marked</option>
                        <option value="Verified">Verified</option>
                      </select>
                    </div>
                  </div>

                  <!--*ngIf="decoded_token.isEmployer=='1'" *ngIf="decoded_token.isEmployer=='1'" removed as per negd-->
                  <div class="form-group">
                    <label class="control-label col-sm-12">Organization Unit</label>
                    <div class="col-sm-12 padd-0 userOrgUnit">
                      <ng-multiselect-dropdown [placeholder]="'Select Organization Units'" [settings]="dropdownSettings"
                        [data]="orgList" [(ngModel)]="orgName_copy" [ngModelOptions]="{standalone: true}">
                      </ng-multiselect-dropdown>
                      <!-- (onFilterChange)="getOrgUnitData()" -->

                    </div>
                  </div>

                  <div class="form-group">
                    <label class="control-label col-sm-12">Department</label>
                    <div class="col-sm-12 padd-0 userOrgUnit">

                      <ng-multiselect-dropdown [placeholder]="'Select Department'" [settings]="deptDropdownSettings"
                        [data]="deptList" [(ngModel)]="deptName_copy" [ngModelOptions]="{standalone: true}">
                      </ng-multiselect-dropdown>

                    </div>
                  </div>

                  <div class="form-group">
                    <label class="control-label col-sm-12">Designation</label>
                    <div class="col-sm-12 padd-0 userOrgUnit">

                      <ng-multiselect-dropdown [placeholder]="'Select Designation'" [settings]="desgDropdownSettings"
                        [data]="desgList" [(ngModel)]="desgName_copy" [ngModelOptions]="{standalone: true}">
                      </ng-multiselect-dropdown>
                    </div>
                  </div>





                </div>

              </div>
            </div>
          </div>



        </div>
      </div>

      <div class="text-center mrg-bot-25">
        <button type="button" class="btn btn-user1 btn-round btn-primary" (click)="change_sidebar_filter()"
          id="btnSetFilter">
          &nbsp;Apply</button>

      </div>
    </div>
  </div>
</div>

<!------TDS------->
<div [@grooveState]="showTDSPopup?'active':'inactive'" id="TDS_modal" class="modal">
  <div [@dongleState]="showTDSPopup?'active':'inactive'" class="modal-dialog" style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form *ngIf="showTDSPopup">
        <div class="modal-header theme-bg">
          <h4 class="modal-title">TDS</h4>
          <button type="button" class="close" (click)="closeTDSPopup()" data-dismiss="modal"
            aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
          <div class="row">

            <form [formGroup]="TDSForm">

              <div class="col-md-12">
                <label>Manual TDS</label>
                <input class="form-control" formControlName="manualTDS" (keyup)="changeManualTDS($event)"
                  placeholder="Enter Manual TDS">
              </div>

            </form>


          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-info" (click)="updateTDS()">Update</button>

          <button class="btn btn-cancel" (click)="closeTDSPopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!------TDS------->

<!-----------Locked Days Popup-------->
<div [@grooveState]="showLockedDaysPopup?'active':'inactive'" id="lockedPaidDays" class="modal" style="z-index:1000;">
  <div [@dongleState]="showLockedDaysPopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Lock Attendance[ {{locked_days_popup_data.emp_name}} ]
          </h4>
          <button type="button" class="close" aria-hidden="true" (click)="closeLockedDaysPopup()">&times;</button>
        </div>
        <div class="modal-body" style="height:25rem;">

          <div class="row">
            <div class="col-md-4">
              <label>Month-Year</label>
            </div>
            <div class="col-md-8">
              {{monthsArray[locked_days_popup_data?.salmonth-1]?.month}} - {{locked_days_popup_data?.salyear}}
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <label>Paid Days</label>
            </div>
            <div class="col-md-8">
              {{locked_days_popup_data.old_paid_days}}
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <label>Revised Paid Days</label>
            </div>
            <div class="col-md-8">
              {{locked_days_popup_data.new_paid_days}}
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <label *ngIf="locked_days_popup_data.difference >= 0">Additional Paid Days</label>
              <label *ngIf="locked_days_popup_data.difference < 0">LOP</label>
            </div>
            <div class="col-md-8">
              {{get_abs_value(locked_days_popup_data.difference)}}
            </div>
          </div>



          <div class="col-md-12">
            <span style="color: red;"># </span> <span
              style="font-weight: bold; color:rgba(120, 149, 243, 0.911)">{{locked_days_popup_data_msg}}</span>
          </div>

        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeLockedDaysPopup()" value="Cancel">
          <input type="submit" class="btn btn-success" (click)="updateLockedDays()" value="Confirm">
        </div>
      </form>
    </div>
  </div>
</div>
<!-----------Locked Days Popup-------->

<!-----------Send Notification Popup-------->
<div [@grooveState]="showNotificationPopup?'active':'inactive'" id="sendNotification" class="modal"
  style="z-index:1000;">
  <div [@dongleState]="showNotificationPopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form [formGroup]="notificationForm">
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Send Notification
          </h4>
          <button type="button" class="close" aria-hidden="true" (click)="closeSendNotificationPopup()">&times;</button>
        </div>
        <div class="modal-body" style="height:25rem; overflow:auto;">

          <div class="row" style="display: none;">
            <div class="col-md-4">
              <label>Subject :</label>
            </div>
            <div class="col-md-8">
              <select class="form-control" formControlName="subject_id">
                <option value="">Select</option>
                <option value="{{rmd.id}}" *ngFor="let rmd of ticketMasterData;">{{rmd?.tickettypename}}</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <label>Role</label>
            </div>
            <div class="col-md-8">
              <select class="form-control" formControlName="team" (change)="get_users_master()">
                <option value="">Select</option>
                <option value="{{rmd.role_id}}" *ngFor="let rmd of roles_master_data;">{{rmd.role_name}}</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <label>Users :</label>
            </div>
            <div class="col-md-8">
              <select class="form-control" formControlName="user_id">
                <option value="">Select</option>
                <option value="{{rmd.user_id}}" *ngFor="let rmd of user_by_role_id_data;">{{rmd.user_fullname}}</option>

              </select>
            </div>
          </div>


          <div class="row">
            <div class="col-md-4">
              <label>Message :</label>
            </div>
            <div class="col-md-8">
              <textarea style="width: 100%;" formControlName="query_comment"></textarea>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4">
              <!-- <label>:</label>-->
            </div>
            <div class="col-md-8">
              <input type="checkbox" (click)="check_isAdviceLockedForPayoutFlag($event)"
                [checked]="notificationForm.value.isAdviceLockedForPayoutFlag=='Y'">
              Generate payout for all approved attendance
            </div>
          </div>

          <!-- <div class="row" *ngIf="notificationForm.value.isAdviceLockedForPayoutFlag=='Y'">
          <div class="col-md-4">
            <label>Generate Payout Message :</label>
          </div>
          <div class="col-md-8">
            <textarea formControlName="attendanceLockedMsg" style="width:100%">
            </textarea>
          </div>
        </div>-->

        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeSendNotificationPopup()" value="Cancel">
          <!-- <input type="submit" class="btn btn-success" (click)="createSupportRequest()" value="Confirm"> -->
          <input type="submit" class="btn btn-success" (click)="createTicket()" value="Confirm">
        </div>
      </form>
    </div>
  </div>
</div>
<!-----------Send Notification Popup-------->


<!--Tickets Table-->
<div [@grooveState]="showTicketsTable?'active':'inactive'" id="ticketsTbl" class="modal" style="z-index:1000;">
  <div [@dongleState]="showTicketsTable?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;width: 800px;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Notification
          </h4>
          <button type="button" class="close" aria-hidden="true" (click)="closeTicketsTable()">&times;</button>
        </div>

        <div class="modal-body" style="height:25rem;overflow: auto;">
          <div class="col-md-1">
            <span style="font-weight: bold;">Status</span>
          </div>
          <div class="col-md-4">
            <select #statusDropdown class="form-control" (change)="changeStatus($event)">
              <option value="Open">Open</option>
              <option value="Closed">Closed</option>
              <option value="all">All</option>
            </select>
          </div>
          <table class="table" id="otherDeductionTable">
            <thead>
              <tr>
                <th>#</th>
                <th id="ember1089" class="sortable ember-view">
                  Ticket Id

                </th>
                <th id="ember1089" class="sortable ember-view">
                  Message
                </th>
                <th id="ember1089" class="sortable ember-view">
                  From User
                </th>
                <th id="ember1089" class="sortable ember-view">
                  To User
                </th>
                <!-- // <th id="ember1090" class="sortable header-role ember-view">
                //   Ticket Type

                // </th> -->
                <th id="ember1090" class="sortable header-role ember-view">
                  Created Date
                  <!---->
                </th>
                <th id="ember1090" class="sortable header-role ember-view">
                  Closing Date
                  <!---->
                </th>

                <th id="ember1090" class="sortable header-role ember-view">
                  Help & Support
                </th>

                <th id="ember1091" class="sortable ember-view">
                  Status
                  <!---->
                </th>
                <th id="ember1091" class="sortable ember-view">
                  Action
                  <!---->
                </th>

              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let ticket of filteredTickets; let i = index">
                <tr [ngStyle]="ticket.read_flag == 'N' ? {'font-weight': 'bold'} : {}">
                  <td>{{i+1}}</td>
                  <td>{{ticket.ticket_id}}

                  </td>
                  <td> {{ticket.ticket_comment}}</td>
                  <td> {{ticket.created_by_user}}</td>
                  <td> {{ticket.emp_name}}</td>
                  <!-- <td>{{ticket.emp_name}}</td>
                  <td>
                    {{ (ticket.orgempcode !== '' && ticket.orgempcode != null && ticket.orgempcode != undefined) ?
                    ticket.orgempcode : ticket.tp_code }}
                  </td>
                  <td>{{ticket.ticket_type}}</td> -->
                  <td>{{ticket.ticket_created_date}}</td>
                  <td>{{ticket.ticket_closure_date}}</td>
                  <td><a href="#SendMessage" data-toggle="modal" data-placement="top" class=" btn comment-btn "
                      (click)="help_support_popup(ticket)"><i class="fa fa-commenting" aria-hidden="true"></i></a>
                  </td>
                  <td>{{ticket.status}}</td>

                  <td>
                    <div class="dropdown float-right ember-view dropleft" *ngIf="ticket.status!='Closed'">
                      <a class="dropdown-toggle no-caret text-muted cursor-pointer ember-view" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        <svg width="20" height="20" viewBox="0 0 512 512" class="icon"
                          style="height: 20px;height: 20px;">
                          <path
                            d="M162 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M256 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32M350 224c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32"
                            id="Path"></path>
                          <path
                            d="M256 480c123.712 0 224-100.288 224-224S379.712 32 256 32 32 132.288 32 256s100.288 224 224 224zm0 32C114.615 512 0 397.385 0 256S114.615 0 256 0s256 114.615 256 256-114.615 256-256 256z"
                            id="Oval-1"></path>
                        </svg>
                      </a>
                      <ul class="dropdown-menu ember-view" aria-labelledby="dropdownMenuButton">
                        <li *ngFor="let status of filtered_ticket_status" class="dropdown-item"
                          (click)="UpdateTicketstatus(ticket,status)">{{status.Description}}</li>
                      </ul>
                    </div>
                  </td>

                </tr>

              </ng-container>

            </tbody>
          </table>

        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeTicketsTable()" value="Cancel">
        </div>
      </form>
    </div>
  </div>
</div>
<!--Tickets Table-->


<!----View Notification Popup // id="viewNotification"----->

<div id="SendMessage" class="modal fade add-address-form-box singal-help-box">
  <div class="modal-dialog ">
    <div class="modal-content">
      <form>
        <div class="modal-body">


          <div id="frame">

            <div class="content">
              <div class="contact-profile">
                <img src="assets/img/user-5.jpg" alt="">
                <p>{{this.emp_name}} ({{this.emp_code}})</p>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="onClose()">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="messages">
                <ul>
                  <li *ngFor="let item of ticket_trail_data"
                    [ngClass]="{'sent': item.ticket_created_by === 'Employee', 'replies': item.ticket_created_by === 'Employer'}">
                    <img src="assets/img/No img.png" alt="No img"
                      *ngIf="item.ticket_created_by === 'Employee' || item.ticket_created_by === 'Employer'">
                    <div class="message-content">
                      <p *ngIf="item.ticket_comment">{{ item.ticket_comment }}</p>
                      <p *ngIf="!item.ticket_comment && item.ticket_created_by === 'Employee'">No Conversation From
                        Employee End</p>
                      <p *ngIf="!item.ticket_comment && item.ticket_created_by === 'Employer'">No Conversation From
                        Employer End</p>
                      <div *ngIf="item.document_name" class="document-link"
                        [ngClass]="{'left-side': item.ticket_created_by === 'Employee', 'right-side': item.ticket_created_by === 'Employer'}">
                        <a [href]="item.document_path" target="_blank">
                          <i [ngClass]="getIconForDocumentType(item.document_type)" style="font-size:14px;"></i>
                        </a>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>



              <div class="message-input" *ngIf="status !== 'Closed' && status !== 'On-hold'">
                <form [formGroup]="Create_Ticket_Form">
                  <div class="wrap">
                    <input type="text" placeholder="Write your message..." formControlName="ticketComment">
                    <input type="file" #fileInput accept=".jpeg,.jpg,.png" (change)="onFileSelected($event)"
                      style="display: none;">
                    <i class="fa fa-paperclip attachment" aria-hidden="true" (click)="fileInput.click()"
                      style="display:none"></i>
                    <button class="submit" type="button" (click)="CreateTicket_Trail()"><i class="fa fa-paper-plane"
                        aria-hidden="true"></i></button>
                  </div>
                  <div class="attached-image-container" *ngIf="base64Data">
                    <div class="attached-image">
                      <img [src]="'data:image/' + documentType + ';base64,' + base64Data" alt="Attachment">
                      <i class="fa fa-times remove" (click)="removeImage()"></i>
                    </div>
                  </div>

                </form>
              </div>


            </div>
          </div>


        </div>

      </form>
    </div>
  </div>
</div>
<!----View Notification Popup----->


<!-- Modal -->
<div class="modal" id="myModal" role="dialog" [ngStyle]="{'display':alertModalStatus?'block':'none'}">
  <div class="modal-dialog modal-sm">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" (click)="closeAlertModal()">&times;</button>
        <h4 class="modal-title">Alert</h4>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to verify and Payment Advice records? Please confirm</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="closeAlertModal()">No</button>
        <button type="button" class="btn btn-success" data-dismiss="modal"
          (click)="Verify_Lock_Payment_attednace()">Yes</button>
      </div>
    </div>

  </div>
</div>

<!-----------Approve Work Report-- By AK-------->
<div [@grooveState]="showApproveWorkReportPopup?'active':'inactive'" id="sendNotification" class="modal"
  style="z-index:1000;">
  <div [@dongleState]="showApproveWorkReportPopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div class="modal-content" style="height:100%;margin-top:100px;">
      <!-- <form [formGroup]="CalcTpFlexiSalaryForm"> -->
      <div class="modal-header theme-bg">
        <h4 class="modal-title">Approve Work Report
        </h4>
        <button type="button" class="close" aria-hidden="true" (click)="closeWorkReportModal()">&times;</button>
      </div>
      <div class="modal-body" style="height:25rem; overflow:auto;">
        <div class="payout-input-section">
          <label for="payoutAmountInput" class="payout-label">{{ payoutPeriodLabel }}</label>
          <div class="input-wrapper">
            <input type="number" id="payoutAmountInput" class="payout-input" (input)="onAmountChange($event)"
              [(ngModel)]="payoutAmount" name="payoutAmount" placeholder="Enter amount" aria-label="Payout Amount"
              (keypress)="restrictToNumbers($event)" required>
            <button type="button" class="submit-button" (click)="onSubmitCalcTpFlexiSalary()"
              aria-label="Submit Payout Amount" title="Submit Payout Amount">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div *ngIf="errorMessage" style="color: red; margin-top: 5px;">
            {{ errorMessage }}
          </div>
        </div>

        <!-- If summary loaded, show summary details -->
        <div *ngIf="isSummaryVisible">
          <h5>Payout Breakout Summary:</h5>
          <div class="breakdown-card">
            <div class="breakdown-row">
              <span class="label">Pay Days</span>
              <span class="value">{{ CalcTpFlexiSalaryData?.salarydays | number:'1.4-4' }}</span>
            </div>
            <div class="breakdown-row">
              <span class="label">Payout Amount</span>
              <!-- Using currency pipe is an option, but for exact format matching: -->
              <span class="value">₹ {{ CalcTpFlexiSalaryData?.salaryamount | number:'1.0-0' }}</span>
            </div>
            <div class="breakdown-row">
              <span class="label">ESIC Contribution</span>
              <span class="value">₹ {{ CalcTpFlexiSalaryData?.esicontribution | number:'1.4-4' }}</span>
            </div>
            <div class="breakdown-row no-border">
              <span class="label">EPF Contribution</span>
              <span class="value">₹ {{ CalcTpFlexiSalaryData?.epfcontribution | number:'1.0-0' }}</span>
            </div>
          </div>

          <div class="summary-section">
            <div class="summary-row">
              <span class="label">Cost to Employer</span>
              <span class="value">₹ {{ CalcTpFlexiSalaryData?.costtoemployer | number:'1.4-4' }}</span>
            </div>
            <div class="summary-row">
              <span class="label">Payout of Associate</span>
              <span class="value">₹ {{ CalcTpFlexiSalaryData?.inhandsalary | number:'1.4-4' }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <input type="button" class="btn btn-default" (click)="closeWorkReportModal()" value="Cancel">
        <!-- <input type="submit" class="btn btn-success" (click)="createSupportRequest()" value="Confirm"> -->
        <ng-container *ngIf="isSummaryVisible">
          <input type="submit" class="btn btn-success" (click)="confirmSaveTpFlexiSalary()" value="Confirm & Approve">
        </ng-container>
      </div>
      <!-- </form> -->
    </div>
  </div>
</div>
<!-----------Approve Work Report-------->
