<app-sidebar (toggleEmitter)="toggle()"></app-sidebar>
<section>
  <div id="wrapper" [ngClass]="{'active': showSidebar == false}">
    <div class="fakeLoader"></div>


    <div id="page-wrapper">

      <div class="row page-titles">
        <div class="col-md-5 align-self-center">
          <h3 class="text-themecolor" style="font-size: 2rem;">{{selected_dispay_name}} Attendance</h3>
        </div>
        <div class="col-md-7 align-self-center">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a [routerLink]="['/attendance']">Attendance</a></li>
            <li class="breadcrumb-item active">{{selected_dispay_name}} Attendance</li>
          </ol>
        </div>
      </div>



      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12 col-sm-12">
            <div class="card">
              <div class="card-header">
                <div class="row">

                  <div class="col-md-12 col-sm-12">

                    <div class="row">

                      <div class="col-md-9 col-sm-9">

                        <div class="col-md-3 col-sm-3">
                          <b>Search</b> <br>
                          <input type="text" class="form-control" placeholder="Search"
                            (keyup)="search($event.target.value)" maxlength="200" />
                        </div>

                        <div class="col-md-2 col-sm-2">
                          <span style="margin: 10px;font-weight: bold;">Month</span>
                          <select class="form-control" (change)="changeMonth($event)">
                            <!-- <option value="">Select</option> -->
                            <option *ngFor="let ma of monthsArray" [selected]="month==ma.id" [value]="ma.id">
                              {{ma.month}}
                            </option>
                          </select>
                        </div>

                        <div class="col-md-2 col-sm-2">
                          <span style="margin: 10px;font-weight: bold;">Year</span>
                          <select class="form-control" (change)="changeYear($event)">
                            <!-- <option value="">Select</option> -->
                            <option *ngFor="let ya of yearsArray" [selected]="year==ya" [value]="ya">{{ya}}</option>

                          </select>
                        </div>
                        <div class="col-md-3 col-sm-3" *ngIf="attendanceCategory==''">
                          <span style="margin: 10px;font-weight: bold;">Type</span>
                          <select class="form-control" [(ngModel)]="attendanceCategory"
                            (change)="change_att_category()">
                            <option value="">All</option>
                            <option value="DE">Deviation</option>
                            <option value="MP">Missed Punch</option>
                          </select>
                          <!-- <span style="margin: 10px;font-weight: bold;">&nbsp;</span>
                          <a style="font-weight: 500;color: black;border-color: #0e49ed !important;    margin-left: 2rem;"
                            class="btn btn-secondary manage-btn" (click)="get_missed_punch_att()">
                            Search</a> -->
                        </div>
                        <div class="col-md-2 col-sm-2">
                          <span style="margin: 10px;font-weight: bold;">&nbsp;</span>
                          <span class="form-control"
                            style="font-weight: bold;background-color:white;border-color: white;">Total :
                            {{missed_punch_data.length}}</span>
                        </div>
                      </div>

                      <div class="col-md-2 col-sm-2">
                        <div class="Show-Fields-top-outer-box" style="float: right;">
                          <div class="dropdown float-right-box">
                            <ul class="nav nav-pills" role="tablist">
                              <li role="presentation" class="dropdown ">
                                <a href="#" id="drop6" data-toggle="dropdown" role="button"
                                  class="dropdown-toggle btn btn-user1 btn-round btn-primary">Export as <span
                                    class="caret"></span></a>

                                <ul id="menu3" aria-labelledby="drop6" class="dropdown-menu">
                                  <li><a (click)="exportToExcel()" style="cursor: pointer;"> XLSX (Microsoft
                                      Excel)</a></li>
                                </ul>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>


                    </div>

                    <div class="row">
                      <div class="col-md-6" style="display: flex;"
                        *ngIf="istToGermanTimeService.checkIfGermanTimeZone()">
                        <!-- <strong>Timezone : &nbsp;</strong> -->
                        <div class="form-check-inline">
                          <input id="ist" type="radio" [(ngModel)]="showGermanTime" [ngModelOptions]="{standalone: true}" name="timezone" value="IST"
                            class="form-check-input" (change)="onTimezoneChange()">
                          <label for="ist" class="form-check-label">IST</label>
                        </div>
                        <div class="form-check-inline">
                          <input id="cet" type="radio" [(ngModel)]="showGermanTime" [ngModelOptions]="{standalone: true}" name="timezone" value="CET"
                            class="form-check-input" (change)="onTimezoneChange()">
                          <label for="cet" class="form-check-label">CET/CEST</label>
                        </div>

                      </div>
                    </div>

                  </div>

                </div>
              </div>

              <div class="card-body padd-bot-0 padd-top-0">

                <div class="row">
                  <div class="col-md-12 padd-top-0">
                    <div class="table-responsive bulk-attendance-outer-box Reimbursements-outer-box">
                      <p style="color:blue"><span>Note*</span><span style="font-size: 12px; color: #00a4df;"> &nbsp;For
                          bulk actions, please select the items you wish to update and then click the 'Update Marking
                          Status' button to apply the changes.</span></p>

                      <span class="text-info" style="color: lightcoral;font-size: 1.3rem;"
                        *ngIf="!check_access_right_cdn()">
                        You only have permission to view attendance records. Any changes or modifications are not
                        allowed

                      </span>
                      <table class="table user-list">
                        <thead style="background: skyblue;">
                          <tr>
                            <th>
                              <input type="checkbox" name="check_punch_all" (change)="change_check_punch_all($event)">

                            </th>
                            <th>#</th>
                            <th>Employee Name</th>
                            <th>Attendance Date</th>
                            <th>Assign Shift</th>
                            <th>Status</th>
                            <th>Intime</th>
                            <th>OutTime</th>
                            <th>Working hrs</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <ng-container *ngFor="let mpd of missed_punch_data; let i = index">
                            <tr>
                              <td>
                                <input *ngIf="mpd.is_salary_processed!='Y'" type="checkbox" name="check_punch"
                                  (change)="change_check_punch($event, i)">
                              </td>
                              <td> {{i+1}}</td>
                              <td>
                                {{mpd.emp_name}}
                                <span *ngIf="mpd.orgempcode; else elseBlock">
                                  [{{mpd.orgempcode}}]
                                </span>
                                <ng-template #elseBlock>
                                  [{{mpd.cjcode}}]
                                </ng-template>
                              </td>
                              <td>{{mpd.att_date}}</td>
                              <td>{{mpd.shift_name_and_timing}}</td>
                              <td>
                                {{!mpd.att_catagory_txt ? mpd.attendance_type: mpd.att_catagory_txt}} </td>
                              <td>
                                <ng-container *ngIf="showGermanTime=='IST'">{{mpd.check_in_time}}</ng-container>
                                <ng-container *ngIf="showGermanTime=='CET'">{{ getGermanTime(mpd.check_in_time,mpd.att_date) }}</ng-container>
                              </td>
                              <td>
                                 <ng-container *ngIf="showGermanTime=='IST'">{{mpd.check_out_time}}</ng-container>
                                <ng-container *ngIf="showGermanTime=='CET'">{{ getGermanTime(mpd.check_out_time,mpd.att_date) }}</ng-container>
                              </td>
                              <td>{{mpd.no_of_hours_worked}}</td>
                              <td>
                                <ng-container *ngIf="mpd?.is_salary_processed != 'Y'">
                                  <a style="cursor :pointer;" (click)="openAttCalendar2(i)"
                                    *ngIf="check_access_right_cdn()"><i class="fa fa-edit"></i></a>

                                  <a (click)="manage_biometric_att_single(mpd.orgempcode, mpd.att_date)"
                                    title="Re-sync the punches if the check-in/out times are not showing."
                                    style="cursor :pointer; margin-left:10px;" *ngIf="check_access_right_cdn()">
                                    <i *ngIf="mpd.is_biomatric_device_enable=='Y' && mpd.orgempcode"
                                      class="fa fa-refresh"></i>
                                  </a>
                                </ng-container>
                              </td>
                            </tr>
                          </ng-container>

                          <tr *ngIf="missed_punch_data.length == 0">
                            <td colspan="100%" style="text-align: center;">No Data Found</td>
                          </tr>

                        </tbody>

                      </table>

                      <div class="col-md-4 col-sm-4" *ngIf="check_access_right_cdn()">
                        <div *ngIf="selected_missed_punches.length>0">
                          <button class="btn btn-success btn-lg " (click)="openAttCalendar()">Update Marking
                            Status</button>
                        </div>

                        <br>
                      </div>

                      <div class="col-md-4 col-sm-4" *ngIf="check_access_right_cdn()">
                        <div *ngIf="selected_missed_punches.length>0">
                          <button class="btn btn-primary btn-lg " (click)="openBulkResyncDatePopup()">Re-Sync
                            Punches</button>
                        </div>

                        <br>
                      </div>

                    </div>
                  </div>
                </div>
              </div>

            </div>
            <alert></alert>
          </div>
        </div>
      </div>


    </div>

  </div>

</section>

<app-footer></app-footer>


<!------------Attendance Calendar 1-------->
<div [@grooveState]="showAttCalendarPopup?'active':'inactive'" id="Attendance" class="modal">
  <div [@dongleState]="showAttCalendarPopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div *ngIf="showAttCalendarPopup" class="modal-content" style="height:100%;margin-top:100px;">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Update Missed Punch Status</h4>
          <button type="button" class="close" (click)="closeAttCalendar()">&times;</button>
        </div>
        <div class="modal-body">

          <div class="form-group">
            <label>Mark Attendance</label>
            <div class="custom-radio">
              <div class="row">
                <div class="col-md-12">
                  <div class="col-md-6">
                    <input type="radio" id="present" name="att_options" value="PP" (change)="changeAttType('PP')">
                    <label for="present">Present [PP]</label>
                  </div>
                  <div class="col-md-6">
                    <input type="radio" id="wfh" name="att_options" value="WFH" (change)="changeAttType('WFH')">
                    <label for="wfh">Work From Home [WFH]</label>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="col-md-6">
                    <input type="radio" id="od" name="att_options" value="OD" (change)="changeAttType('OD')">
                    <label for="od">OnDuty [OD]</label>
                  </div>
                  <div class="col-md-6">

                    <input type="radio" id="week_off" name="att_options" value="WO" (change)="changeAttType('WO')">
                    <label for="week_off">Weekly-Off [WO]</label>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="col-md-6">
                    <input type="radio" id="absent" name="att_options" value="AA" (change)="changeAttType('AA')">
                    <label for="absent">Absent [AA]</label>
                  </div>
                  <div class="col-md-6">
                    <input type="radio" id="holiday" name="att_options" value="HO" (change)="changeAttType('HO')">
                    <label for="holiday">Holiday [HO]</label>
                  </div>
                </div>

                <!-- <div class="col-md-12">
                  <div class="col-md-12">
                    <input type="radio" id="half" name="att_options" value="HD" (change)="changeAttType('HD')">
                    <label for="half">Half Day [HD]</label><br>
                    <div *ngIf="attCalendarForm.controls.attendancetype.value=='HD'"
                      style="display: flex;flex-wrap: wrap;font-size: 11px;margin-left: 1rem;">
                      <div class="row">

                        <ng-container *ngFor="let fe of leave_sub_type_arr;">
                          <div class="col-md-6">
                            <input type="radio" id="{{fe.typecode}}" name="leave_options" value="{{fe.typecode}}"
                              (change)="changeLeaveType($event)">
                            <label for="{{fe.typecode}}">{{fe.typename}} [{{fe.typecode}}] -
                            </label>
                          </div>
                        </ng-container>
                        <div class="col-md-6">
                          <input type="radio" id="AA" name="leave_options" value="AA"
                            (change)="changeLeaveType($event,'')"
                            [checked]="attCalendarForm.controls.leavetype.value==''">
                          <label for="AA">Absent [AA] </label>
                        </div>
                      </div>

                    </div>

                  </div>
                </div>
                <div class="col-md-12">
                  <div class="col-md-12">
                    <input type="radio" id="leave" name="att_options" value="LL" (change)="changeAttType('LL')"
                      [checked]="attCalendarForm.controls.attendancetype.value=='LL'">
                    <label for="leave">Leave [LL]</label>

                    <div
                      *ngIf="attCalendarForm.controls.attendancetype.value=='LL'"
                      style="display:flex;flex-wrap:wrap;font-size: 11px;margin-left: 1rem;">
                      <div class="row">
                        <ng-container *ngFor="let fe of leave_sub_type_arr;">
                          <div class="col-md-6">
                            <input type="radio" id="{{fe.typecode}}" name="leave_options" value="{{fe.typecode}}"
                              (change)="changeLeaveType($event)">
                            <label for="{{fe.typecode}}">{{fe.typename}} [{{fe.typecode}}] -
                            </label>
                          </div>
                        </ng-container>
                        <ng-container>
                          <div class="col-md-6">
                            <input type="radio" id="CO" name="leave_options" value="CO"
                            (change)="changeLeaveType($event)">
                            <label for="CO">CompOff [CO]</label>
                          </div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </div> -->

                <div class="col-md-12 col-sm-12" style="margin-top: 10px;">
                  <textarea class="form-control" placeholder="Enter Remarks..." [(ngModel)]="mark_remarks"
                    [ngModelOptions]="{standalone: true}">
                  </textarea>
                </div>

              </div>

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeAttCalendar()" value="Cancel">

          <input type="submit" class="btn btn-success" (click)="manage_missed_punch_att()" value="Update"
            *ngIf="check_access_right_cdn()">
        </div>
      </form>
    </div>
  </div>
</div>
<!------------end-------->


<!------------Attendance Calendar 2-------->
<div [@grooveState]="showSingleAttCalendarPopup?'active':'inactive'" id="Attendance" class="modal">
  <div [@dongleState]="showSingleAttCalendarPopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div *ngIf="showSingleAttCalendarPopup" class="modal-content" style="height:100%;margin-top:100px;">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Update Missed Punch Status</h4>
          <button type="button" class="close" (click)="closeAttCalendar()">&times;</button>
        </div>
        <div class="modal-body">

          <div class="form-group">
            <label>Mark Attendance</label>
            <div class="custom-radio">
              <div class="row">
                <div class="col-md-12">
                  <div class="col-md-6">
                    <input type="radio" id="present" name="att_options" value="PP" (change)="changeAttType('PP')">
                    <label for="present">Present [PP]</label>
                  </div>
                  <div class="col-md-6">
                    <input type="radio" id="wfh" name="att_options" value="WFH" (change)="changeAttType('WFH')">
                    <label for="wfh">Work From Home [WFH]</label>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="col-md-6">
                    <input type="radio" id="od" name="att_options" value="OD" (change)="changeAttType('OD')">
                    <label for="od">OnDuty [OD]</label>
                  </div>
                  <div class="col-md-6">

                    <input type="radio" id="week_off" name="att_options" value="WO" (change)="changeAttType('WO')">
                    <label for="week_off">Weekly-Off [WO]</label>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="col-md-6">
                    <input type="radio" id="absent" name="att_options" value="AA" (change)="changeAttType('AA')">
                    <label for="absent">Absent [AA]</label>
                  </div>
                  <div class="col-md-6">
                    <input type="radio" id="holiday" name="att_options" value="HO" (change)="changeAttType('HO')">
                    <label for="holiday">Holiday [HO]</label>
                  </div>
                </div>

                <div class="col-md-12">
                  <div class="col-md-12">
                    <input type="radio" id="half" name="att_options" value="HD" (change)="changeAttType('HD')">
                    <label for="half">Half Day [HD]</label><br>
                    <div *ngIf="mark_att_type=='HD'"
                      style="display: flex;flex-wrap: wrap;font-size: 11px;margin-left: 1rem;">
                      <div class="row">

                        <ng-container *ngFor="let fe of this.missed_punch_data[single_selected_index]?.balance_txt;">
                          <div class="col-md-6">
                            <input type="radio" id="{{fe.typecode}}" name="leave_options" value="{{fe.typecode}}"
                              (change)="changeLeaveType($event, fe.prev_bal)">
                            <label for="{{fe.typecode}}">{{fe.typename}} [{{fe.typecode}}] -
                              <strong>{{fe.prev_bal}}</strong>
                              Days
                            </label>
                          </div>
                        </ng-container>
                        <div class="col-md-6">
                          <input type="radio" id="AA" name="leave_options" value="AA"
                            (change)="changeLeaveType($event,'')" [checked]="mark_leave_type==''">
                          <label for="AA">Absent [AA] </label>
                        </div>
                      </div>

                    </div>

                  </div>
                </div>
                <div class="col-md-12">
                  <div class="col-md-12">
                    <input type="radio" id="leave" name="att_options" value="LL" (change)="changeAttType('LL')">
                    <label for="leave">Leave [LL]</label>

                    <div *ngIf="mark_att_type=='LL'"
                      style="display:flex;flex-wrap:wrap;font-size: 11px;margin-left: 1rem;">
                      <div class="row">
                        <ng-container *ngFor="let fe of this.missed_punch_data[single_selected_index]?.balance_txt">
                          <div class="col-md-6">
                            <input type="radio" id="{{fe?.typecode}}" name="leave_options" value="{{fe.typecode}}"
                              (change)="changeLeaveType($event, fe.prev_bal)">
                            <label for="{{fe.typecode}}">{{fe.typename}} [{{fe.typecode}}] -
                              <strong>{{fe.prev_bal}}</strong>
                              Days</label>
                          </div>
                        </ng-container>
                        <ng-container
                          *ngIf="is_comp_off_applicable(this.missed_punch_data[single_selected_index]?.comp_off_txt)">
                          <div class="col-md-6">
                            <input type="radio" id="CO" name="leave_options" value="CO"
                              (change)="changeLeaveType($event, get_tot_co_bal(this.missed_punch_data[single_selected_index]?.comp_off_txt))">
                            <label for="CO">CompOff [CO] -
                              <strong>{{get_tot_co_bal(this.missed_punch_data[single_selected_index]?.comp_off_txt)}}</strong></label>
                          </div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-12 col-sm-12" style="margin-top: 10px;">
                  <textarea class="form-control" placeholder="Enter Remarks..." [(ngModel)]="mark_remarks"
                    [ngModelOptions]="{standalone: true}">
                  </textarea>
                </div>

              </div>

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeAttCalendar()" value="Cancel">
          <input type="submit" class="btn btn-success" (click)="manage_missed_punch_att()" value="Update"
            *ngIf="check_access_right_cdn()">
        </div>
      </form>
    </div>
  </div>
</div>
<!------------end-------->



<!------------Bulk Resync Date-------->
<div [@grooveState]="showBulkResyncDatePopup?'active':'inactive'" id="Attendance" class="modal">
  <div [@dongleState]="showBulkResyncDatePopup?'active':'inactive'" class="modal-dialog"
    style="margin:auto auto auto auto;">
    <div *ngIf="showBulkResyncDatePopup" class="modal-content" style="height:100%;margin-top:100px;">
      <form>
        <div class="modal-header theme-bg">
          <h4 class="modal-title">Re-Sync Punch</h4>
          <button type="button" class="close" (click)="closeBulkResyncDatePopup()">&times;</button>
        </div>
        <div class="modal-body">

          <div class="form-group">
            <label>Select Date</label>
            <div class="custom-radio">
              <div class="row">
                <div class="col-md-12">
                  <div class="col-md-6">
                    <input type="hidden" id="recdate" (click)="filterFromToDateLeads()">
                    <input type="text" value="{{ bulk_from_dt }}" class="form-control" placeholder="Enter From Date" #sd
                      name="startDate" id="startDate" readonly maxlength="10" />
                  </div>
                  <div class="col-md-6">
                    <input type="text" value="{{ bulk_to_dt }}" class="form-control" placeholder="Enter to Date" #ed
                      name="endDate" id="endDate" readonly maxlength="10" />
                  </div>
                </div>


              </div>

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" (click)="closeBulkResyncDatePopup()" value="Cancel">

          <input type="submit" class="btn btn-success" (click)="manage_biometric_att_bulk()" value="Resync"
            *ngIf="check_access_right_cdn()">
        </div>
      </form>
    </div>
  </div>
</div>
<!------------end-------->
